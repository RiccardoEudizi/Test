<!DOCTYPE html>
<!-- saved from url=(0081)https://labs.vocareum.com/main/main.php?m=editor&nav=1&asnid=121095&stepid=121096 -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Workbench</title>
 <link rel="shortcut icon" href="https://labs.vocareum.com/shared/ico/favicon.ico" type="image/x-icon"> 
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">


<!-- imported -->
		<!--basic styles-->

		<link href="./prova Html_files/bootstrap.min.css" rel="stylesheet">
		<link href="./prova Html_files/bootstrap-responsive.min.css" rel="stylesheet">
		<link rel="stylesheet" href="./prova Html_files/font-awesome.min.css">

		<!--[if IE 7]>
		  <link rel="stylesheet" href="../shared/ace/assets/css/font-awesome-ie7.min.css" />
		<![endif]-->

		<!--page specific plugin styles-->

		<link rel="stylesheet" href="./prova Html_files/jquery-ui-1.10.3.custom.min.css">
		<link rel="stylesheet" href="./prova Html_files/jquery.gritter.css">
		
		
		<link rel="stylesheet" href="./prova Html_files/colorbox.css">

		<!--fonts-->

		<link rel="stylesheet" href="./prova Html_files/ace-fonts.css">

		<!--ace styles-->
        <link rel="stylesheet" href="./prova Html_files/chosen.css">
		<link rel="stylesheet" href="./prova Html_files/ace.css">
		<link rel="stylesheet" href="./prova Html_files/ace-responsive.min.css">
		<link rel="stylesheet" href="./prova Html_files/ace-skins.min.css">
        <link rel="stylesheet" href="./prova Html_files/datepicker.css">
        <link rel="stylesheet" href="./prova Html_files/jsPanel.css">
        
    <!-- Add the slick-theme.css if you want default styling -->
    <link rel="stylesheet" type="text/css" href="./prova Html_files/slick.css">
    <link rel="stylesheet" type="text/css" href="./prova Html_files/slick-theme.css">



		<!--[if lte IE 8]>
		  <link rel="stylesheet" href="../shared/ace/assets/css/ace-ie.min.css" />
		<![endif]-->

		<!-- Vocareum styles -->
		
		<link rel="stylesheet" href="./prova Html_files/vocareum.css">
		<script src="./prova Html_files/localStorage.js.download"></script>



<!-- js start -->
	<!-- jquery start -->
		<!--[if !IE]>-->
		<script type="text/javascript">
                  window.jQuery || document.write("<script src='../shared/ace/assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
		</script><script src="./prova Html_files/jquery-2.0.3.min.js.download"></script>

		<!--<![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='../shared/ace/assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->
		<script type="text/javascript">
			if("ontouchend" in document) document.write("<script src='../shared/ace/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>

		<script src="./prova Html_files/jquery-ui-1.10.3.custom.min.js.download"></script>
		<script src="./prova Html_files/jquery.ui.touch-punch.min.js.download"></script>
		<script src="./prova Html_files/jquery.easy-pie-chart.min.js.download"></script>
		<script src="./prova Html_files/fuelux.wizard.min.js.download"></script>
		<script src="./prova Html_files/jquery.jspanel.js.download"></script>
	<!-- jquery end -->

<!-- js end -->

		<script src="./prova Html_files/bootstrap.min.js.download"></script>
		<script src="./prova Html_files/ace.js.download"></script>
		<script src="./prova Html_files/ace-extra.min.js.download"></script>
		<script src="./prova Html_files/bootbox.min.js.download"></script>

		<script src="./prova Html_files/jquery.autosize-min.js.download"></script>
		<script src="./prova Html_files/chosen.jquery.min.js.download"></script>
        <script src="./prova Html_files/bootstrap-datepicker.min.js.download"></script>
        
        <script src="./prova Html_files/bootstrap-tag.min.js.download"></script>
		
        <script src="./prova Html_files/jquery.validate.min.js.download"></script>
        <script src="./prova Html_files/additional-methods.min.js.download"></script>
		<script src="./prova Html_files/jquery.tmpl.min.js.download"></script>
        <script src="./prova Html_files/jquery.cookie.js.download"></script>

<style type="text/css">
  html,
  body {
	height: 100%;
	font-size: 95%;
	background-color: rgb(255,255,255)!important;
  }

  .vocbtn-round-corner {
	border-radius: 3px!important;
	margin: 0 5px 2px 0px !important;
  }

  #wrap {
	min-height: 100%;
	height: auto !important;
	height: 100%;
	/* Negative indent footer by it's height */
	margin: 0 auto -30px;
  }

  /* Set the fixed height of the footer here */
  #push,
  #footer {
	height: 30px;
  }
  #footer {
	background-color: #333;
	color: #ccc;
  }

  /* Lastly, apply responsive CSS fixes as necessary */
  @media (max-width: 767px) {
	#footer {
	  margin-left: -20px;
	  margin-right: -20px;
	  padding-left: 20px;
	  padding-right: 20px;
	}
  }
  
    /* one more CSS fixes as necessary */
  @media (max-width: 979px) {
	#page-content {
	}
  }
  

  /* Custom page CSS
  -------------------------------------------------- */
  /* Not required for template or sticky footer method. */

  #wrap > .container {
	padding-top: 60px;
  }
  .container .credit {
	margin: 20px 0;
  }

  code {
	font-size: 80%;
  }

.dropdown-menu > li > div:hover,
.dropdown-menu > li > div:focus {
  color: #ffffff;
  text-decoration: none;
  background-color: #0081c2;
  background-image: -moz-linear-gradient(top, #0088cc, #0077b3);
  background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#0088cc), to(#0077b3));
  background-image: -webkit-linear-gradient(top, #0088cc, #0077b3);
  background-image: -o-linear-gradient(top, #0088cc, #0077b3);
  background-image: linear-gradient(to bottom, #0088cc, #0077b3);
  background-repeat: repeat-x;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ff0088cc', endColorstr='#ff0077b3', GradientType=0);
}

.dropdown-menu > li > div {
  display: block;
  padding: 3px 20px;
  clear: both;
  font-weight: normal;
  line-height: 20px;
  color: #333333;
  white-space: nowrap;
}

.ace-nav > li > div {
  position: relative;
  color: #EEE;
  display: block;
  height: 100%;
  padding: 0 8px !important;
  background-color: transparent;
}

.ace-nav > li > div > [class*="icon-"] {
  font-size: 16px;
  color: #EEE;
  display: inline-block;
  width: 20px;
  text-align: center;
}

.tree .tree-selected > [class*="icon-"]:first-child {
  color: 0 !important;
}

</style>

		<style>
			.spinner-preview {
				width:100px;
				height:100px;
				text-align:center;
				margin-top:60px;
			}

			.dropdown-preview {
				margin:0 5px;
				display:inline-block;
			}
			.dropdown-preview  > .dropdown-menu {
				display: block;
				position: static;
				margin-bottom: 5px;
			}
		</style>

<!-- style for accessibility -->
<style>

.btn-group > .btn,
.btn-group + .btn {
  margin: 0 1px 0 0;
  border-width: 1px !important;
}

/*
.alert {
  color: black;
}
*/

.alert-success {
  color: #155724 !important;
}

.alert-error, .alert-danger {
  color: #721c24 !important;
}

.alert-warning {
  color: #856404 !important;
}

.chosen-container-single .chosen-default {
  color: black;
}

.vocbtn-ac {
  border-radius: 3px!important;
  padding: 1px 12px!important;
  margin: 0 8px 5px 0px !important;
  min-width: 60px!important;
  line-height: 30px!important;
  border-width: 1px !important;
}

.vocbtn2 {
  border-radius: 3px!important;
  padding: 1px 8px!important;
  margin: 0 8px 5px 0px !important;
  margin: 0 0px 0 0px !important;
  min-width: 40px!important;
  line-height: 30px!important;
  border-width: 1px !important;
}

.vocbtn-action {
  background: none repeat scroll 0% 0% rgb(0, 109, 204)!important;
  border-color: rgb(0, 109, 204)!important;
}
.vocbtn-action:hover, .vocbtn-primary:focus {
  background: none repeat scroll 0% 0% rgb(0, 109, 204)!important;
  border-color: rgb(0, 109, 204)!important;
}

.vocbtn-status {
  background: #f5f5f5 !important;
  text-shadow: 0 0 0 !important;
  color: #2D3B45 !important;
  border: 1px solid !important;
  border-color: #C7CDD1 !important;
}

.vocbtn-status:hover, .vocbtn-default:focus {
  background: #C7CDD1 !important;
}

.table-header {
  background-color:#394B58 !important;
}

.tree .tree-item, .tree .tree-folder .tree-folder-header {
    color: black;
}

.voc-link, .breadcrumb li a {
  color: rgb(32, 57, 157);
}

.table thead tr {
  color: #000 !important;
}

.breadcrumb li, .breadcrumb li .divider {
  color: #000 !important;
}

</style>
</head>
<body style="">

<script type="text/javascript">
      if (self !== top) {
      window.stop();
      window.location.href += '&hideNavBar=1';
    }
  
    /* for CSRF tokens */
    /* NOTE: ajaxPreFilter works better than the ajaxSetup where ajax happens when form.serialize is called */
    var csrfToken = "50dd6b2cfa76d91e27285f09c273e25e";
    $.ajaxPrefilter(function(options, originalData, xhr) {
      if (options.data) {
        if (options.data instanceof FormData) {
          //let the form send the vockey
        } else {
          try {
            pdata = JSON.parse(options.data);
            pdata['vockey'] = csrfToken;
            options.data = JSON.stringify(pdata);
          } catch (e) {
            options.data += "&vockey=" + csrfToken;
          }
        }
      } else {
        options.data = "vockey=" + csrfToken;
      }
    });

    /*
    $('form').submit(function(){
      $(this).append("<input type='hidden' name='vockey' value='"+csrfToken+"' />");
      return true;
    });
    $.ajaxSetup({
      data: {
          vockey: csrfToken
      }
    });
    */

</script>

<div id="wrap">
        	<div class="navbar voc-no-mini navbar-inverse">

	<!--<div class="navbar navbar-inverse">-->
	  <div class="navbar-inner" id="navbar-inner-div" style="background-color:#394B58 !important;">
	   <div class="row-fluid">
		  <div class="brand vocelem" id="navbar-logo" onclick="location.href=&#39;http://www.vocareum.com&#39;;" style="margin: -3px 0px -5px 5px; padding-left:0px; padding-right:0px;" tabindex="0" role="button" aria-label="www.vocareum.com"></div>
		<div id="navbar-rightmenu" class="">
		
		  <ul class="nav pull-right ace-nav" style="float:right !important; background-color:transparent !important; border:none !important;">						

         		<li class="vocnav">
			<div class="vocelem use-pointer" onclick="location.href=&#39;main.php?m=dashboard&#39;" tabindex="0" role="button" aria-label="Home"><i class="icon-home icon-large"></i></div>
		</li>
                  		    <li class="vocnav light-blue user-profile">
		      <div class="user-menu dropdown-toggle vocelem use-pointer" href="#" data-toggle="dropdown" tabindex="0" role="button" aria-label="My Classes dropdown">
			<i class="icon-caret-down"></i>
                        <span class="voctext">My Classes</span>
		      </div> 
                      <ul id="studentcoursesList" class="dropdown-menu dropdown-navbar dropdown-yellow dropdown-caret dropdown-close" role="menu" style="max-height: 90vh;overflow-y:scroll; overflow-x:hidden">
                        <li class="nav-header center">Select</li>
                                                  <li><a href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#" onclick="location.href=&quot;../main/main.php?m=course&amp;code=vc_2_0_AWS&quot;" class="align-left" tabindex="0">
                                  1. AWS Starter Account                              </a>
                          </li>
                                                  <li><a href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#" onclick="location.href=&quot;../main/main.php?m=course&amp;code=vc_2_0_09252019org212_4804&quot;" class="align-left" tabindex="0">
                                  2. 5Cinf-2019-2020                              </a>
                          </li>
                                                  <li><a href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#" onclick="location.href=&quot;../main/main.php?m=course&amp;code=vc_2_0_02052020org212_7451&quot;" class="align-left" tabindex="0">
                                  3. HTML5-PHP-MySQL                              </a>
                          </li>
                                                  <li></li>
                      </ul>
                    </li>      
				
				
					

					

			<li class="vocnav light-blue user-profile voc-no-mini use-pointer">
				<div class="voctext vocelem" tabindex="0" role="button" aria-label="Help" style="color: #ffffff" ;="" onclick="location.href=
                                                                            &#39;https://aws.amazon.com/education/awseducate/contact-us/&#39;
				    ;">Help</div>
			</li>
                        						    				
				<li class="vocnav light-blue user-profile vocnav-last">
					<div class="user-menu dropdown-toggle vocelem use-pointer" href="#" data-toggle="dropdown" tabindex="0" role="button" aria-label="User dropdown">

						<span id="user_info" class="voctext">
							rik.eudizi@gmail.com						</span>
        					</div>
        				</li>
							
		  </ul><!--/nav-->	
		  </div> <!-- end of span -->
	   </div><!--/container-fluid-->
	  </div><!--/navbar-inner-->
	</div><!--/navbar-->
  	<div>	
		<div class="clearfix">

					
<!-- moved to different functions -->
		


				
			<div id="page-content" class="clearfix" style="background-color:rgb(255,255,255);margin: 5px 10px 0px 10px;">
				<div class="row-fluid">




			



<script src="./prova Html_files/jquery.gritter.min.js.download"></script>

<!-- PAGE CONTENT BEGINS HERE -->


<script>
     function showdbDetail(host,port,name,pwd){
       var target = document.getElementById("report_db_msg_box");
       target.innerHTML = "<strong>Host:</strong>" + host + '<br>' +
                          "<strong>Port:</strong>" + port + '<br>';
       if(name!='') target.innerHTML +=
                          "<strong>Name:</strong>" + name + '<br>';
        target.innerHTML += pwd;
       $("#modal-table-report-db").modal("show");
     }
	function show_voc_gritter($sticky, $msg, failed) {
		if (failed) {
			color_string = "gritter-error gritter-light";

		} else {
			color_string = "gritter-note gritter-light";
		}
		var duration = 2000;
		// if ($sticky) $duration = 10000;
		
		$.extend($.gritter.options, {
			position: 'bottom-right'
		});
		$.gritter.add({
			title: $msg,
			time: 2000,
			sticky: $sticky,
			class_name: color_string	
		});
	}

	function show_voc_gritter_duration($sticky, $msg, failed, duration) {
		if (failed) {
			color_string = "gritter-error gritter-light";

		} else {
			color_string = "gritter-note gritter-light";
		}
		$.extend($.gritter.options, {
			position: 'bottom-right'
		});
		$.gritter.add({
			title: $msg,
			time: duration,
			sticky: $sticky,
			class_name: color_string	
		});
	}

        var advance_features = "0";

        function show_grades(panel, fullwidth) {
            // mhui
            var jde = false;
            var rde = false;

            if (panel == 0)
            {
            	$('#grades-modal').modal('show');
            	return;
            }
            var element =  document.getElementById('gradeframe');
        	if (element == null || typeof(element) == 'undefined')
        	{
        		$('#grades-modal').modal('show');
        		return;
        	}

            // show the grade panel
            document.getElementById('gradeframe').style.display = "block";
            document.getElementById('gradeframedivider').style.display = "block";

            if (fullwidth) {
              document.getElementById('gradeframe').style.width = "100%";
              document.getElementById('gradeframe').style.height = "100vh";
              document.getElementById('gradeframedivider').style.display = "none";
              document.getElementById('gradeframehide').style.display = "none";
              document.getElementById('gradedetails').style.display = "block";
            }

            // mhui
            if (jde || rde) {
              $('#jupyterIframeParent').width(document.getElementById('gradeframedivider').offsetLeft-5);

           	  // hack to fix the grade panel height in jidebox
              $('#gradeframe').height($('#jidebox').height()-50);
              $('#gradeframedivider').height($('#jidebox').height()-50);
            }

              var gradesPanel = $('#grades-panel'),
                  gradesPanelIframe = gradesPanel.find('iframe'),
                  gradesSpinner = gradesPanel.find('#gradespinner');

              gradesSpinner.removeClass('hidden-1');
              var url = 'main.php?m=grades_review&modalMode=1&asnId=121095&stepid=121096&userid=460852';
                              gradesPanelIframe.prop('src', url);

              gradesPanelIframe.on('load', function() {
                gradesSpinner.addClass('hidden-1');
              });
          }
</script>





<script type="text/javascript">	
  var vocdomain = document.domain.split('.').slice(-2).join('.')
  document.domain = vocdomain;

  //mhui
  var clabsamis = [];

  function updateClusterAMIs()
  {
	  $('#clabstbl tr').each(function (i, row) {
          var myrow = $('#clabstbl tr:eq(' + i + ')');
          if (i > 0)
          {
              myrow.find('td:eq(7)').html('<select style="width:100px;margin-bottom:0px;" onchange="chgvm(' + i + ')">'+ $('#clabsamis').html()+'</select>');
              myrow.find('td:eq(7) select').val(clabsobj[i-1]['ami']);
          }
        });  
  }
  
  function retrieveOrgAMIs()
  {
    var orgid = 212;
    var labtype = "ct";

    var jqxhr = $.ajax('../util/vcput.php?a=getClusterAmisForOrg'
                     + '&orgid='  + orgid)
                 .done(function(data, textStatus, jqXHR) {
                   //console.log(data);
                   try {
             	     var result = JSON.parse(data);
                     if (result['status'] == 'Error') {
                       //alert("Unable to retrieve ami list: " + result['msg'])
                     }
                     else {
                       var foundSelected = false;
                       if (typeof(result['amis']) !== undefined)
                       {
                    	   clabsamis = result['amis']
                         var select = document.getElementById("clabsamis");
                         select.options.length = 0;
                         select.options[select.options.length] = new Option('', '');
                         for (index in clabsamis)
                         {
                           select.options[select.options.length] = new Option(clabsamis[index], index);
                           if (index == "")
                           {
                             //console.log("Index = " + index);
                             select.value = index;
                             foundSelected = true;
                           }
                         }              
                       }
                       if (foundSelected === false)
                       {
                         select.value = '';
                       }
                       if (labtype == 'cl') // update the AMI dropdowns
                       {
                         chgvmtype();
                         //updateClusterAMIs();
                       }
                     }
                   }
                   catch (err) {
                     //alert("Exception retrieving ami list: " + err)
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   //alert("Error retrieving ami list");
                 });
  }


  function endawslabconfirmed(v) {
    }
  function endawslab(v) {
     }
  function awslabchkdone() {
     }
  function startawslab(v) {
     }
         // awssX -- session
       // awsbX -- budget
       // awscX -- credential
       var awsstatus = [];
       var awsscnt = false;
       var awsccnt = false;
       var awsbcnt = false;
       var awstype = 'S';
       var awshandle = false;
       var awsstime = new Date().getTime();
       awsstime = Math.round( awsstime/1000 );
       function vcInsertSpace(s, type)
       { // make sure we have 11 chars;
         var str = '';
         str+='&nbsp;';
         return str;
       }
       function awscoundown()
       {
         if( awsscnt===false ){
           awsscnt = 0;
                    var emid = document.getElementById('vocuseremail');
           if( emid ){
             emid.innerHTML = "rik.eudizi@gmail.com";
           }
           $.ajax({
               url: "../util/vcput.php?a=getaws&nores=1&stepid=121096&version=0&mode=s&type=0",
             })
             .done(function(ret_val) {
                if( ret_val.search(/(Cloud|VM) (Lab|Access)/)>=0 ){
                  awslabtimer(ret_val);
                } else if( ret_val.search(/Remaining session time: /)>=0 ){
                  var tv = ret_val.match(/Remaining session time: ([0-9]+h)?([0-9]+m)?([0-9]+s)/);
                  awsscnt = 0;
                  if( tv ){
                    if( tv[1] ) awsscnt = 3600 * parseInt(tv[1]);
                    if( tv[2] ) awsscnt += 60*parseInt(tv[2]);
                    if( tv[3] ) awsscnt += parseInt(tv[3]);
                  }
                  if( awshandle ) clearTimeout(awshandle);
                  awshandle = window.setTimeout(awscoundown , 300);
                }
                // get the startercode term
                if( ret_val.search(/Term: /) >= 0 ){
                  var tv = ret_val.match(/Term: ([0-9]+ day[s]? )?([0-9]+):([0-9]+):([0-9]+)/);
                  awsccnt = 0;
                  if( ret_val.search(/Remaining credit: /)>=0 ){
                    var cr = ret_val.match(/Remaining credit: \$<\/strong>(.*)\//);
                    awsbcnt = parseFloat(cr[1]);
                    if( tv ){
                      if( tv[1] ) awsccnt = 3600*24*parseInt(tv[1]);
                      if( tv[2] ) awsccnt += 3600*parseInt(tv[2]);
                      if( tv[3] ) awsccnt += 60*parseInt(tv[3]);
                      if( tv[4] ) awsccnt += parseInt(tv[4]);
                    }
                  }
                }
                // mhui: display the status
                if( ret_val.search(/Status: /)>=0 ){
                    var mst = ret_val.match(/Status: ([^<]+)</);
                    var st = mst[1];
                    	awsstatus = st.split(":");
                        var e = document.getElementById("awsstatus");
                        if( e ) e.innerHTML = awsstatus[0];
                    	if (awsstatus.length>1) {
                          var e = document.getElementById("awsstatusdetails");
                          if(e) e.innerHTML = awsstatus[1];
                    	}
                        if(awsstatus[0]=='Deactivated') {
                           $('#awsbtn').attr("disabled", true);
                           if( $("#c9btn").length ){
                             $('#c9btn').attr("disabled", true);
                           }
                        }
                  }
              })
             .fail(function(ret_val) {
               alert('failed to retrieve AWS credentials');
             }); 
                    return false;
         }
         var tnow = new Date().getTime();
         tnow = Math.round(tnow/1000);
         // Budget ('B')
         tstr = '$' + (awsbcnt? awsbcnt : '0.00');
         var e = document.getElementById("awsstimetxtB");
         if( e ) e.innerHTML = vcInsertSpace(tstr, 'B') +  tstr;
         var types = {"0":"T", "1":"S"};
         for( var v in types ){ 
           var type = types[v];
           var left = (type=='S'? awsscnt : awsccnt) - (tnow-awsstime);
           if(left<0){
             left = 0;
           }
           var tstr = '';
           var tms = 0;
           if( left<=0 ) tstr = '00:00:00';
           else {
             if( left>=(24*3600) ){
               var tday = Math.floor(left/(24*3600));
               tstr += tday + 'd ';
               left = left - tday*24*3600;
             }
             if( left>=3600 ){
               var thr = Math.floor(left/3600);
               tstr += thr + ':';
               tms = left - thr * 3600;
             } else {
               tms = left;
               tstr = '0:';
             }
             var tm = type!='S'? Math.floor(tms/60) : Math.ceil(tms/60);
             var ts = tms - tm*60;
             tstr += (tm<10? '0' : '') + tm; // + ':' + (ts<10? '0' : '') + ts; 
             if( type!='S' ){
               tstr += ':' + (ts<10? '0' : '') + ts;
             }
           }
           if( left>0 ){
             awshandle = window.setTimeout(awscoundown , 60000); //3000
           }
           var e = document.getElementById("awsstimetxt" + type);
           if( e ) e.innerHTML =  vcInsertSpace(tstr, type) +  tstr;
         }
         return false;
       }
       function awslabtimer(ret_val)
       {
         awsstime = new Date().getTime();
         awsstime = Math.round( awsstime/1000 );
         awsscnt = 0;
         if( ret_val.search(/Remaining session time:/)>=0 ){
           var tv = ret_val.match(/Remaining session time: ([0-9]+ day[s]? )?([0-9]+):([0-9]+):([0-9]+)\(/);
           if( tv ){
             if( tv[1] ) awsscnt = 24*3600 * parseInt(tv[1]);
             if( tv[2] ) awsscnt += 3600*parseInt(tv[2]);
             if( tv[3] ) awsscnt += 60*parseInt(tv[3]);
             if( tv[4] ) awsscnt += parseInt(tv[4]);
           }
         }
         if( awshandle ) clearTimeout(awshandle);
         awshandle = window.setTimeout(awscoundown , 300);
       }
       awshandle = window.setTimeout(awscoundown , 300);
    function showawsact(v){
        $('#detailspinbox').show();
     if(v==1) $('#showawsdetail').html('Account Details <i id="awsbtnspinbox" class="icon-spin icon-spinner"></i>');
     $.ajax({
        url: "../util/vcput.php?a=getaws&type=0&stepid=121096&version=0&v="+v,
     })
     .done(function(ret_val) {
         var lb = document.getElementById("aws-modal-label");
         lb.innerHTML = 'Credentials';
         var target = document.getElementById("report_aws_msg_box");
         target.innerHTML = ret_val;
         var progress = document.getElementById('report_aws_progress_box');
         progress.innerHTML = '';
         $('#modal-table-report-aws').appendTo("#editordiv");
         $('#modal-table-report-aws').modal('show');
         $('#detailspinbox').hide();
         if(v) $('#showawsdetail').html('Account Details');

         if( ret_val.search(/(Cloud|VM) (Lab|Access)/)>=0 ){
           awslabtimer(ret_val);
         } else if( ret_val.search(/Remaining session time: /)>=0 ){
           var tv = ret_val.match(/Remaining session time: ([0-9]+h)?([0-9]+m)?([0-9]+s)/);
           awsscnt = 0;
           if( tv[1] ) awsscnt = 3600 * parseInt(tv[1]);
           if( tv[2] ) awsscnt += 60*parseInt(tv[2]);
           if( tv[3] ) awsscnt += parseInt(tv[3]);
           if( awshandle ) clearTimeout(awshandle);
           awshandle = window.setTimeout(awscoundown , 300);
         }
      })
     .fail(function(ret_val) {
       alert('failed to retrieve AWS credentials');
       $('#detailspinbox').hide();
       if(v==1) $('#showawsdetail').html('Account Details');
     });
     }
  function showclabs(str){
     $('#detailspinbox').show();
     $.ajax({
        url: "../util/vcput.php?a=getclabs&stepid=121096&version=0",
     })
     .done(function(ret_val) {
         var target = document.getElementById("report_clabs_msg_box");
         target.innerHTML = (str? str : '');
         try {
           resp = jQuery.parseJSON(ret_val);
           target.innerHTML += resp.message;
         } catch(err) {
           target.innerHTML += 'Failed to obtain lab status. If the problem persists, please report this problem to support@vocareum.com.';
         }
         //$('#modal-table-report-clabs').appendTo("#editordiv");
         $('#modal-table-report-clabs').modal('show');
         $('#detailspinbox').hide();
      })
     .fail(function(ret_val) {
       alert('failed to retrieve Labs credentials');
       $('#detailspinbox').hide();
     });
  }
  function cdbtime(resp)
  {
    if( (typeof resp['session_time'] != 'undefined') && resp['session_time'] ){
      awsstime = new Date().getTime();
      awsstime = Math.round( awsstime/1000 );
      awsscnt = resp['session_time'];
      if( awshandle ) clearTimeout(awshandle);
      awshandle = window.setTimeout(awscoundown , 300);
    }
  }
  function showcdbdetails(dbtype){
    str = false;
     $('#detailspinbox').show();
     $.ajax({
        url: "../util/vcput.php?a=getcdb&stepid=121096&version=0&dbtype="+dbtype,
     })
     .done(function(ret_val) {
         var target = document.getElementById("report_cdb_msg_box");
         target.innerHTML = (str? str : '');
         try {
           resp = jQuery.parseJSON(ret_val);
           cdbtime(resp);
           target.innerHTML += resp.message;
         } catch(err) {
           target.innerHTML += 'Failed to obtain DB status. If the problem persists, please report this problem to support@vocareum.com.';
         }
         //$('#modal-table-report-cdb').appendTo("#editordiv");
         $('#modal-table-report-cdb').modal('show');
         $('#detailspinbox').hide();
      })
     .fail(function(ret_val) {
       alert('failed to retrieve DB credentials');
       $('#detailspinbox').hide();
     });
  }
  function launchclabs_confirmed(ischk)
  {
    if (true) {
      changeClabsState("Start", 'Starting', $('#labspinbox'), ischk);
    }
    else {
      launchclabs_confirmed_1(ischk);
    }
  }

  var clabshandle = false;
  function launchclabs_confirmed_1(ischk){
    if(clabshandle) clearTimeout(clabshandle);
    clabshandle = false;
    if( !ischk ) $('#labspinbox').show();

     $.ajax({
        url: "../util/vcput.php?a=" + (ischk? 'getclabs' : 'launchclabs') + "&stepid=121096&version=0",
     })
     .done(function(ret_val) {
         if( !ischk && ret_val.indexOf('success')<0 ){
           var target = document.getElementById("report_clabs_msg_box");
           target.innerHTML = '<br>Failed to launch your lab. If the problem persists, please report to support@vocareum.com for assistance.';
           $('#modal-table-report-clabs').modal('show');
         } else if ( ischk && ret_val.indexOf('NotReady')>=0 ){
           clabshandle = setTimeout(function() { launchclabs_confirmed(1); }, 1000);
         } else if ( ischk && ret_val.indexOf('Ready')>=0 ){
           $('#labspinbox').hide();
           var target = document.getElementById("report_clabs_msg_box");
           target.innerHTML = '<br>Lab is ready';
         } else if ( ischk && (ret_val.indexOf('Terminated')>=0 || ret_val.indexOf('Stopped')>=0) ){
           $('#labspinbox').hide();
           var target = document.getElementById("report_clabs_msg_box");
           target.innerHTML = '<br>Please re-launch the lab through Start Lab.';
         } else {
           clabshandle = setTimeout(function() { launchclabs_confirmed(1); }, 1000);
         }
      })
     .fail(function(ret_val) {
       alert('failed to launch Lab');
       $('#labspinbox').hide();
     });
  }


  var clabsStateData = null;
  function showEmptyClabsStateModal()
  {
    $('#clabsStateModal_vms').hide();
    $('#clabsStateModal_body').hide();
    $('#clabsStateModal_ta').text('Retrieving lab information...');
    $('#clabsStateModal_ta').show();
    $("#clabsStateModal").css('height', 'auto');
    $('#clabsStateModal').modal();
  }

  function clabsStateModalSetMsg(msg)
  {
    $('#clabsStateModal_ta').text(msg);
    $('#clabsStateModal_ta').show();
    $("#clabsStateModal").css('height', 'auto');
    $('#clabsStateModal').modal();
  }

  function clabsStateModalSetFinalState(state, msg)
  {
    var status = "";

    vms = clabsStateData['vms'];
    for (var i = 0; i < vms.length; i++)
    {
      $('#clabs_modal_vm_' + i).hide();
      $('#clabs_modal_vm_spinner_' + i).hide();
      var vm = vms[i];
      var mc = vm['machine'];
      if (mc)
      {
        if (mc['state'] == "Failed")
        {
          if (mc['status'] != "")
          {
            status += "\n  " + mc['hostname'] + ': ' + mc['status'];
          }
        }
      }
    }

    clabsStateModalSetMsg(msg + status);
  }

  var clabsVmLastState = [];
  function buildAndShowClabsStateModal(clabs_data, start_state)
  {
    vms = clabs_data['vms'];

    data = '<table class="table table-first-column-check table-hover" style="margin-bottom:0px" border=1 frame=void rules=rows>';
    for (var i = 0; i < vms.length; i++)
    {
      vm = vms[i];
      data += '<tr id="vm_' + i + '" class="clabs-state-modal-tr-vm">';
      data += '<td class="clabs-state-modal-td-vm span4">';
      data += vm['name'];
      data += '</td>';
      data += '<td class="clabs-state-modal-td-state span4" id="clabs_modal_vm_state_' + i + '">';
      data += start_state + '&nbsp; <i id="clabs_modal_vm_spinner_' + i + '" class="icon-spin icon-spinner"></i>';
      data += '</td></tr>';
      clabsVmLastState.push(start_state);
    }
    data += '</table>';

    $('#clabsStateModal_body').show();
    $('#clabsStateModal_vms').html(data);
    $('#clabsStateModal_vms').show();
    $('#clabsStateModal_ta').hide();
    $("#clabsStateModal").css('height', 'auto');
    $('#clabsStateModal').modal();
  }

  var clabsChangeStateTimer = null;
  function changeClabsState(ctrl, printState, spinner, chkCounter)
  {
    clearTimeout(clabsChangeStateTimer);

    if (chkCounter == 0)
    {
      op = (ctrl == "Stop") ? 'endclabs' : 'launchclabs';
      $.ajax({
      url: "../util/vcput.php?a=" + op + "&stepid=121096&version=0&version=0",
      })
      .done(function(ret_val) 
       {
         showEmptyClabsStateModal();
         console.log(ret_val);
         try 
         {
           var result = JSON.parse(ret_val);
           if (result['status'] != 'success')
           {
             clabsStateModalSetMsg('Failed to ' + ctrl + ' your lab. If the problem persists, please report to support@vocareum.com for assistance.');
             spinner.hide();
           }
           else 
           {
             clabsChangeStateTimer = setTimeout(changeClabsState, 100, ctrl, printState, spinner, 1);
           }
         }
         catch(err) 
         {
           clabsStateModalSetMsg('Exception changing state of lab1: ' + err);
           spinner.hide();
         }
       })
       .fail(function(data, textStatus, jqXHR)
       {
         clabsStateModalSetMsg("Failed to get lab1 information");
         spinner.hide();
       });
    }
    else
    {
      var jqxhr = $.ajax("../util/vcput.php?a=vcGetLabInfo&stepid=121096&version=0")
        .done(function(data, textStatus, jqXHR)
        {
          try 
          {
            console.log(data);
            var result = JSON.parse(data);
            if (result['status'] == 'Error')
            {
              clabsStateModalSetMsg("Could not get lab information: " + result['msg']);
              spinner.hide();
            }
            else
            {
              clabsStateData = result;
              if (chkCounter == 1)
              {
                buildAndShowClabsStateModal(result, printState);
                clabsChangeStateTimer = setTimeout(changeClabsState, 1000, ctrl, printState, spinner, chkCounter + 1);
              }
              else
              {
                // check the state - if we've reached a good final state, all done
              
                state = result['lab_state'];
                status = result['lab_status']

                // let's first update all the vm individual states
                vms = result['vms'];
                for (var i = 0; i < vms.length; i++)
                {
                  vm = vms[i];
                  st = vm['state'];
                  if (st != clabsVmLastState[i])
                  {
                    var msg = st;
	            if (  (st != "Ready")
                       && (st != "Stopped")
                       && (st != "Terminated")
                       && (st != "Failed") )
                    {
                      msg += '&nbsp; <i id="clabs_modal_vm_spinner_' + i + '" class="icon-spin icon-spinner"></i>';
                    }
                    $('#clabs_modal_vm_state_' + i).html(msg);
                    clabsVmLastState[i] = st;
                  }
                }

                if (state == "Failed")
                {
                  msg = 'Failed to launch lab';
                  if (status != "")
                  {
                    msg += ": " + status;
                  }
                  clabsStateModalSetFinalState('Failed', msg);
                  spinner.hide();
                }
                else if (  (ctrl == "Stop")
                        && ( (state == "None")
                          || (state == "Stopped")
                          || (state == "Terminated") ) )
                {
                  // done!!
                  var print_state = state;
                  if (state == "None")
                  {
                    print_state = "Stopped";
                  }
                  clabsStateModalSetFinalState(state, 'Your lab is now ' + print_state);
                  spinner.hide();
                  awslabtimer(''); // end-timer
                }
                else if (ctrl == "Start")
                {
                  if (state == "Ready")
                  {
                    // done!!
                    cdbtime(result);
                    clabsStateModalSetFinalState(state, 'Your lab is now ' + state + '. The session time is ' + awsscnt + ' seconds (' + Math.ceil(awsscnt/60) + ' minutes)');
                    spinner.hide();
                  }
                  else if ( (state == "Stopped")
                         || (state == "Terminated") )
                  {
                    // something went wrong
                    msg = 'Please re-launch your lab';
                    if (status != "")
                    {
                      msg += ": " + status;
                    }
                    clabsStateModalSetFinalState(state, msg);
                    spinner.hide();
                  }
                  else
                  {
                    clabsChangeStateTimer = setTimeout(changeClabsState, 1000, ctrl, printState, spinner, chkCounter + 1);
                  }
                }
                else
                {
                  clabsChangeStateTimer = setTimeout(changeClabsState, 1000, ctrl, printState, spinner, chkCounter + 1);
                }
              }
            }
          }
          catch(err)
          {
            console.log("Exception: " + err);
            clabsStateModalSetMsg('Exception stopping lab2: ' + err);
            spinner.hide();
          }
        })
        .fail(function(data, textStatus, jqXHR)
        {
          clabsStateModalSetMsg("Failed to get lab2 information");
          spinner.hide();
        });
    }
  }

  function endclabs_confirmed(ischk)
  {
    if (true) {
      changeClabsState("Stop", 'Shutting down', $('#endclabspinbox'), ischk);
    }
    else {
      endclabs_confirmed_1(ischk);
    }
  }

  var endclabshandle = null;
  function endclabs_confirmed_1(ischk) {
    clearTimeout(endclabshandle);
    if (! ischk) $('#endclabspinbox').show();

    $.ajax({
      url: "../util/vcput.php?a=" + (ischk? 'stateclabs' : 'endclabs') + "&stepid=121096&version=0",
    })
     .done(function(ret_val) {
       console.log(ret_val);
       try {
         var result = JSON.parse(ret_val);
         if (!ischk) {
           if (result['status'] != 'success') {
             $('#endclabspinbox').hide();
             var target = document.getElementById("report_clabs_msg_box");
             target.innerHTML = '<br>Failed to end your lab. If the problem persists, please report to support@vocareum.com for assistance.';
             $('#modal-table-report-clabs').modal('show');
           }
           else {
             clabshandle = setTimeout(function() { endclabs_confirmed(1); }, 1000);
           }
         } else {
           if (   (result['state'] == "None")
               || (result['state'] == "Stopped")
               || (result['state'] == "Terminated") ) {
             $('#endclabspinbox').hide();
             var target = document.getElementById("report_clabs_msg_box");
             target.innerHTML = '<br>Your lab has been stopped.';
             $('#modal-table-report-clabs').modal('show');
             awslabtimer(''); // end-timer
           } else {
             clabshandle = setTimeout(function() { endclabs_confirmed(1); }, 1000);
           }
         }
       }
       catch(err) {
         $('#endclabspinbox').hide();
         var target = document.getElementById("report_clabs_msg_box");
         target.innerHTML = '<br>Exception stopping lab: ' + err;
         $('#modal-table-report-clabs').modal('show');
       }
     })
     .fail(function(ret_val) {
       $('#endclabspinbox').hide();
       var target = document.getElementById("report_clabs_msg_box");
       target.innerHTML = '<br>Failed to end Lab.';
       $('#modal-table-report-clabs').modal('show');
     });
  }

  function endclabs_question(str){
    bootbox.dialog(str,
         [
           {
             "label" : "Yes",
             "class" : "btn vocbtn-ac vocbtn-action",
             "callback": function() {
               endclabs_confirmed(0);
             }
           },
           {
             "label" : "No",
             "class" : "btn vocbtn-ac vocbtn-status",
             "callback": function() {
               $('#endclabspinbox').hide();
             }
           }
         ]);
  }
  function endclabs_note(str){
    bootbox.dialog(str,
         [
           {
             "label" : "Close",
             "class" : "btn vocbtn-ac vocbtn-action",
             "callback": function() {
               $('#endclabspinbox').hide();
             }
           }
         ]);
  }
  function launchclabs_note(str){
    bootbox.dialog(str,
         [
           {
             "label" : "Close",
             "class" : "btn vocbtn-ac vocbtn-action",
             "callback": function() {
               $('#labspinbox').hide();
             }
           }
         ]);
  }
  function launchclabs_question(str){
    bootbox.dialog(str,
         [
           {
             "label" : "Yes",
             "class" : "btn vocbtn-ac vocbtn-action",
             "callback": function() {
               launchclabs_confirmed(0);
             }
           },
           {
             "label" : "No",
             "class" : "btn vocbtn-ac vocbtn-status",
             "callback": function() {
               $('#labspinbox').hide();
             }
           }
         ]);
  }
  function endclabs(){
    $('#endclabspinbox').show();
    $.ajax({
        url: "../util/vcput.php?a=getclabs&stepid=121096&version=0",
     })
     .done(function(ret_val) {
         var resp;
         var target = document.getElementById("report_clabs_msg_box");
         try {
           resp = jQuery.parseJSON(ret_val);
           if( resp.status=='Ready' || resp.status=='stopped' ){
             endclabs_question('Are you sure you want to end the following? <br><br>' + resp.message + '<br>');
           } else {
             endclabs_note('Your lab has not started yet.');
           }
         } catch(err) {
           endclabs_note('Your lab has not started yet.');
         }
      })
     .fail(function(ret_val) {
       alert('failed to retrieve Labs credentials, report this problem to support@vocareum.com if the problem persists.');
       $('#labspinbox').hide();
     });
  }
  function launchclabs(){
    $('#labspinbox').show();
    $.ajax({
        url: "../util/vcput.php?a=getclabs&stepid=121096&version=0",
     })
     .done(function(ret_val) {
         var resp;
         var target = document.getElementById("report_clabs_msg_box");
         try {
           resp = jQuery.parseJSON(ret_val);
           if( resp.status=='Ready' ){
             if (true) {
               launchclabs_confirmed(0);
             } else {
               launchclabs_question('Are you sure you want to launch a new lab? When you launch a new lab, the earlier one shown below will be terminated and its content will be deleted completely.<br><br>' + resp.message + '<br>');
             }
           } else {
             launchclabs_confirmed(0);
           }
         } catch(err) {
           launchclabs_confirmed(0); 
         }
      })
     .fail(function(ret_val) {
       alert('failed to retrieve Labs credentials, report this problem to support@vocareum.com if the problem persists.');
       $('#labspinbox').hide();
     });
  }

  // set the cookie for the web stuff
  var str;
  if (true)
  {
    str = "domain_latestWebProxy" + "=" + "https://proxy.vocareum.com/hostip/172.31.19.103:5000/vocproxy/1838581686460852460852121096015ea014c1c024c8.14590148" + "; path=/" + "; domain=vocareum.com";
  }
  // else
  // {
  //   str = "domain_latestWebProxy" + "=" + "expired" + "; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT" + "; domain=vocareum.com";
  // }
  document.cookie = str;
  
  function vocWebSocket() {
    // should we have our own class and wait for server connection?
    var url = "wss://services.vocareum.com";
    var ws = new WebSocket(url + "/xfer/" + "" + "/client");
    // var ws = new WebSocket("ws://jag.vocareum.com:8088/xfer/" + "" + "/client");
    return ws;
  }

  function vocWebSocketUrl() {
    var baseUrl = "wss://services.vocareum.com";
    var fullUrl = baseUrl + "/xfer/" + "" + "/client";
    return fullUrl;
  }

  function vocProxyShowErrMsg(msg) {
    bootbox.dialog(msg, 
                   [{
                     "label" : "Ok",
                     "class" : "btn vocbtn-ac vocbtn-action",
                    }]
    );
  }
  
  function vocProxyGetWsUrl() {
    url = "wss://proxy.vocareum.com/hostip/172.31.19.103:5000/vocproxy/1838581686460852460852121096015ea014c1c024c8.14590148";
    console.log("Proxy URL: " + url);
    return url;
  }

  function vocProxyWebSocket() {
    if (false)
    {
      vocProxyShowErrMsg("Error: proxy setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    var url = vocProxyGetWsUrl();
    var ws = new WebSocket(url);
    // Note: this error callback may be overridden by calling code
    //       in that case, it is up to that code to handle the error appropriately
    ws.onerror = function() {
      vocProxyShowErrMsg("Error: WebSocket connection closed due to error - is your WebSocket server running?<br><br>If it is running (and listening on the correct port) and a page reload does not resolve it, please contact Vocareum Technical Support");
    };
    return ws;
  }

  function vocProxyWebSocketUrl() {
    if (false)
    {
      vocProxyShowErrMsg("Error: proxy setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    return vocProxyGetWsUrl();
  }

  function vocProxyWebUrl() {
    if (false)
    {
      vocProxyShowErrMsg("Error: proxy setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    url = "https://proxy.vocareum.com/hostip/172.31.19.103:5000/vocproxy/1838581686460852460852121096015ea014c1c024c8.14590148";
    console.log("Proxy URL: " + url);
    return url;
  }

  function vocCommShowErrMsg(msg) {
    vocProxyShowErrMsg(msg);
  }
  function vocCommGetWsUrl() {
    url = "wss://proxy.vocareum.com/hostip//voccomm/";
    console.log("Proxy URL: " + url);
    return url;
  }
  function vocCommWebSocket(type) {
    if (true)
    {
      vocCommShowErrMsg("Error: comm channel setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    var url = vocCommGetWsUrl();
    var ws = new WebSocket(url + "/" + type + "?vocmsgs=1");
    // Note: this error callback may be overridden by calling code
    //       in that case, it is up to that code to handle the error appropriately
    ws.onerror = function() {
      vocCommShowErrMsg("Error: WebSocket connection closed due to error - if a page reload does not resolve it, please contact Vocareum Technical Support");
    };
    return ws;
  }
  function vocCommWebSocketUrl() {
    if (true)
    {
      vocCommShowErrMsg("Error: comm channel setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    return vocCommGetWsUrl();
  }

  var imageBuildModalDotTimer;
  var checkImageBuildTimer;
  var vocBuildImages = null;
  var vocImageBuildNew = true;

  var lastImageName = "";
  var lastBaseImage = null;
  var lastDockerFile = "";

  var savedBuildAccessElements = document.createElement("div");
  var savedBuildAccessActualElement = document.createElement("div");

  function imageBuildClearAccessOptions(saveFirst)
  {
    // remove all .image-build-access - except the first one
    // remove the first .image-build-access-actual

    var currentAccessElements = document.getElementsByClassName("image-build-access");
    for (var i = currentAccessElements.length - 1; i > 0; i--)
    {
      if (saveFirst)
      {
        savedBuildAccessElements.appendChild(currentAccessElements[i]);
      }
      else
      {
        currentAccessElements[i].remove();
      }
    }

    var currentActualAccessElements = document.getElementsByClassName("image-build-access-actual");
    if (currentActualAccessElements.length > 0)
    {
      if (saveFirst)
      {
        savedBuildAccessActualElement.appendChild(currentActualAccessElements[0]);
      }
      else
      {
        currentActualAccessElements[0].remove();
      }
    }
  }

  function imageBuildRestoreAccessOptions()
  {
    if (savedBuildAccessActualElement.children.length > 0)
    {
      document.getElementById("image_build_access_0").appendChild(savedBuildAccessActualElement.firstChild);

      if (savedBuildAccessElements.children.length > 0)
      {
        var parent = document.getElementById("imageBuildModal_body");
        // remember - we stored the access elements in reverse order
        var currentAccessElements = savedBuildAccessElements.children;
        for (var i = currentAccessElements.length - 1; i >=0; i--)
        {
          parent.appendChild(currentAccessElements[i]);
        }
      }
    }
  }

  function getContainerImageFromNameVal(name, val)
  {
    if ('vocareum' in vocBuildImages) {
      ib = vocBuildImages['vocareum'];
      for (var key in ib) {
        if (ib.hasOwnProperty(key)) {
          img = ib[key];
          if ((img.name == name) && (img.image == val))
          {
            return img;
          }
        }
      }
    }

    return false;
  }

  function imageBaseOptionSelected(target)
  {
    var name = target.options[target.selectedIndex].text;
    var value = target.options[target.selectedIndex].value;

    lastBaseImage = value;
    imageBuildClearAccessOptions(false);

    img = getContainerImageFromNameVal(name, value);
    if (img.access)
    {
      try
      {
        var access = JSON.parse(img.access);
        for (var i = 0; i < access.length; i++)
        {
          var acc = access[i];
          var newIndx = addContainerImageAccess();
          document.getElementById("image_build_access_name_" + newIndx).value = acc.name;
          document.getElementById("image_build_access_port_" + newIndx).value = acc.port;
          document.getElementById("image_build_access_type_select_" + newIndx).value = acc.type;
        }
      }
      catch (err)
      {
        alert("Failed to parse access data: " + img.access)
      }
    }
  }

  function imageBuildOptionSelected(target)
  {
    console.log(target.value);

    if (target.value in vocBuildImages['course'])
    {
      // first remove all the existing "access" stuff
      // if (prevSelectionWasNew - vocImageBuildNew?) -> save it

      if (vocImageBuildNew)
      {
        // previous value was "new"
        imageBuildClearAccessOptions(true);
        lastImageName = document.getElementById('image_build_name').value;
        lastBaseImage = document.getElementById("imageBuildModal_select_baseimage").value;
        lastDockerFile = document.getElementById('image_build_dockerfile').value;
        vocImageBuildNew = false;
        
      }
      else
      {
        imageBuildClearAccessOptions(false);
      }  

      img = vocBuildImages['course'][target.value];
      
      $('#image_build_name').val(img.name);
      $('#image_build_name_div').hide();

      $('#image_build_dockerfile').val(img.dockerfile);
      document.getElementById("imageBuildModal_select_baseimage").value = img.baseimage;

      if (img.access)
      {
        try
        {
          var access = JSON.parse(img.access);
          for (var i = 0; i < access.length; i++)
          {
            var acc = access[i];
            var newIndx = addContainerImageAccess();
            document.getElementById("image_build_access_name_" + newIndx).value = acc.name;
            document.getElementById("image_build_access_port_" + newIndx).value = acc.port;
            document.getElementById("image_build_access_type_select_" + newIndx).value = acc.type;
          }
        }
        catch (err)
        {
          alert("Failed to parse access data: " + img.access)
        }
      }

      $('#imageBuildModal_ta').text("retrieving last build log...");
      $('#imageBuildModal_ta').show();
      getImageBuildLog(img.dockerfile, false);
    }
    else
    {
      vocImageBuildNew = true;
      $('#image_build_name_div').show();
      $('#image_build_name').val(lastImageName);
      $('#image_build_dockerfile').val(lastDockerFile);
      $("#imageBuildModal_select_baseimage").val(lastBaseImage);
      $('#imageBuildModal_ta').text("");
      $('#imageBuildModal_ta').hide();
      // for the access elements, first clear everthing and then add back if we've saved anything
      imageBuildClearAccessOptions(false);
      imageBuildRestoreAccessOptions();
    }
  }

  function isEmpty(obj) {
    for (var key in obj) {
      if (obj.hasOwnProperty(key)) {
        return false;
      }
      return true;
    }
  }
  function getImageBuildLog(dockerFile, scrollIt)
  {
    // can now build again
    $('#imageBuildModal_build').show();
    // also re-retrieve image list coz we probably added a new one - in that case scrollIt will be true
    if (scrollIt)
    {
      prepareBuildImageModal(true);
    }
    
    var target = document.getElementById('imageBuildModal_ta');
    var jqxhr = $.ajax('../util/vcput.php?a=checklab_nocfgchk'
                     + '&stepid=' + 121096                     + '&mode=' + 's'
                     + '&ownerid=' + 460852                     + '&init=' + dockerFile)
                 .done(function(data, textStatus, jqXHR) {
                   console.log(data);
                   try {
                     var result = JSON.parse(data);
                     if (result['status'] == 'not built') {
                       msg = 'Status: not built<br>Init file:' + dockerFile + '<br>' + result['message'];
                     } else if (result.status =='error'){
                       msg = 'Status: failed<br>' + 'Init file:' + dockerFile + '<br>' + 'Built at ' + result['time'] + '<br>' + result['message'];
                     } else if (result['status'] == 'building') {
                       msg = 'Status: in progress<br>' + 'Init file:' + dockerFile + '<br>' + 'Started at ' + result['time'] + '<br>' + result['message'];
                     } else if (result['status'] == 'success') {
                       msg = 'Status: completed<br>' + 'Init file:' + dockerFile + '<br>' + 'Built at ' + result['time'] + '<br>' + result['message']
                           + '<br>' + 'Status: completed<br>';
                     } else {
                       msg = 'Internal error, report this to support.vocareum.com<br>' + 'Init file: ' + dockerFile;
                     }
                     target.innerHTML = msg;
                     if (scrollIt) {
                       $("#imageBuildModal_ta").animate({
                         scrollTop:$("#imageBuildModal_ta")[0].scrollHeight - $("#imageBuildModal_ta").height()
                       },1000);
                     }
                   }
                   catch (err) {
                     var htm = target.innerHTML;
                     target.innerHTML = htm + '<br>' + 'Error: Exception retrieving image build log: ' + err;
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   var htm = target.innerHTML;
                   target.innerHTML = htm + '<br>' + 'Error retrieving image build log';
                 });
  }

  function checkImageBuild(dockerFile)
  {
    var blds = [];
    blds.push(dockerFile);
    var jqxhr = $.ajax('../util/vcput.php?a=chkbld'
                     + '&stepid=' + 121096                     + '&mode=' + 's'
                     + '&ownerid=' + 460852                     + '&files=' + JSON.stringify(blds))
                 .done(function(data, textStatus, jqXHR) {
                   console.log("CHK DONE");
                   try {
                     console.log(data);
                     var resultAll = JSON.parse(data);
                     var result = resultAll[0];
                     if (result['status'] == 'error') {
                       clearTimeout(imageBuildModalDotTimer);
                       $('#imageBuildModal_ta').text("Build Error");
                       getImageBuildLog(dockerFile, true);
                     }
                     else if (result['status'] == 'success') {
                       clearTimeout(imageBuildModalDotTimer);
                       $('#imageBuildModal_ta').text(result['status']);
                       getImageBuildLog(dockerFile, true);
                     }
                     else if (result['status'] != 'building') {
                       $('#imageBuildModal_ta').text(data); // should never really happen
                     }
                     else {
                       // building
                       checkImageBuildTimer = setTimeout(checkImageBuild, 3000, dockerFile);
                     }
                   }
                   catch (err) {
                     clearTimeout(imageBuildModalDotTimer);
                     $('#imageBuildModal_ta').text('Error: Exception retrieving image build status: ' + err);
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   clearTimeout(imageBuildModalDotTimer);
                   $('#imageBuildModal_ta').text('Failure retrieving image build status');
                   console.log("CHK FAILED");
                 });
  }

  function imageBuildModalModalDots()
  {
    text = $('#imageBuildModal_ta').text();
    $('#imageBuildModal_ta').text(text + '.');
    imageBuildModalDotTimer = setTimeout(imageBuildModalModalDots, 1000);
  }

  var firsTimeShowingImageModal = true;

  function showBuildImageModal()
  {
    console.log(vocBuildImages);

    // setup the select
    // if image_name is set, we'll try to find it in this select - if found, set selected
    // otherwise select "create new image"
    var imageBuildName = $('#image_build_name').val();
    console.log("image build name: " + imageBuildName);
    var foundSelected = false;

    var data = '';
    data += '<select id="imageBuildModal_select" name="imageBuildModal_select" style="width:100%; margin-bottom:0px" onchange="imageBuildOptionSelected(this)" >';

    data += '<option value="0">Create new image</option>';

    // data += '<option selected disabled hidden>Select image</option>';

    // images built in this course
    if ('course' in vocBuildImages) {
      ic = vocBuildImages['course'];
      if (Object.keys(ic).length > 0) {
        data += '<optgroup label="Use existing image">';
        for (var key in ic) {
          if (ic.hasOwnProperty(key)) {
            img = ic[key];
            // console.log(img);
            if (imageBuildName == img.name) {
              data += '<option selected value=' + img.name + '>' + img.name + '</option>';
              foundSelected = img;
            } else {
              data += '<option value=' + img.name + '>' + img.name + '</option>';
            }
          }
        }
        data += '</optgroup>';
      }
    }

    $('#imageBuildModal_select_div').html(data);

    if (foundSelected)
    {
      // no need to show the name div
      $('#image_build_name_div').hide();
    }

    // select-base
    data = '';
    data += '<select id="imageBuildModal_select_baseimage" name="imageBuildModal_select_baseimage" style="width:100%; margin-bottom:0px"  onchange="imageBaseOptionSelected(this)">';
    var foundSelectedBaseImage = false;
    if ('vocareum' in vocBuildImages) {
      ib = vocBuildImages['vocareum'];
      for (var key in ib) {
        if (ib.hasOwnProperty(key)) {
          var dumpedIt = false;
          img = ib[key];
          if (foundSelected) {
            if (foundSelected.baseimage == img.image) {
              data += '<option selected value=' + img.image + '>' + img.name + '</option>';
              foundSelectedBaseImage = img;
              dumpedIt = true;
            }
          }
          else {
            if (lastBaseImage == img.image) {
              data += '<option selected value=' + img.image + '>' + img.name + '</option>';
              foundSelectedBaseImage = img;
              dumpedIt = true;
            }
          }
          if (dumpedIt == false) {
            data += '<option value=' + img.image + '>' + img.name + '</option>';
          }
        }
      }
    }

    data += '</select>';

    $('#imageBuildModal_select_baseimage_div').html(data);

    if (foundSelectedBaseImage == false)
    {
      $("#imageBuildModal_select_baseimage").prop("selectedIndex", -1);
    }

    if (firsTimeShowingImageModal)
    {
      $('#imageBuildModal_ok').hide();
      $('#imageBuildModal_cancel').show();
    }
    else
    {
      // whatever is set is fine
    }
    $('#imageBuildModal_build').show();

    // $('#imageBuildModal_ta').hide();
    $("#imageBuildModal").css('height', 'auto');
    $('#imageBuildModal').modal();

    firsTimeShowingImageModal = false;
  }

  function prepareBuildImageModal(showModal)
  {
    var jqxhr = $.ajax('../util/vcput.php?a=getImages'
                     + '&stepid=' + 121096                     + '&mode=' + 's'
                     + '&ownerid=' + 460852)
                 .done(function(data, textStatus, jqXHR) {
                   try {
                     console.log(data);
                     var result = JSON.parse(data);
                     if (result['status'] == 'error') {
                       alert('Error getting image list: ' + result['message']);
                     }
                     else {
                       if (typeof result['images'] === 'undefined') {
                         alert('Error: no image list found');
                       }
                       else {
                         vocBuildImages = result['images'];
                         if (showModal) {
                           showBuildImageModal();
                         }
                       }
                     }
                   }
                   catch (err) {
                     alert('Error: Exception getting image list: ' + err);
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   alert('Error: Failure getting image list');
                 });
  }

  function buildContainerImage()
  {
    var imageName = document.getElementById('image_build_name').value.trim();
    var dockerFile = document.getElementById('image_build_dockerfile').value.trim();

    if (imageName === "")
    {
      alert("The image name needs to be set");
      return;
    }
    if (dockerFile === "")
    {
      alert("The docker file name needs to be set");
      return;
    }

    var currentAccessActualElements = document.getElementsByClassName("image-build-access-actual");
    var accessArray = [];
    for (var i = 0; i < currentAccessActualElements.length; i++)
    {
      var id = currentAccessActualElements[i].dataset.id;
      var name = document.getElementById("image_build_access_name_" + id).value.trim();
      var port = document.getElementById("image_build_access_port_" + id).value.trim();
      var e = document.getElementById("image_build_access_type_select_" + id);
      var type = e.options[e.selectedIndex].text;
      console.log("ACCESS " + id + " : " + name + " / " + type + " / " + port);
      if ((name === "") || (port === "") || (type == 0))
      {
        alert("At least one access type definition is incomplete; please set all the fields or delete the row");
        return;
      }
      if (! (/^\d+$/.test(port)))
      {
        alert("Port numbers need to be positive integers; please fix the incorrect port value: " + port);
        return;
      }
      // accessArray.push({ "name" : name, "type" : type, "port" : port });
      var arr = {};
      arr["name"] = name;
      arr["type"] = type;
      arr["port"] = port;
      accessArray.push(arr);
    }
    
    // right now we don't give users a choice - since we always start from our base
    var userArray = {};
    userArray["user"] = "labsuser";
    userArray["suser"] = "labsadmin";
    userArray["sysuser"] = "";

    var mountsArray = {};

    // if this is a supposed to be a new image, make sure that it does not already exist
    if (vocImageBuildNew)
    {
      if (vocBuildImages) {
        if ('course' in vocBuildImages) {
          if (imageName in vocBuildImages['course']) {
            alert("An image with this name '" + imageName + "' already exists; please select a new unique name");
            return;
          }
        }
      }
    }
    var imageSelVal = document.getElementById('imageBuildModal_select_baseimage').value.trim();

    $('#imageBuildModal_ok').show();
    $('#imageBuildModal_cancel').hide();
    $('#imageBuildModal_build').hide();
    $('#imageBuildModal_ta').text("building..."); // "Building image.");
    $('#imageBuildModal_ta').show();
    $("#imageBuildModal").animate({ scrollTop: $('#imageBuildModal').prop("scrollHeight")}, 1000);
    // imageBuildModalDotTimer = setTimeout(imageBuildModalModalDots, 1000);

    var jqxhr = $.ajax({
      type: 'POST',
      url: '../util/vcput.php?a=buildImage&stepid=121096&version=0&mode=s',
      data: {
        baseimage: imageSelVal,
        imagename: imageName,
        dockerfile: dockerFile,
        access: JSON.stringify(accessArray),
        users: JSON.stringify(userArray),
        mounts: JSON.stringify(mountsArray)
      }
    })
    .done(function(data, textStatus, jqXHR) {
      try {
        console.log(data);
        var result = JSON.parse(data);
        if (result['status'] == 'error') {
          $('#imageBuildModal_ta').text('Error: ' + result['message']);
          // put Cancel/Build back
          $('#imageBuildModal_ok').hide();
          $('#imageBuildModal_cancel').show();
          $('#imageBuildModal_build').show();
        }
        else {
          if (result['status'] == 'building') {
            $('#imageBuildModal_ta').text("building...");
            imageBuildModalDotTimer = setTimeout(imageBuildModalModalDots, 1000);
            // need to periodically check the build status
            checkImageBuildTimer = setTimeout(checkImageBuild, 3000, dockerFile);
          }
          else {
            $('#imageBuildModal_ta').text(result['status']);
          }
          vocImageBuildNew = false;
        }
      }
      catch (err) {
        $('#imageBuildModal_ta').text('Error: Exception building image: ' + err);
        // put Cancel/Build back
        $('#imageBuildModal_ok').hide();
        $('#imageBuildModal_cancel').show();
        $('#imageBuildModal_build').show();
      }
    })
    .fail(function(data, textStatus, jqXHR) {
      console.log("BuldImage: Fail");
      $('#imageBuildModal_ta').text('Error: Build Image failed');
      // put Cancel/Build back
      $('#imageBuildModal_ok').hide();
      $('#imageBuildModal_cancel').show();
      $('#imageBuildModal_build').show();
    });
  }

  function deleteAccessContainerImage(e)
  {
    var target = e.target;
    var id = target.dataset.id;

    var firstBuildAccess = document.getElementById("image_build_access_0");

    var targetAncestor = target.closest('.image-build-access');

    var currentAccessElements = document.getElementsByClassName("image-build-access");

    if (targetAncestor != firstBuildAccess)
    {
      for (var i = 0; i < currentAccessElements.length; i++)
      {
        var el = currentAccessElements[i];
        if (el.dataset.id == id)
        {
          el.remove();
          break;
        }
      }
    }
    else
    {
      // remove the first one (image-build-access-actual) - but we need to then move the next ones (if any) up
      
      var actualAccessElement = targetAncestor.querySelector(".image-build-access-actual");
      actualAccessElement.remove();

      if (currentAccessElements.length > 1)
      {
        // get the first image-build-access-actual and append it to firstBuildAccess

        var imageModalBody = document.getElementById("imageBuildModal_body");
        var firstImageBuildAccessActual = imageModalBody.querySelector(".image-build-access-actual");
        var firstImageBuildAccessActualParent = firstImageBuildAccessActual.closest('.image-build-access');
        
        firstImageBuildAccessActual.classList.remove("offset3");
        firstBuildAccess.appendChild(firstImageBuildAccessActual);
        firstImageBuildAccessActualParent.remove();
      }
    }
  }

  function addContainerImageAccess()
  {
    var currentAccessElements = document.getElementsByClassName("image-build-access-actual");
    var myId = currentAccessElements.length;
    console.log("MY ID: " + myId);

    // myId == 0 => this is the first access type (inline with the "Access:" label)

    if (myId > 0)
    {
      var topDiv = document.createElement("div"); 
      topDiv.classList.add("control-group");
      topDiv.classList.add("row-fluid");
      topDiv.classList.add("image-build-access");
      // topDiv.setAttribute("name", "image_build_access");
      topDiv.setAttribute("id", "image_build_access_" + myId);
      topDiv.setAttribute('data-id', myId);
    }
    else
    {
      topDiv = document.getElementById("image_build_access_0");
    }

    middleDiv = document.createElement("div"); 
    middleDiv.classList.add("span4");
    middleDiv.classList.add("row-fluid");
    middleDiv.classList.add("image-build-access-actual");
    middleDiv.setAttribute('data-id', myId);
    // middleDiv.setAttribute("name", "image_build_access_actual");
    middleDiv.setAttribute("id", "image_build_access_actual_" + myId);
    if (myId > 0)
    {
      middleDiv.classList.add("offset3");
    }
    topDiv.appendChild(middleDiv);
    
    // name
    nameOuterDiv = document.createElement("div"); 
    nameOuterDiv.classList.add("span4");
    middleDiv.appendChild(nameOuterDiv);

    nameInnerDiv = document.createElement("div"); 
    nameInnerDiv.classList.add("span12");
    nameOuterDiv.appendChild(nameInnerDiv);

    input = document.createElement("input");
    input.className = "span12";
    input.setAttribute("id", "image_build_access_name_" + myId);
    input.setAttribute("placeholder", "name");
    input.setAttribute("type", "text");
    input.setAttribute("maxlength", "80");
    input.setAttribute('data-id', myId);
    input.style.marginBottom = "0px";
    nameInnerDiv.appendChild(input);

    // type
    typeOuterDiv = document.createElement("div"); 
    typeOuterDiv.classList.add("span4");
    middleDiv.appendChild(typeOuterDiv);

    typeInnerDiv = document.createElement("div"); 
    typeInnerDiv.classList.add("span12");
    typeOuterDiv.appendChild(typeInnerDiv);

    var select = document.createElement("select");
    select.style.width = "100%";
    select.style.marginBottom = "0px";
    select.setAttribute('data-id', myId);
    select.setAttribute("id", "image_build_access_type_select_" + myId);

    var op = new Option("Type", 0, true, true);
    op.disabled = true;
    op.hidden = true;
    select.appendChild(op);
          op = new Option("http", "http");
      select.appendChild(op);
    
    typeInnerDiv.appendChild(select);

    // port
    portOuterDiv = document.createElement("div"); 
    portOuterDiv.classList.add("span3");
    middleDiv.appendChild(portOuterDiv);

    portInnerDiv = document.createElement("div"); 
    portInnerDiv.classList.add("span12");
    portOuterDiv.appendChild(portInnerDiv);

    input = document.createElement("input");
    input.className = "span12";
    input.setAttribute("id", "image_build_access_port_" + myId);
    input.setAttribute("placeholder", "port");
    input.setAttribute("type", "text");
    input.setAttribute("maxlength", "80");
    input.setAttribute('data-id', myId);
    input.style.marginBottom = "0px";
    input.style.textAlign = "right";
    portInnerDiv.appendChild(input);

    // trash
    trashOuterDiv = document.createElement("div"); 
    trashOuterDiv.classList.add("span1");
    trashOuterDiv.classList.add("row-fluid");
    middleDiv.appendChild(trashOuterDiv);

    button = document.createElement("button");
    button.classList.add("icon-button");
    // button.setAttribute("id", myId);
    button.style.paddingTop = "8px";
    trashOuterDiv.appendChild(button);

    icon = document.createElement("i");
    icon.classList.add("icon-trash");
    // icon.classList.add("icon-large");
    icon.setAttribute('data-id', myId);
    icon.addEventListener('click', deleteAccessContainerImage);
    button.appendChild(icon);

    if (myId > 0)
    {
      parent = document.getElementById("imageBuildModal_body");
      parent.appendChild(topDiv);
    }

    // scroll up in case we added more access elements that can be displayed together
    $("#imageBuildModal_body").animate({
      scrollTop:$("#imageBuildModal_body")[0].scrollHeight - $("#imageBuildModal_body").height()
    },100);

    return myId;
  }

  // from:https://github.com/jserz/js_piece/blob/master/DOM/ChildNode/remove()/remove().md
  // node.remove polyfill for IE
  (function (arr) {
    arr.forEach(function (item) {
      if (item.hasOwnProperty('remove')) {
        return;
      }
      Object.defineProperty(item, 'remove', {
        configurable: true,
        enumerable: true,
        writable: true,
        value: function remove() {
          if (this.parentNode === null) {
            return;
          }
          this.parentNode.removeChild(this);
        }
      });
    });
  })([Element.prototype, CharacterData.prototype, DocumentType.prototype]);

</script>
  


	


	
	

	

<link rel="stylesheet" href="./prova Html_files/codemirror.css">
<script src="./prova Html_files/codemirror.js.download"></script>

<script src="./prova Html_files/clike.js.download"></script>
<script src="./prova Html_files/xml.js.download"></script>
<script src="./prova Html_files/python.js.download"></script>
<script src="./prova Html_files/php.js.download"></script>

<script src="./prova Html_files/markdown.js.download"></script>
<script src="./prova Html_files/gfm.js.download"></script>
<script src="./prova Html_files/overlay.js.download"></script>

<link rel="stylesheet" href="./prova Html_files/neat.css">

<script src="./prova Html_files/javascript.js.download"></script>
<!-- removed from later versions
<script src="../shared/codemirror-5.25.2/keymap/extra.js"></script> 
-->
<script src="./prova Html_files/active-line.js.download"></script>
<script src="./prova Html_files/matchbrackets.js.download"></script>

<script src="./prova Html_files/closebrackets.js.download"></script>
<script src="./prova Html_files/closetag.js.download"></script>


<script src="./prova Html_files/diff_match_patch.js.download"></script>
<script src="./prova Html_files/merge.js.download"></script>
<link rel="stylesheet" href="./prova Html_files/merge.css">




<script src="./prova Html_files/css.js.download"></script>
<script src="./prova Html_files/sql.js.download"></script>

<link rel="stylesheet" href="./prova Html_files/show-hint.css">
<script src="./prova Html_files/show-hint.js.download"></script>
<script src="./prova Html_files/javascript-hint.js.download"></script>
<script src="./prova Html_files/html-hint.js.download"></script>
<script src="./prova Html_files/xml-hint.js.download"></script>
<script src="./prova Html_files/sql-hint.js.download"></script>
<script src="./prova Html_files/css-hint.js.download"></script>

<style type="text/css">

.breadcrumbs {
    z-index: 999 !important;
}

.content pre {
    padding: 5px 0px !important;
    margin: 0px 0px 4px !important;
    line-height: 15px !important;
    border: none !important;
    font-size: 12px !important;
    background: transparent !important;    
}

div:-webkit-full-screen {
  width: 100% !important;
  background-color: white;
}
div:-moz-full-screen {
  width: 100% !important;
  background-color: white;
}
div:-ms-fullscreen {
  width: 100% !important;
  background-color: white;
}
div:fullscreen {
  width: 100% !important;
  background-color: white;
}

/* While in fullscreen, hide any children with class 'tohide' */
:-webkit-full-screen .tohide {
  display: none;
}
:-moz-full-screen .tohide {
  display: none;
}
:-ms-fullscreen .tohide {
  display: none;
}
:fullscreen .tohide {
  display: none;
}

         


#page-content {
    position: absolute;
    left: 0;
    right: 0;
    top: 45px;
    bottom: 10px;
    background-color: white;
}

#page-content > div,
#page-content #editorbox,
#page-content #editordiv,
#page-content #editordiv > div,
#page-content #editordiv .tab-content #filelisting .widget-box,
#page-content #editordiv .tab-content #filelisting .widget-box .widget-body,

#page-content #editordiv #editorTabs,

#page-content #editordiv .tab-content,

#page-content #editordiv .tab-content #filelisting {
    height: 100%;
    overflow: auto;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box; 
}

#page-content #editordiv .tab-content #filelisting .widget-box {
    margin: 0;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}

#page-content #editordiv .tab-content #codeframe,
#page-content #editordiv .tab-content #buildframe,
#page-content #editordiv .tab-content #htmlframe,
#page-content #editordiv .tab-content #terminalframe
#page-content #editordiv .tab-content #gradeframe
{
    height: 100%;
    position: relative;
    overflow: hidden;
}

#page-content #editordiv .tab-content #htmlframe
{
    background-color: white;
}


#page-content #editordiv .tab-content #codeframe #codeform0,
#page-content #editordiv .tab-content #htmlframe #div_htmlframe,
#page-content #editordiv .tab-content #buildframe #buildtextarea {
    position: absolute;
    top: 1px;
    bottom: 0;
    left: 4px;
    right: 4px;
}



.CodeMirror {
    font-size: 13px;
    border: 1px solid #eee;
    width: auto;
    height: 100%;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}

.CodeMirror-scroll {
  overflow-y: auto;
  overflow-x: auto;
  margin-bottom: -10px !important;
  padding-bottom: 10px !important;
}


.CodeMirror-linenumber {
  color: #000 !important;
}

.CodeMirror-hints, .CodeMirror-hint, .CodeMirror-hint-active { 
    z-index:2147483647 !important;
}

#buildtextarea {
	background-color: white;
    overflow: auto;
    border: 1px solid light-gray;
    padding: 5px;
    margin-bottom: 0;
}

.tree {
  font-size: 12px;
}

.tree .tree-selected > [class*="icon-"]:first-child {
  color: 0 !important;
}

#video-viewer-modal {
    height: 80% !important;
}

#image-viewer-modal {
    height: 80% !important;
}

#gallery-viewer-modal {
    height: 80% !important;
}

#image-viewer-modal .modal-body {
    max-height: none;
    position: absolute;
    left: 0;
    right: 0;
    top: 40px;
    bottom: 0;
}

#image-viewer-modal .modal-body table,
#image-viewer-modal .modal-body table tbody,
#image-viewer-modal .modal-body table tbody td {
    height: 100%;
    width: 100%;
}

#image-viewer-modal .modal-body table tbody td {
    text-align: center;
}

#image-viewer-modal .modal-body img {
    max-height: 100%;
    max-width: 100%;
}

.modal-80percent {
    height: 80% !important;
}

#other-viewer-modal {
    height: 80%;
}

#other-viewer-modal .modal-body {
    max-height: none;
    position: absolute;
    left: 0;
    right: 0;
    top: 40px;
    bottom: 0;
}

#other-viewer-modal .modal-body table,
#other-viewer-modal .modal-body table tbody,
#other-viewer-modal .modal-body table tbody td {
    height: 100%;
    width: 100%;
}

#other-viewer-modal .modal-body table tbody td {
    text-align: center;
}

#other-viewer-modal .modal-body img {
    max-height: 100%;
    max-width: 100%;
}


#modal-table-widgetoutput {
    height: 80%;
}

#modal-table-widgetoutput .modal-body {
    max-height: none;
    position: absolute;
    left: 0;
    right: 0;
    top: 40px;
    bottom: 0;
}

#modal-table-widgetoutput .modal-body table,
#modal-table-widgetoutput .modal-body table tbody,
#modal-table-widgetoutput .modal-body table tbody td {
    height: 100%;
    width: 100%;
}

#modal-table-widgetoutput .modal-body table tbody td {
    text-align: center;
}

#modal-table-widgetoutput .modal-body img {
    max-height: 100%;
    max-width: 100%;
}

.widgetoutput pre {
    padding: 5px 0px !important;
    margin: 0px 0px 4px !important;
    line-height: 15px !important;
    border: none !important;
    font-size: 12px !important;
    background: transparent !important;    
}




#browser-viewer-modal {
    height: 80% !important;
}

#modal-upload-wait {
    height: 80% !important;
}

#modal-git-wait {
    height: 60% !important;
    width : 60% !important;
}

#browser-viewer-modal .modal-body {
    max-height: none;
    position: absolute;
    padding: 0px;
    left: 0;
    right: 0;
    top: 38px;
    bottom: 0;
}

#modal-table-report-all-html {
    height: 80% !important;
}

#modal-table-report-all-html .modal-body {
    max-height: none;
    position: absolute;
    padding: 0px;
    left: 0;
    right: 0;
    top: 38px;
    bottom: 0;
}

#report_aws_div .modal-body0 {
    position: relative;
    max-height: 100%;
    overflow-y: auto;
}

.vocidetoolbarbtn {
    background-color: transparent;
    border: 1px solid lightgray; 
    margin-right: 4px; 
    margin-left: 0px;
    color: rgb(0, 0, 0);}

.vmtoolbarbtn {
    border-radius: 3px!important;
    background-color: transparent;
    border: 1px solid lightgray; 
    margin-right: 4px; 
    margin-left: 0px;
    color: rgb(0, 0, 0);}

#waitClusterButton:disabled,
#waitClusterButton[disabled] {
  border: 0px;
}

#waitClusterButton:disabled:hover { 
  background-color: #abbac3 !important;
}

.jupyter-modal-td-file {
  text-align:left !important;
  border:0px !important; 
  padding-bottom:0px !important;
}
.jupyter-modal-td-checkbox {
  margin-bottom:6px !important;
  width:20px !important;
}


    .merge-modal-td-asn {
      text-align:left !important;
      border:0px !important; 
      padding-bottom:0px !important;
      padding-left:0px !important;
      padding-top:4px !important;
    }
    .merge-modal-td-checkbox {
      margin-bottom:6px !important;
      margin-right:6px !important;
      width:20px !important;
    }
  
.clabs-state-modal-tr-vm {
    border-bottom:1px solid lightgray;
}
.clabs-state-modal-td-vm {
  text-align:left !important;
  border:0px !important; 
  padding-bottom:0px !important;
}
.clabs-state-modal-td-state {
  text-align:right !important;
  border:0px !important; 
  padding-bottom:4px !important;
}

.icon-button {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    outline: none;
    border: 0;
    background: transparent;
}
</style>

      



                     
<div id="README.html">
	<div class="span6">
		<h1>Welcome to your AWS Educate Account</h1>
		<div id="Content">
			<p>AWS Educate provides you with access to a wide variety of AWS Services for you to get your hands on and build on AWS! To get started, click on the AWS Console button to log in to your AWS console.</p>
			<hr>
				<p>
					<b>Please read the FAQ below to help you get started on your Starter Account.</b>
				</p>
				<ul>
					<div id="accordion" class="accordion-style2 panel-group">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h4 class="panel-title">
									<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#collapseTwo" aria-expanded="false">
										<i class="ace-icon fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
										<li>What are the list of services supported?</li>
									</a>
								</h4>
							</div>
							<div class="panel-collapse collapse" id="collapseTwo" aria-expanded="false">
								<div class="panel-body">
                                Please check the current list of supported services by clicking 
									<a href="https://awseducate-starter-account-services.s3.amazonaws.com/AWS_Educate_Starter_Account_Services_Supported.pdf" target="_blank">here. </a> AWS Educate Classroom Accounts may have slightly different permissions.
								</div>
							</div>
						</div>
						<hr>
							<div class="panel panel-default">
								<div class="panel-heading">
									<h4 class="panel-title">
										<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#collapseThree" aria-expanded="false">
											<i class="ace-icon fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
											<li>What regions are supported with Starter Accounts or Classroom Accounts?</li>
										</a>
									</h4>
								</div>
								<div class="panel-collapse collapse" id="collapseThree" aria-expanded="false">
									<div class="panel-body">
                                Only us-east-1 is currently supported.
                            </div>
								</div>
							</div>
							<hr>
								<div class="panel panel-default">
									<div class="panel-heading">
										<h4 class="panel-title">
											<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#collapseFour" aria-expanded="false">
												<i class="ace-icon fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
												<li>I can't start any resources. What happened?</li>
											</a>
										</h4>
									</div>
									<div class="panel-collapse collapse" id="collapseFour" aria-expanded="false">
										<div class="panel-body">
                                Please check in top right of you AWS Console view to confirm the region is N. Virginia. Only us-east-1 (Northern Virginia) is supported by AWS Educate Accounts Change your region to us-east-1 to start your resources. Alternatively please check allowed services above. Only services listed above can be used in AWS Educate Accounts.

                            </div>
									</div>
								</div>
								<hr>
									<div class="panel panel-default">
										<div class="panel-heading">
											<h4 class="panel-title">
												<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#collapse5" aria-expanded="false">
													<i class="ace-icon fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
													<li>Can I create users within my Starter or Classroom Account for others to access?</li>
												</a>
											</h4>
										</div>
										<div class="panel-collapse collapse" id="collapse5" aria-expanded="false">
											<div class="panel-body">
                                You may create users and groups within IAM consoles. However, you cannot attach a login profile or associate keys with the users you create. This means that additonal users you create cannot log into your account. If you need to use your credentials, please click the "Account Details" on the right.
                            </div>
										</div>
									</div>
									<hr>
										<div class="panel panel-default">
											<div class="panel-heading">
												<h4 class="panel-title">
													<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#collapse6" aria-expanded="false">
														<i class="ace-icon fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
														<li>Can I create my own IAM policy within Starter Account or Classroom?</li>
													</a>
												</h4>
											</div>
											<div class="panel-collapse collapse" id="collapse6" aria-expanded="false">
												<div class="panel-body">
                                Yes. You can create your own policies; however, you may still be prohibited from certain actions.
                            </div>
											</div>
										</div>
										<hr>
											<div class="panel panel-default">
												<div class="panel-heading">
													<h4 class="panel-title">
														<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#collapse7" aria-expanded="false">
															<i class="ace-icon fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
															<li>Can I use marketplace software with my Starter Account or Classrooms?</li>
														</a>
													</h4>
												</div>
												<div class="panel-collapse collapse" id="collapse7" aria-expanded="false">
													<div class="panel-body">
No. Marketplace software is not supported with Starter accounts or Classroom accounts. This applies to free marketplace products as well.
                                                    </div>
												</div>
											</div>
											<hr>
												<div class="panel panel-default">
													<div class="panel-heading">
														<h4 class="panel-title">
															<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#collapse8" aria-expanded="false">
																<i class="ace-icon fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
																<li>Are there any restrictions on AWS services in my AWS Educate Account?</li>
															</a>
														</h4>
													</div>
													<div class="panel-collapse collapse" id="collapse8" aria-expanded="false">
														<div class="panel-body">
                                Yes, AWS Educate Accounts come with following restrictions on services:
                                
															<ul>
                                                                  <li>IAM: You can create users, but cannot attach a login profile. You are not permitted to use SAML or third party providers with IAM. You cannot create access keys for additional users.</li>
<li>EC2: Creation of VPN gateways, VPN links, NAT gateways and Inspector is not permitted.</li>
<li>EC2 and RDS: Reserved Instance Purchases are not permitted.</li>
<li>EC2 supported instances types - Starter accounts are limited to "t2.small","t2.micro","t2.nano","m4.large","c4.large",
  "c5.large", "m5.large", "t2.medium", "m4.xlarge", "t2.nano", "c4.xlarge",
  "c5.xlarge", "t2.2xlarge". If additional instance types are desired, please ask your educator to request a Classroom. Certain instance types may not be available in Classrooms</li>

<li>RDS: All instances supported EXCEPT: db.x1.*", "db.x1e.*", "db.r3.8xlarge", "db.r3.4xlarge",
  "db.r4.16xlarge", "db.r4.8xlarge", "db.r4.4xlarge", "db.m4.2xlarge", "db.m4.10xlarge",
    "db.m4.4xlarge", "db.m4.8xlarge", "db.m4.4xlarge", "db.m4.2xlarge" </li>
																<li>Route53: Domain name registration not supported.</li>
															</ul>
														</div>
													</div>
												</div>
												<hr>
													<div class="panel panel-default">
														<div class="panel-heading">
															<h4 class="panel-title">
																<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#collapse9" aria-expanded="false">
																	<i class="ace-icon fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
																	<li>Are FPGA Instances Supported?</li>
																</a>
															</h4>
														</div>
														<div class="panel-collapse collapse" id="collapse9" aria-expanded="false">
															<div class="panel-body">
No. FPGA instances are not supported.
                                                            </div>
														</div>
													</div>
                                                  <hr>
                        							<div class="panel panel-default">
														<div class="panel-heading">
															<h4 class="panel-title">
																<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#collapse10" aria-expanded="false">
																	<i class="ace-icon fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
																	<li>How do I share image with my students?</li>
																</a>
															</h4>
														</div>
														<div class="panel-collapse collapse" id="collapse10" aria-expanded="false">
															<div class="panel-body">
Create a Amazon Machine Image using EC2 console. After you create a Amazon machine image, you can share it with specific accounts of students. You will need the account numbers of students.                                                            </div>
														</div>
													</div>
                                                  <hr>
                        							<div class="panel panel-default">
														<div class="panel-heading">
															<h4 class="panel-title">
																<a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096#collapse11" aria-expanded="false">
																	<i class="ace-icon fa fa-angle-right bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
																	<li>Can I access the billing and cost console?</li>
																</a>
															</h4>
														</div>
														<div class="panel-collapse collapse" id="collapse11" aria-expanded="false">
															<div class="panel-body">
Currently users cannot access the billing console.                                                            </div>
														</div>
													</div>
                    </div>         
												</ul>
            <br>
											</div>
										</div>
										<div class="span6">
											<h1>Your AWS Account Status</h1>
											<div class="col-xs-12" style="height:10px;"></div>
											<div class="infobox infobox-orange" style="width:45vw">
												<div class="infobox-icon">
													<i class="icon-user"></i>
												</div>
												<div class="infobox-data">
													<span class="infobox-data-number" id="awsstatus">Active</span>
													<span class="infobox-content" id="awsstatusdetails">full access</span> (
													<b>
														<span class="infobox-content" id="vocuseremail">rik.eudizi@gmail.com</span>
													</b>)
            
												</div>
											</div>
											<div class="infobox infobox-orange col-xs-4" style="width: 45vw">
												<div class="infobox-icon">
													<i class="icon-usd"></i>
												</div>
												<div class="infobox-data">
													<span class="infobox-data-number" id="awsstimetxtB">&nbsp;$44.7</span>
													<span class="infobox-content">remaining credits (estimated)</span>
												</div>
											</div>
											<div class="infobox infobox-blue col-xs-4" style="width: 45vw; display: none">
												<div class="infobox-icon">
													<i class="icon-calendar"></i>
												</div>
												<div class="infobox-data">
													<span class="infobox-data-number" id="awsstimetxtT">&nbsp;159d 19:49:02</span>
													<span class="infobox-content">remaining term</span>
												</div>
											</div>
											<div class="infobox infobox-green col-xs-4" style="width: 45vw">
												<div class="infobox-icon">
													<i class="icon-time"></i>
												</div>
												<div class="infobox-data">
													<span class="infobox-data-number" id="awsstimetxtS">&nbsp;0:37</span>
													<span class="infobox-content">session time</span>
												</div>
											</div>
											<div class="col-xs-12" style="height:10px;"></div>
											<div class="btn btn-info vocbtn2 vocbtn-info" data-toggle="tab" href="#" tabindex="0" role="button" onclick="showawsact(1);" id="showawsdetail">Account Details</div>
											<div class="btn btn-info vocbtn2 vocbtn-info" id="awsbtn" data-toggle="tab" href="#" tabindex="0" role="button">AWS Console</div>
											<!-- 
    <div class="btn btn-info vocbtn2 vocbtn-warning" id="vocsubmit" href="#" role="button">SUBMIT</div>
    -->
											<hr>
                                            <h4>Please use AWS Educate Account responsibly. Remember to shut down your instances when not in use to make the best use of your credits. And, don't forget to logout once you are done with your work! </h4>

											</div>
										</div>
	</div> <!-- end dirs and editor -->

<!-- start of modals -->


<!-- view output start -->
							<div id="modal-table-output" class="modal hide fade" tabindex="-1">
								<div class="modal-header no-padding">
									<div class="table-header">
										<button type="button" class="close" data-dismiss="modal">
											<h3>Close</h3>
										</button>
											<span style="font-size:20px">Output</span>
									</div>
								</div>

								<div class="modal-body no-padding" id="div-output" style="height:600px;">

								</div>
							</div>
<!-- end view output -->

<!-- diff window -->
							<div id="modal-table-diff" class="modal hide fade" tabindex="-1">
								<div class="modal-header no-padding">
									<div class="table-header">
										<button type="button" class="close" data-dismiss="modal">
																						<h3>Close</h3>
										</button>
											<span style="font-size:20px">View Changes</span>
									</div>
								</div>

								<div class="modal-body no-padding" id="div-diff">

								</div>
							</div>
<!-- end diff window -->

<!-- video viewer -->
    <div id="video-viewer-modal" class="modal hide fade" tabindex="-1">
		    <div class="modal-header no-padding">
            <div class="table-header">
              <button type="button" class="close" data-dismiss="modal">×</button>
                Video viewer
            </div>
				</div>

        <div class="modal-body">
            <table><tbody><tr><td>
               <div id="video-viewer-modal-div">
              </div>           
            </td></tr></tbody></table>
        </div>
   </div>
<!-- end video viewer -->                           
<!-- image viewer -->
    <div id="image-viewer-modal" class="modal hide fade" tabindex="-1">
		    <div class="modal-header no-padding">
            <div class="table-header">
              <button type="button" class="close" data-dismiss="modal">×</button>
                Image viewer
            </div>
				</div>

        <div class="modal-body">
            <table><tbody><tr><td>
                            <img id="image-viewer-modal-image">
            </td></tr></tbody></table>
        </div>
   </div>
<!-- end image viewer -->

<!-- largefile viewer --> 
    <div id="largefile-viewer-modal" class="modal hide fade" tabindex="-1" style="height:200px">
		    <div class="modal-header no-padding">
            <div class="table-header">
              <button type="button" class="close" data-dismiss="modal">×</button>
                File too big for viewer
            </div>
				</div>

        <div class="modal-body">
                <h4>The file is too big for the viewer. Please download the file instead.</h4>
                <br><mute>Only files smaller than 1 MB are shown in the viewer.</mute>
        </div>
   </div>
<!-- end largefile viewer -->
                            

<!-- Uploader -->
 <div id="modal-upload-wait" class="modal hide fade" tabindex="-1">
   <div class="modal-header no-padding">
     <div class="table-header">
       <button type="button" class="close" onclick="afterUpload();" data-dismiss="modal">×</button>
       <span style="font-size:20px">Status</span>
     </div>
   </div>

   <div id="uploadWaitMsgDiv" class="modal-body no-padding">
     <p id="uploadWaitMsgBox" style="margin-left: 20px !important;"></p>
   </div>
 </div>

<!-- other viewer -->
    <div id="other-viewer-modal" class="modal hide fade" tabindex="-1">
      <div class="modal-header no-padding">
        <div class="table-header">
          <button type="button" class="close" data-dismiss="modal">×</button>
            File viewer
        </div>
      </div>

      <div class="modal-body">
          <table><tbody><tr><td>
               <object type="application/pdf" id="other-viewer-modal-area" width="100%" height="100%">No default viewer found</object>
          </td></tr></tbody></table>
      </div>
    </div>
<!-- end other viewer -->
<!-- browser viewer -->
    <div id="browser-viewer-modal" class="modal hide fade" tabindex="-1">
      <div class="modal-header no-padding">
        <div class="table-header">

          <button type="button" class="close" data-dismiss="modal">×</button>
          <span id="browser-viewer-title">Viewer</span>
          <a class="" target="_blank" href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096" id="browser-viewer-link">
							<i style="margin-left:10px" class="icon-external-link icon-only white"></i>
					</a>
        </div>
      </div>

      <div class="modal-body" id="browser-viewer-body">
          <iframe id="browser-viewer-iframe" src="./prova Html_files/saved_resource.html" width="100%" height="100%" frameborder="0"></iframe>
      </div>
    </div>
<!-- browser viewer -->


<div id="Scripts-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal">×</button> &nbsp;
            <span class="modal-title">&nbsp;
                Scripts            </span>
        </div>
    </div>
    <div class="modal-body">
        Specify the shell scripts that will be run during various phases. These scripts are always run in a directory which has a copy of student submission.
    </div>
</div>
<div id="Grading-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal">×</button> &nbsp;
            <span class="modal-title">&nbsp;
                Grading
            </span>
        </div>
    </div>
    <div class="modal-body">
Grading script - this script can be run for grading student submission. It can either be run in batch on all student submissions from the control panel or can be run on an individual student submission by selecting the grading button from the grading panel. You can test this script by selecting “Run Scripts =&gt; Grading”. The script will be run in the “work” directory in this IDE.
    </div>
</div>   

<div id="RUN-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> 
    <div class="modal-header no-padding"> 
        <div class="table-header"> <button type="button" class="close" data-dismiss="modal">×</button> &nbsp;
            <span class="modal-title">&nbsp;
                RUN
            </span>
        </div>
    </div>
    <div class="modal-body">
If this script is specified then a Run button shows up on student IDE which the user can execute. This script runs on the student work directory unlike Submission script which runs on submitted assignment.
    </div>
</div>    
<div id="BUILD-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> 
    <div class="modal-header no-padding">     
        <div class="table-header"> <button type="button" class="close" data-dismiss="modal">×</button> &nbsp;
            <span class="modal-title">&nbsp;
                BUILD
            </span>
        </div>
    </div>
    <div class="modal-body">
If this script is specified then a Build button shows up on student IDE which the user can execute. This script runs on the student work directory unlike Submission script which runs on submitted assignment.
    </div>
</div>
<div id="Submission-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal">×</button> &nbsp;
            <span class="modal-title">&nbsp;
                Submission
            </span>
        </div>
    </div>
    <div class="modal-body">
Submission script - this script is run when the student submits his/her assignment. You can use this script to either perform sanity checks like whether the submission compiles or can run either some or all of tests that will be used to grade the submission. Note: this script runs on last submitted assignment for the user. You can test this script by selecting “Run Scripts =&gt; Submission”. It will be executed in the “work” directory of this IDE.
    </div>
</div>   
<div id="LIB-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal">×</button> &nbsp;
            <span class="modal-title">&nbsp;
                LIB            </span>
        </div>
    </div>
    <div class="modal-body">
$LIB - Use this directory to store resource files common to more than one assignment for this course. Assignment specific resources should be stored in $ASNLIB.
    </div>
</div>     
<div id="ASNLIB-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal">×</button> &nbsp;
            <span class="modal-title">&nbsp;
                ASNLIB            </span>
        </div>
    </div>
    <div class="modal-body">
$ASNLIB - This is a directory where the teacher can store all the files that are needed to run scripts. This directory is not visible to or accessible by the students.
    </div>
</div>  
<div id="StarterCode-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal">×</button> &nbsp;
            <span class="modal-title">&nbsp;
                StarterCode            </span>
        </div>
    </div>
    <div class="modal-body">
All the files in this directory are copied to the student work area when s/he starts working on the assignment. Once the student has started working on the assignment, any changes made to the starter code are not reflected in the student work area.
    </div>
</div>  

<div id="modal-table-download_from_ide" class="modal hide fade" tabindex="-1" style="height:200px">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">
	<h3>Close</h3>
      </button>
      <span style="font-size:15px">Preparing ZIP File</span>
    </div>
  </div>
  
  <div class="modal-body no-padding" id="div-output-download_from_ide" style="height:200px;">
    
  </div>
</div>	

<div id="modal-table-od_terminal" class="modal hide fade" tabindex="-1" style="height:400px">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">
	<h3>Close</h3>
      </button>
      <span style="font-size:15px">Terminal</span>
    </div>
  </div>
  
  <div class="modal-body no-padding" id="div-output-od_terminal" style="height:360px">
    
  </div>
</div>	
<div id="modal-table-report-db" class="modal hide fade" tabindex="-1" style="height:50% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">×</button>
      <span style="font-size: 15px">Database Credentials</span>
    </div>
  </div>

   <div id="report_db_div" class="modal-body no-padding">
     <p id="report_db_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>
</div>
<div id="modal-table-report-aws" class="modal hide fade" tabindex="-1" style="height:80% !important;overflow: auto;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">×</button>
      <span style="font-size: 15px" id="aws-modal-label">AWS Credentials</span>
    </div>
  </div>

   <div id="report_aws_div" class="modal-body0 no-padding">
     <p id="report_aws_msg_box" style="margin-left: 10px;height:60%; !important; font-family: Courier;overflow: auto;"></p>
   </div>
   <div class="modal-body0 no-padding">
     <p id="report_aws_progress_box" style="margin-left: 10px;height:60%; !important; font-family: Courier;overflow: auto;"></p>
   </div>

</div>
<script type="text/javascript">
function sshkeyboxdownload(s, f)
{
  var t = document.createElement('a');
  t.setAttribute('href', 'data:application/octet-stream;charset=utf-16le;base64,' + s);
  t.setAttribute('download', f);
  t.style.display = 'none';
  document.body.appendChild(t);
  t.click();
  document.body.removeChild(t);
}
function ssodownload(id)
{
  $.ajax({
    url: '../util/vcput.php',
    type: 'post',
    data: {
      a: 'ssodownload',
      data:id,
      step:121096    },
    success: function(data) {
      if( data.search(/^Error/) >=0 ){
        alert(data);
      } else {
        sshkeyboxdownload(data, 'ssourl.txt');
      }
    },
    fail: function(data) {
      alert('Failed to retrieve SSO URL');
    }
  });
}
  function sshkeyboxshow(){
     $("#sshkeybox").show();
     $("#sshkeyboxbtn").hide();
  }
  function clikeyboxshow(){
     $("#clikeybox").show();
     $("#clikeyboxbtn").hide();
  }
</script>
<script type="text/javascript">
  var clabstimeout = false;
  var clabsbldinprogress = 0;
  var clabslastchktime = 0;
  var clabscnt = 1;
  var clabsobj = [{"init":"","work":1,"port":"ssh=22","st":""}];
  //console.log(clabsobj);
  //console.log('clabscnt='+clabscnt+' '+'[{"init":"","work":1,"port":"ssh=22","st":""}]');
  
  function addvm() 
  {
    var type = (typeof clabstype != "undefined")? $("#clabstype").val() : 'ct';
    var len = $('#clabstbl tr').length;
    if( len>=11 ){
      alert(' Maximum instance count is 10');
      return false;
    }
    var row = $('#clabstbl tr:last');
    var chk      = row.find('td:eq(0) input').prop('checked')? ' checked' : '';
    var init     = type=='ct'? row.find('td:eq(1) input').val() : row.find('td:eq(1) option:selected').text();
    var initfile = row.find('td:eq(2) input').val();
    var hostname = row.find('td:eq(3) input').val();
    var port     = row.find('td:eq(4) input').val();
    var scpt     = row.find('td:eq(5) input').prop('checked')? 'checked' : '';
    var work     = type=='ct'? (row.find('td:eq(6) input').prop('checked')? 'checked' : '') : row.find('td:eq(6) option:selected').text();
    var st       = row.find('td:eq(7)').html();
    var ami      = type=='cl'? '' : row.find('td:eq(1) option:selected').text();
    
    ++clabscnt;
    
    var f1, f5, f8;
    if( type=='ct' ){
      f1 = '<td><input class="span1" style="margin-right: 20px; width:40%" value="' + init + '" onchange="chgvm('+clabscnt+')" type="text"></td>';
      f6 = '<td><input class="span1" style="margin-right: 20px; width:40%" ' + work + ' type="checkbox"></td>';
      f7 = '<td>' + st + '</td>';
    } else if (type=='cl') {
      f1 = '<td><select style="width:100px;margin-bottom:0px;" onchange="chgvm(' + clabscnt + ')">' + $('#clabsamis').html() + '</select></td>';
      f6 = '<td> <select style="width:100px;margin-bottom:0px;"  onchange="chgvm('+clabscnt+')"><option value="t2.small">t2.small</option><option value="t2.medium">t2.medium</option><option value="t2.large">t2.large</option><option value="t2.xlarge">t2.xlarge</option><option value="t2.2xlarge">t2.2xlarge</option><option value="r4.xlarge">r4.xlarge</option><option value="r4.2xlarge">r4.2xlarge</option><option value="r5.xlarge">r5.xlarge</option><option value="r5.2xlarge">r5.2xlarge</option><option value="r5.4xlarge">r5.4xlarge</option><option value="m5a.2xlarge">m5a.2xlarge</option><option value="p2.xlarge">p2.xlarge</option><option value="p3.2xlarge">p3.2xlarge</option><option value="g2.2xlarge">g2.2xlarge</option><option value="g3s.xlarge">g3s.xlarge</option></select></td>';
      f7 = '<td><input class="span1" style="margin-right: 20px; width:40%" min=0 onchange="chgvm(' + clabscnt + ')" type="number"></td>';
    }
    $('#clabstbl').append('<tr id="clabstr' + clabscnt + '"><td style="text-align:center;"><input class="span1" style="margin-right: 20px; width:40%"' + chk + ' onclick="opchk()" type="checkbox"></td>' +
                          f1 +
                          '<td><input class="span1" style="margin-right: 20px; width:40%" value="' + initfile + '" onchange="chgvm('+clabscnt+')"></td>' +
                          '<td><input class="span1" style="margin-right: 20px; width:60%" value="' + hostname + '" onchange="chgvm('+clabscnt+')"></td>' +
                          '<td><input class="span1" style="margin-right: 20px; width:40%" value="' + port + '" onchange="chgvm('+clabscnt+')"></td>' +
                          '<td><input class="span1" style="margin-right: 20px; width:40%" type="checkbox" ' + scpt + '></td>' +
                          f6 +
                          f7 +
                          '</tr>');
  }
  function sshvm(cnt)
  {
    if( $('#clabscnt' + cnt).prop('checked') ){
      $('#clabstbl tr').each(function (i, row) {
        var myrow = $('#clabstbl tr:eq(' + i + ')');
        myrow.find('td:eq(4) input').prop('checked', false);
      });
      $('#clabscnt' + cnt).prop('checked', true);
    }
  }
  function opchk()
  {
    var chk = true;
    $('#clabstbl tr').each(function (i, row) {
       if( i>0 ) {
         var myrow = $('#clabstbl tr:eq(' + i + ')');
         if( !myrow.find('td:eq(0) input').prop('checked') ) {
           chk = false;
         }
       }
     });
    $('#clabstbl tr:first th:eq(0) input').prop('checked', chk);
  }
  function delvm()
  {
    var rows = [];
    $('#clabstbl tr').each(function (i, row) {
      if( i>0 ){
        var myrow = $('#clabstbl tr:eq(' + i + ')');
        if( myrow.find('td:eq(0) input').prop('checked') ){
          rows.push(i);
        }
      }
    });
    if( rows.length>=($('#clabstbl tr').length - 1) ){
      alert('not allowed to delete all');
      return false;
    }
    rows.reverse();
    for (var i=0, l=rows.length; i<l; i++){
      var myrow = $('#clabstbl tr:eq(' + rows[i] + ')');
      myrow.remove();
    }
    opchk();
    return false;
  }
  function chkvm()
  {
    var av = $('#clabschk').prop('checked');
    $('#clabstbl tr').each(function (i, row) {
      if( i>0 ){
        var myrow = $('#clabstbl tr:eq(' + i + ')');
        myrow.find('td:eq(0) input').prop('checked', av);
      }
    });
  }
  function endvm()
  {
    clabsbldinprogress = 0;
    clabslastchktime = 0;
    if(clabstimeout) clearTimeout(clabstimeout);
    clabstimeout = false;

    $('#clabsstatus').hide();
  }
  function clsvm()
  {
    endvm();
    $('#modal-table-report-buildclabs').modal('hide');
    //$('#clabscls').click();
  }
  function vmdetail(f)
  {
    var target = document.getElementById("report_buildclabs_msg_box");
    target.innerHTML = '';
    $.ajax({
         url: '../util/vcput.php',
         type: 'get',
         data: {
           a: 'checklab',
           stepid:121096,
           mode:'',
           init:f
           ,version:0        },
        success: function(data) {
          if( data.search(/^error/) >=0 ){
            alert(data);
          } else {
            try {
              resp = jQuery.parseJSON(data);
              if( resp.status=='not built' ){
                msg = 'Status: not built<br>Init file:' + f + '<br>' + resp.message;
              } else if (resp.status=='error'){
                msg = 'Status: failed<br>' + 'Init file:' + f + '<br>' + 'Built at ' + resp.time + '<br>' + resp.message;
              } else if (resp.status=='building'){
                msg = 'Status: in progress<br>' + 'Init file:' + f + '<br>' + 'Started at ' + resp.time + '<br>' + resp.message;
              } else if (resp.status=='success'){
                msg = 'Status: completed<br>' + 'Init file:' + f + '<br>' + 'Built at ' + resp.time + '<br>' + resp.message;
              } else {
                msg = 'Internal error, report this to support.vocareum.com<br>' + 'Init file: ' + f;
              }
              target.innerHTML = msg;
            } catch(err) {
              alert( err );
            }
          }
        }
     });
  }
  function clabsChkBlds(blds)
  {
    $.ajax({
         url: '../util/vcput.php',
         type: 'get',
         data: {
           a: 'chkbld',
           stepid:121096,
           mode:'',
           files: (blds? JSON.stringify(blds) : '')
           ,version:0         },
        success: function(data) {
          try {
            resp = jQuery.parseJSON(data);
            var alldone = resp.length>0;
            resp.forEach(function(e) {
              // ['init':, 'status', 'time']
              $('#clabstbl tr').each(function (i, row) {
                if( i>0 ){
                  var myrow = $('#clabstbl tr:eq(' + i + ')');
                  if( myrow.find('td:eq(0) input').prop('checked') && myrow.find('td:eq(1) input').val()==e.init ){
                    var msg = '<a onclick="vmdetail(\'' + e.init + '\');">' + e.status + ' ' + e.time + '</a>';
                    if( e.status!='error' && e.status!='not built' && e.status!='success' ){
                      msg += '<i class="icon-spin icon-spinner"></i>';
                      alldone = false;
                    } else {
                      blds = jQuery.grep(blds, function(value) {
                                return value != e.init;
                             });
                    }
                    msg = '<td>' + msg + '</td>';
                    myrow.find('td:eq(7)').replaceWith(msg);
                  }
                }
              }); 
            });
            if( alldone ){
              endvm();
            } else {
              clabstimeout = setTimeout(function() { clabsChkTimeout(blds); }, 3000);
            }
          } catch(err) {
            alert( err );
          }
        },
        fail: function(data) {
          alert('Failed to save the lab configuration');
        }
    }); 
  }
  function clabsChkTimeout(blds)
  {
    if(clabstimeout) clearTimeout(clabstimeout);
    clabstimeout = false;

    var tv = Date.now();
    var elapsed = tv - clabslastchktime;
    $('#clabselapsed').html( 'Elapsed ' + Math.floor((tv-clabsbldinprogress)/1000) + 's' );
    // update timer shown
    if( elapsed>= 7000 ){// 30 seconds elapsed
      clabslastchktime = tv;
      clabsChkBlds(blds);
    } else {
      clabstimeout = setTimeout(function() { clabsChkTimeout(blds); }, 3000);
    }
  }
  function chgvmtype()
  {
    var type = (typeof clabstype != "undefined")? $("#clabstype").val() : 'ct';
    var str;
    
    $('#clabsbtnbld').attr('disabled', type!='ct');
    if( type=='ct' ){
    	
      $('#clabstbl tr').each(function (i, row) {
        var myrow = $('#clabstbl tr:eq(' + i + ')');
        if(i==0){
          myrow.find('th:eq(1)').replaceWith('<th>Dockerfile</th>');
          myrow.find('th:eq(6)').replaceWith('<th>Persistent Workarea</th>');
          myrow.find('th:eq(7)').replaceWith('<th>Status</th>');
          myrow.find('th:eq(8)').replaceWith('<th></th>');
        } else {
          myrow.find('td:eq(1)').replaceWith('<td><input class="span1" style="margin-right: 20px; width:40%" value="" onchange="chgvm(' + i + ')" type="text"></td>');
          myrow.find('td:eq(6)').replaceWith('<td><input class="span1" style="margin-right: 20px; width:40%" type="checkbox"></td>');
          myrow.find('td:eq(7)').replaceWith('<td>not built</td>');
          myrow.find('td:eq(8)').replaceWith('<td></td>');
          if( typeof(clabsobj) != 'undefined' && typeof(clabsobj[i-1]) != 'undefined' ){
            var one = clabsobj[i-1];
            if( typeof(one['init']) != 'undefined' ){
              myrow.find('td:eq(1) select').val(one['init']);
            }
          }
        }
      });
    } else if( type=='cl' ) {
        $('#clabstbl tr').each(function (i, row) {
          var myrow = $('#clabstbl tr:eq(' + i + ')');
          if(i==0){
              myrow.find('th:eq(1)').replaceWith('<th>AMI</th>');
              myrow.find('th:eq(6)').replaceWith('<th>Instance Type</th>');
              myrow.find('th:eq(7)').replaceWith('<th>Disk Size (GB)</th>');
            } else {
              myrow.find('td:eq(1)').replaceWith('<td><select style="width:100px;margin-bottom:0px;" onchange="chgvm(' + i + ')">'+ $('#clabsamis').html()+'</select></td>');
              myrow.find('td:eq(6)').replaceWith('<td><select style="width:100px;margin-bottom:0px;"  onchange="chgvm(' + i + ')"><option value="t2.small">t2.small</option><option value="t2.medium">t2.medium</option><option value="t2.large">t2.large</option><option value="t2.xlarge">t2.xlarge</option><option value="t2.2xlarge">t2.2xlarge</option><option value="r4.xlarge">r4.xlarge</option><option value="r4.2xlarge">r4.2xlarge</option><option value="r5.xlarge">r5.xlarge</option><option value="r5.2xlarge">r5.2xlarge</option><option value="r5.4xlarge">r5.4xlarge</option><option value="m5a.2xlarge">m5a.2xlarge</option><option value="p2.xlarge">p2.xlarge</option><option value="p3.2xlarge">p3.2xlarge</option><option value="g2.2xlarge">g2.2xlarge</option><option value="g3s.xlarge">g3s.xlarge</option></select></td>');
              myrow.find('td:eq(7)').replaceWith('<td><input class="span1" style="margin-right: 20px; width:40%" min=0 onchange="chgvm(' + i + ')" type="number"></td>');
              if( typeof(clabsobj) != 'undefined' && typeof(clabsobj[i-1]) != 'undefined' ){
                var one = clabsobj[i-1];
                if( typeof(one['ami']) != 'undefined' ){
                  myrow.find('td:eq(1) select').val(one['ami']);
                  myrow.find('td:eq(6) select').val(one['type']);
                  myrow.find('td:eq(7) input').val(one['datasize']);
                }
              }
            }
        });  
    }
  }

  function chgvm(cnt)
  {
    var type = (typeof clabstype != "undefined")? $("#clabstype").val() : 'ct';
    if( type!='ct' ) return false;

    var row = $('#clabstr' + cnt);
    row.find('td:eq(7)').replaceWith('<td>not built</td>');
  }
  function bldvm()
  {
    if( $('#clabsbtnbld').attr('disabled') ) return false;

    if( clabsbldinprogress ){
      return false;
    }
    clabsbldinprogress = Date.now();
    clabslastchktime = clabsbldinprogress;
    $('#clabsstatus').show();
    $('#clabselapsed').text('');
    var blds = [];
    $('#clabstbl tr').each(function (i, row) {
      if( i>0 ){
        var myrow = $('#clabstbl tr:eq(' + i + ')');
        if( myrow.find('td:eq(0) input').prop('checked') ){
          var initf = myrow.find('td:eq(1) input').val();
          if( $.inArray(initf, blds) < 0 ){
            blds.push(initf);
          }
          myrow.find('td:eq(7)').replaceWith('<td><i class="icon-spin icon-spinner"></i>building</td>');
        }
      }
    });
    if( blds.length<1 ){
      alert('no build is selected');
      $('#clabsstatus').hide();
      clabsbldinprogress = 0;
      clabslastchktime = 0;
    }
    clabstimeout = setTimeout(function() { clabsChkTimeout(blds); }, 2000);
    savevm(blds);
    return false;
  }
  function connectvm(v)
  {
    if(v=='none') return 2;
    if(v=='ssh' ) return 1;
    if(v=='http') return 0;
    return 2;
  }
  function savevm(blds)
  {
    var vm = [];
    var hostnames = [];
    var hname = '';
    var err = false;
    var regExpHostname = new RegExp(/^[a-z][a-z0-9\._-]*$/);
    var nameReg = new RegExp(/^[a-z][a-z\-0-9.]*$/);
    var type = (typeof clabstype != "undefined")? $("#clabstype").val() : 'ct';
    var user = $('#labsuser').val();
    var suser = $('#scriptuser').val();
    var sysuser = $('#systemuser').val();
    if( !user ) user = '';
    if( !suser ) suser = user;
    if( !sysuser ) sysuser = '';
    if( user!='' && nameReg.exec(user)===null ){
      show_voc_gritter(false, 'Labuser can only have lowercase alphanumeric and hyphen, starting with a letter:' + user, true);
      return;
    }
    if( suser!='' && nameReg.exec(suser)===null ){
      show_voc_gritter(false, 'Scriptuser can only have lowercase alphanumeric and hyphen, starting with a letter:' + suser, true);
      return;
    }
    $('#clabstbl tr').each(function (i, row) {
      if( i>0 ){
        if (err) return;
        
        var myrow = $('#clabstbl tr:eq(' + i + ')');
        hname = myrow.find('td:eq(3) input').val();
        hname = hname.toLowerCase();
        
        if (hname == '' || hname.length == 0)
        {
        	show_voc_gritter(false, "Hostname cannot be empty", true);
        	err = true;
        	return;
        }
        else if (hostnames.indexOf(hname) >= 0)
        {
        	show_voc_gritter(false, "Duplicated hostname: " + hname, true);
        	err = true;
        	return;
        }
        else if (hname.length > 24)
        {
        	show_voc_gritter(false, "Hostname " + hname  + " is longer than 24 characters", true);
        	err = true;
        	return;
        }
        else if (regExpHostname.exec(hname) === null)
        {
        	show_voc_gritter(false, "Invalid hostname: " + hname, true);
        	err = true;
        	return;
        }

        hostnames.push(hname);
        
        if(type=='ct'){
          vm.push({"init":myrow.find('td:eq(1) input').val(),
                   "initfile":myrow.find('td:eq(2) input').val(),
                   "hostname":hname,
                   "port":myrow.find('td:eq(4) input').val(),
                   "script":myrow.find('td:eq(5) input').prop('checked'),
                   "work":myrow.find('td:eq(6) input').prop('checked'),
                   "user":user,
                   "sysuser":sysuser,
                   "sudo":$('#labssudo').prop('checked'),
                   "suser":suser});
        } else if(type=='cl'){
            vm.push({"ami":myrow.find('td:eq(1) select').val(),
                "initfile":myrow.find('td:eq(2) input').val(),
                "hostname":hname,
                "port":myrow.find('td:eq(4) input').val(),
                "script":myrow.find('td:eq(5) input').prop('checked'),
                "type":myrow.find('td:eq(6) select').val(),
                "user":user,
                "sysuser":sysuser,
                "sudo":$('#labssudo').prop('checked'),
                "suser":suser,
                "datasize":myrow.find('td:eq(7) input').val()});
        }
      }
    });

    if (err) return;
    clabsobj = vm;
    $('#saveVmBtn').html('<i class="icon-spin icon-spinner" style="padding: 0 3px 0 2px;"></i>Save');
    
    $.ajax({
         url: '../util/vcput.php',
         type: 'post',
         data: {
           a: 'savevm',
           stepid:121096,
           data:JSON.stringify(vm),
           mode:'',
           files: (blds? JSON.stringify(blds) : '')
           ,version:0         },
        success: function(data) {
          if( data.search(/^error/) >=0 ){
            show_voc_gritter(false, data, false);
          } else {
            show_voc_gritter(false, "Saved", false);
          }
        },
        fail: function(data) {
          alert('Failed to save the lab configuration');
        }
    });

    $('#saveVmBtn').html('Save');
    return true;
  }



</script>
<div id="modal-table-report-buildclabs" class="modal hide fade" tabindex="-1" style="height:65% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" id="clabscls" class="close" data-dismiss="modal" onclick="endvm()">×</button>
      <span style="font-size: 15px">Build Labs</span>
    </div>
    <br>
    <div class="control-group">
        <div class="controls">
          <div class="row-fluid">
            <div class="span3" style="margin-left: 20px;">
              <select id="clabstype" name="clabstype" class="span6" onchange="chgvmtype();">
                  <option value="ct" selected="">Container</option>
                              </select>
            </div>
                        
            <div class="span3" style="margin-left: 20px; display: none;">
              <select id="clabsamis" name="clabsamis" class="span6">
              </select>
            </div>

            <div class="span6" style="float: left;width: 700px; border: 0px solid red; font-size: 13px; display:block">
                Systemuser <input id="systemuser" name="systemuser" class="span1" style="margin: 0px 20px 0px 3px; width:100px;" placeholder="" value="" type="text">
                Scriptuser <input id="scriptuser" name="scriptuser" class="span1" style="margin: 0px 20px 0px 3px; width:100px;" placeholder="" value="" type="text">
                Labuser <input id="labsuser" name="labsuser" class="span1" style="margin: 0px 20px 0px 3px; width:100px;" placeholder="" value="" type="text">
                Sudo <input class="span1" style="margin-right: 20px;" id="labssudo" name="labssudo" type="checkbox">
            </div>
            
          </div>
        </div>
    </div>
  </div>
  <div id="report_buildclabs_div" class="modal-body no-padding" style="height:100%; !important;">
     <table class="table table-first-column-check table-hover" id="clabstbl" style="border-top: 0 !important;">
       <tbody><tr><th style="text-align:center;"><input class="span1" style="margin-right: 20px; width:40%" id="clabschk" onclick="chkvm();" type="checkbox"></th>
                    <th>Dockerfile </th>
           <th>Init File</th>
           <th>Hostname</th>
           <th>Port</th>
           <th>Script</th>
           <th>Persistent Workarea</th>
           <th>Status</th>
           <th></th>
               </tr>
           <tr id="clabstr1">
        <td style="text-align:center;"><input class="span1" style="margin-right: 20px; width:40%" onclick="opchk()" type="checkbox"></td>
              <td><input class="span1" style="margin-right: 20px; width:40%" value="" onchange="chgvm(1)" type="text"></td>
        <td><input class="span1" style="margin-right: 20px; width:40%" value="" onchange="chgvm(1)" type="text"></td>
        <td><input class="span1" style="margin-right: 20px; width:60%" value="" onchange="chgvm(1)" type="text"></td>
        <td><input class="span1" style="margin-right: 20px; width:40%" value="ssh=22" onchange="chgvm(1)" type="text"></td>
        <td><input class="span1" style="margin-right: 20px; width:40%" type="checkbox"></td>
        <td><input class="span1" style="margin-right: 20px; width:40%" checked="" disabled="" type="checkbox"></td>
        <td><a onclick="vmdetail(&#39;&#39;);">success </a></td>
        <td></td>
           </tr>
            
     </tbody></table>
     <div style="margin-left:10px;">
       <div id="clabsstatus" class="hidden-1">
         <p id="clabselapsed"></p><p><i class="icon-spin icon-spinner"></i>
         Build is in progress, it can take a few minutes to complete. 
       </p></div>
       <a class="btn btn-info btn-small" style="margin: 10px 10px 0px 10px !important;" id="clabsbtnadd" onclick="addvm()">Add</a>
       <a class="btn btn-info btn-small" style="margin: 10px 10px 0px 0px !important;" id="clabsbtndel" onclick="delvm()">Delete</a>
       <a class="btn btn-info btn-small" style="margin: 10px 10px 0px 0px !important;" id="clabsbtnbld" onclick="bldvm()">Build</a>
       <a id="saveVmBtn" class="btn btn-info btn-small" style="margin: 10px 10px 0px 0px !important;" onclick="savevm(false)">Save</a>
       <a class="btn btn-info btn-small" style="margin: 10px 10px 0px 0px !important;" onclick="clsvm()">Close</a>
     </div>
     <hr>
     <p id="report_buildclabs_msg_box" style="margin-left: 10px;height:100%; !important; font-family: Courier;"></p>
   </div>
</div>

<div id="modal-table-report-cdb" class="modal hide fade" tabindex="-1" style="height:40% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">×</button>
      <span style="font-size: 15px">Database Credentials</span>
    </div>
  </div>

   <div id="report_cdb_div" class="modal-body no-padding">
     <p id="report_cdb_msg_box" style="margin-left: 10px;height:30%; !important; font-family: Courier;"></p>
   </div>
</div>
<div id="modal-table-report-clabs" class="modal hide fade" tabindex="-1" style="height:70% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">×</button>
      <span style="font-size: 15px">Container Lab</span>
    </div>
  </div>

   <div id="report_clabs_div" class="modal-body no-padding">
     <p id="report_clabs_msg_box" style="margin-left: 10px;height:60%; !important; font-family: Courier;"></p>
   </div>
</div>
<div id="modal-table-report-web" class="modal hide fade" tabindex="-1" style="left:5%; width:90% !important; height:15% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">×</button>
      <span style="font-size: 15px">Web/WebSocket Details</span>
    </div>
  </div>

   <div id="report_web_div" class="modal-body no-padding">
     <p id="report_web_msg_box" style="margin-left: 10px !important; font-family: Courier; margin-top: 5px;"></p>
   </div>
</div>





<div class="modal hide fade" id="imageBuildModal" role="dialog" style="width:80%; min-width:400px; max-height:90%; height:auto;">
  <div id="imageBuildModal_dialog" class="modal-dialog "> <!-- jupyter-modal-dialog -->
    <div id="imageBuildModal_content" class="modal-content">

      <div id="imageBuildModal_header" class="modal-header">
        <h3>Build Container Image</h3>
        <h6>
          The build context will be the resource/lib directory; the Dockerfile also needs to be placed there.
        </h6>
        <h6>
          If you're building a new image, please select the base Vocareum docker image. Also, please make sure you do not have any "FROM" directive in your dockerfile.
        </h6>
      </div>

      <div id="imageBuildModal_body" class="modal-body" style="padding-bottom: 0px; max-height:250px">

        <div class="control-group row-fluid">
          <div class="span2" style="padding-top:3px">
            <label class="control-label"></label>
          </div>
          <div class="span5" id="imageBuildModal_select_div">
            <select id="imageBuildModal_select" name="imageBuildModal_select" style="width:100%">
              <option selected="" disabled="" hidden="">Select image</option>
              <optgroup label="Create new image (select base)">
                <option value="img1">Img1</option>
                <option value="img2">Img2</option>
              </optgroup>
              <optgroup label="Use existing image">
                <option value="img3">Img3</option>
                <option value="img4">Img4</option>
              </optgroup>
            </select>
          </div>
          <div class="span4" id="image_build_name_div">
            <input id="image_build_name" name="image_build_name" class="span12" placeholder="Image name" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
<!--
        <div class="control-group row-fluid" id="image_build_name_div">
          <div class="span3" style="padding-top:3px">
            <label class="control-label">Image Name :</label>
          </div>
          <div class="span6">
            <input id="image_build_name" name="image_build_name" class="span12" placeholder="Course-unique name" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
-->        
        <div class="control-group row-fluid" style="display:block">
          <div class="span2" style="padding-top:3px">
            <label class="control-label">Base Image :</label>
          </div>
          <div class="span5" id="imageBuildModal_select_baseimage_div">
            <select id="imageBuildModal_select_baseimage" name="imageBuildModal_select_baseimage" style="width:100%">
              <option value="img1">Img1</option>
              <option value="img2">Img2</option>
            </select>
          </div>
        </div>
        
        <div class="control-group row-fluid">
          <div class="span2" style="padding-top:3px">
            <label class="control-label">Dockerfile :</label>
          </div>
          <div class="span5">
            <input id="image_build_dockerfile" name="image_build_dockerfile" class="span12" placeholder="Dockerfile" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
        
        <div class="control-group row-fluid image-build-access" id="image_build_access_0" data-id="0">
          <div class="span2" style="padding-top:3px">
            <label class="control-label">Access :</label>
          </div>
          
          <div class="span1 row-fluid">
            <button class="icon-button" id="image_build_access_plus" style="padding-top:6px">
              <i class="icon-plus-sign icon-large"></i>
            </button>
          </div>
<!-- 
          <div class="span5 row-fluid">
            <div class="span5">
              <div class="span12">
                <input id="image_build_access_name_0" class="span12" data-id="0" placeholder="name" type="text" maxlength="80" style="margin-bottom:0px">
              </div>
            </div>
            <div class="span4">
              <div class="span12">
                <select id="image_build_access_type_select_0" style="width:100%; margin-bottom:0px" data-id="0">
                  <option selected disabled hidden value="0">Type</option>
                                      <option value="http">http</option>
                                  </select>
              </div>
            </div>
            <div class="span3">
              <div class="span12">
                <input id="image_build_access_port_0" class="span12" placeholder="port" type="text" maxlength="80" data-id="0" style="margin-bottom:0px">
              </div>
            </div>
          </div>
          
          <div class="span1 row-fluid">
            <button class="icon-button" data-id="0" style="padding-top:6px">
              <i class="icon-trash icon-large"></i>
            </button>
          </div>
 -->        

        </div>
       
        <!-- 
        <div class="control-group row-fluid">
          <div class="span3" style="padding-top:3px">
            <label class="control-label">Init File :</label>
          </div>
          <div class="span5">
            <input id="image_build_initfile" name="image_build_initfile" class="span12" placeholder="Script run after container start" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
        -->
        <!-- 
        <div class="control-group row-fluid">
          <div class="span3" style="padding-top:3px">
            <label class="control-label">User Name :</label>
          </div>
          <div class="span5">
            <input disabled id="image_build_user" name="image_build_user" class="span12" value="labsuser" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
        -->
        
      </div>

      <div class="modal-footer" id="imageBuildModal_footer" style="margin-top: 15px;padding: 15px 0 15px 0 !important; background-color:white">
        <div id="imageBuildModal_output">
          <div contenteditable="true" id="imageBuildModal_ta" style="overflow:scroll; height:150px; display:none; text-align:left !important; width:98%; border:0px; margin-bottom: 10px;padding-bottom: 10px;padding-top: 0px; padding-left: 6px; resize:none; border-bottom:1px solid lightgray;">
          </div>
        </div>

        <button id="imageBuildModal_ok" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important; display:none; margin-right:10px !important" data-dismiss="modal">Ok</button>
        <button id="imageBuildModal_cancel" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important; margin-right:10px !important" data-dismiss="modal">Cancel</button>
        <button id="imageBuildModal_build" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important">Build</button>
        
      </div>

    </div>
  </div>
</div>


<div id="modal-table-report-cluster" class="modal hide fade" tabindex="-1" style="left:10%; width:70% !important; height:15% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">×</button>
      <span style="font-size: 15px">Cluster Details</span>
    </div>
  </div>

   <div id="report_cluster_div" class="modal-body no-padding">
     <p id="report_cluster_msg_box" style="margin-left: 10px !important; font-family: Courier; margin-top: 5px;"></p>
   </div>
</div>

<div id="modal-table-report-submission" class="modal hide fade" tabindex="-1" style="height:50% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">×</button>
      <span style="font-size: 15px">Submission Report</span>
    </div>
  </div>

   <div id="report_submission_div" class="modal-body no-padding">
     <p id="report_submission_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>
   
</div>

<div id="modal-table-report-grading" class="modal hide fade" tabindex="-1" style="height:50% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">×</button>
      <span style="font-size: 15px">Grading Report</span>
    </div>
  </div>
                        
   <div id="report_grading_div" class="modal-body no-padding">
     <p id="report_grading_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>

</div>


<div id="modal-table-report-all-html" class="modal hide fade" tabindex="-1">
  <div class="modal-header no-padding">
    <div class="table-header">

      <button type="button" class="close" data-dismiss="modal">×</button>
      <span id="modal-table-report-all-html-title">Grading Report</span>
      <a class="" target="_blank" href="https://labs.vocareum.com/main/main.php?m=editor&amp;nav=1&amp;asnid=121095&amp;stepid=121096" id="modal-table-report-all-html-link">
					<i style="margin-left:10px" class="icon-external-link icon-only white"></i>
			</a>
    </div>
  </div>

  <div class="modal-body" id="modal-table-report-all-html-body">
      <iframe id="modal-table-report-all-html-iframe" src="./prova Html_files/saved_resource(1).html" width="100%" height="100%" frameborder="0"></iframe>
  </div>
</div>

                                          
<div id="modal-table-report-run" class="modal hide fade" tabindex="-1" style="height:50% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">×</button>
      <span style="font-size: 15px">RUN Report</span>
    </div>
  </div>
                        
   <div id="report_run_div" class="modal-body no-padding">
     <p id="report_run_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>
</div>
<div id="modal-table-report-build" class="modal hide fade" tabindex="-1" style="height:50% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">×</button>
      <span style="font-size: 15px">BUILD Report</span>
    </div>
  </div>

   <div id="report_build_div" class="modal-body no-padding">
     <p id="report_build_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>
</div>

<div id="modal-edit-vers" class="modal hide fade" tabindex="-1" style="height:70% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal" onclick="location.href=&#39;main.php?m=editor&amp;mode=s&amp;asnid=121095&amp;stepid=121096&amp;version=0&#39;">
        <h3>Close</h3>
      </button>
      <span style="font-size: 15px">Edit Versions <i id="versspinbox" class="icon-spin icon-spinner" style="display: none;"></i></span>
    </div>
  </div>

   <div id="edit_vers_div" class="modal-body no-padding" style="margin-left: 10px !important; font-family: Courier;">
      <table id="verstable" class="table table-hover table-bordered" style="border-top: 0 !important;">
        <tbody><tr>
          <th>Version</th>
          <th>Name</th> 
          <th>Deleted</th>
          <th>Action</th>
        </tr>
         
     </tbody></table>
     <button type="button" class="btn btn-small btn-info vocbtn vocbtn-info" onclick="newvers();">Add a version</button>
   </div>
</div>

<div id="modal-git-actions" class="modal hide fade" tabindex="-1" style="height:50% !important;">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">
        <h3>Close</h3>

      </button>
      <span id="git_actions_lable" style="font-size: 15px">Git action status</span>
    </div>
  </div>

   <div id="git_actions_div" class="modal-body no-padding">
     <p id="git_action_msg_box" style="margin-left: 10px !important;"></p>
   </div>
</div>

<div id="grades-modal" class="modal hide fade" tabindex="-1" style="height:75% !important; overflow: hidden !important;">
    <div class="modal-header no-padding">
        <div class="table-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            &nbsp;
            <span class="modal-title"></span>
        </div>
    </div>

    <div class="modal-body" style="max-height: none; height: 85%;">
        <iframe style="width: 100%; height: 100%; border: none;" src="./prova Html_files/saved_resource(2).html"></iframe>
        <div id="spinner" class="center" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0; background-color: #fff;">
            <div style="width: 100%; height: 100%; position: relative;">
                <i class="icon-spinner icon-spin light-grey bigger-275" style="position: absolute; width: 42px; height: 42px; left: 0; right: 0; top: 0; bottom: 0; margin: auto;"></i>
            </div>
        </div>
    </div>
</div>

<div class="modal hide fade" id="jupyterModal" role="dialog" style="width:80%; min-width:400px; max-height:90%; height:auto;">
  <div id="jupyterModal_dialog" class="modal-dialog jupyter-modal-dialog">
    <div id="jupyterModal_content" class="modal-content">

      <div id="jupyterModal_header" class="modal-header">
        <h3>Jupyter</h3>
        <h6>
          This process will strip out the code marked with BEGIN_SOLUTION and BEGIN_HIDDEN_TESTS pragmas and copy the resulting notebook to the Starter Code.
        </h6>
        <h6>
          This will, optionally, extract nbgrader-style grading items and sync them with the Vocareum environment. New grading items will be added and existing ones with new scores will be updated. If no submissions have been made, an option to delete unused grading items will be available.
        </h6>
        <h6>
          A grading script will also be generated (unless one already exists and the overwrite option below is unselected). Additionally, there is an option to create a link to the resource directory in the Starter Code so that notebooks can access that area via './resource'.
        </h6>
      </div>

      <div id="jupyterModal_body" class="modal-body" style="padding-bottom: 0px;">
        <span id="jupyterModal_files">
          Notebook(s) to be released:

          <table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">
            <tbody><tr id="jupyter_file_1">
              <td class="jupyter-modal-td-file"><input class="span1 jupyter-modal-td-checkbox" type="checkbox" checked="">
                File1.ipynb
              </td>
            </tr>
          </tbody></table>

          <br>
          This process will also generate the grading script
          <table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">
            <tbody><tr id="jupyter_file_ow">
              <td style="text-align:left; border:0px; padding-bottom:0px"><input class="span1" style="margin-bottom:6px; width:20px" type="checkbox" checked="">
                Overwrite grading script if it exists
              </td>
            </tr>
          </tbody></table>

        </span>
      </div>

      <div class="modal-footer" id="jupyterModal_footer" style="margin-top: 15px;padding: 15px 0 15px 0 !important; background-color:white">
        <div id="jupyterModal_output">
          <textarea id="jupyterModal_ta" style="height:100px; display:none; text-align:left !important; width:98%; border:0px; margin-bottom: 10px;padding-bottom: 10px;padding-top: 0px; resize:none; border-bottom:1px solid lightgray;">          </textarea>
        </div>

        <button id="jupyterModal_ok" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; display:none; margin-right:10px !important" data-dismiss="modal">Ok</button>
        <button id="jupyterModal_cancel" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important" data-dismiss="modal">Cancel</button>
        <button id="jupyterModal_release" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important">Release</button>
        
      </div>

    </div>
  </div>
</div>

<div class="modal hide fade" id="jupyterClearOutputModal" role="dialog" style="width:65%; min-width:400px; max-height:90%; height:auto;">
  <div id="jupyterClearOutputModal_dialog" class="modal-dialog jupyter-modal-dialog">
    <div id="jupyterClearOutputModal_content" class="modal-content">

      <div id="jupyterClearOutputModal_header" class="modal-header">
        <h3>Jupyter</h3>
        <h6>
          This will clear out all the output arrays in the selected notebook(s) and save it in a copy; the original notebook will not be modified.
        </h6>
        <h6>
          This is useful when notebook sizes get very large due to debug print statements and they take a long time to load.
        </h6>
      </div>

      <div id="jupyterClearOutputModal_body" class="modal-body" style="padding-bottom: 0px;">
        <span id="jupyterClearOutputModal_files">
          Notebook(s) to be released:

          <table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">
            <tbody><tr id="jupyter_file_1">
              <td class="jupyter-modal-td-file"><input class="span1 jupyter-modal-td-checkbox" type="checkbox" checked="">
                File1.ipynb
              </td>
            </tr>
          </tbody></table>

          <br>
          This process will also generate the grading script
          <table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">
            <tbody><tr id="jupyter_file_ow">
              <td style="text-align:left; border:0px; padding-bottom:0px"><input class="span1" style="margin-bottom:6px; width:20px" type="checkbox" checked="">
                Overwrite grading script if it exists
              </td>
            </tr>
          </tbody></table>

        </span>
      </div>

      <div class="modal-footer" id="jupyterClearOutputModal_footer" style="margin-top: 15px;padding: 15px 0 15px 0 !important; background-color:white">
        <div id="jupyterClearOutputModal_output">
          <textarea id="jupyterClearOutputModal_ta" style="height:80px; display:none; text-align:left !important; width:98%; border:0px; margin-bottom: 10px;padding-bottom: 10px;padding-top: 0px; resize:none; border-bottom:1px solid lightgray;">          </textarea>
        </div>

        <button id="jupyterClearOutputModal_cancel" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important" data-dismiss="modal">Cancel</button>
        <button id="jupyterClearOutputModal_co" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important">Clear Output</button>
        <button id="jupyterClearOutputModal_ok" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; display:none; margin-right:10px !important" data-dismiss="modal">Ok</button>        
      </div>

    </div>
  </div>
</div>


<div class="modal hide fade" id="clabsStateModal" role="dialog" style="max-height:50%; height:auto; width:50%; min-width:300px">
  <div id="clabsStateModal_dialog" class="modal-dialog jupyter-modal-dialog">
    <div id="clabsStateModal_content" class="modal-content">

      <div id="clabsStateModal_header" class="modal-header" style="padding-bottom:10px; border-bottom-color:#3e3e3e">
        <h3>Lab status</h3>
      </div>

      <div id="clabsStateModal_body" class="modal-body" style="padding-bottom: 15px; border-bottom:1px solid; border-bottom-color:#3e3e3e">
        <span id="clabsStateModal_vms">
          <table class="table table-first-column-check table-hover" style="margin-bottom:0px" border="1" frame="void" rules="rows">
            <tbody><tr id="vm_1" class="clabs-state-modal-tr-vm">
              <td class="clabs-state-modal-td-vm span6">
                Linux-1
              </td>
              <td class="clabs-state-modal-td-state span6">
                shutting down <i id="vm_1_spinbox" class="icon-spin icon-spinner"></i>
              </td>
            </tr>
            <tr id="vm_2" class="clabs-state-modal-tr-vm">
              <td class="clabs-state-modal-td-vm span6">
                Linux-2
              </td>
              <td class="clabs-state-modal-td-state span6">
                shutting down <i id="vm_2_spinbox" class="icon-spin icon-spinner"></i>
              </td>
            </tr>
          </tbody></table>
          <br>

        </span>
      </div>

      <div class="modal-footer" id="clabsStateModal_footer" style="padding: 15px 0 15px 0 !important; background-color:white;"> <!--  border-top-color:#3e3e3e"> -->

        <div id="clabsStateModal_msg">
          <textarea id="clabsStateModal_ta" style="height:50px; display:none; text-align:left !important; width:98%; border:0px; margin-bottom: 10px;padding-bottom: 10px;padding-top: 0px; resize:none; border-bottom:1px solid; border-bottom-color:#3e3e3e;">          </textarea>
        </div>

        <button id="clabsStateModal_ok" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important" data-dismiss="modal">Ok</button>
      </div>

    </div>
  </div>
</div>

<!-- end of modals -->

                            

<script>

var left_panel_instructions = 1;
$('#detailspinbox').hide();
  $('#labspinbox').hide();
  $('#endclabspinbox').hide();
$('#versspinbox').hide();

$('#showfullscreen').on('click', function()
	    {
	              var fullbox = document.getElementById("editordiv");

	              if (!document.mozFullScreen && !document.webkitFullScreen) {
	              if (fullbox.mozRequestFullScreen) {
	                  fullbox.mozRequestFullScreen();
	              } else {
	                  fullbox.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
	              }
	            } else {
	              if (document.mozCancelFullScreen) {
	                document.mozCancelFullScreen();
	              } else {
	                document.webkitCancelFullScreen();
	              }
	            }
	    });



	var gloss_theme = 0;
	var editor_content_change = 0;
	var viewer_last_fname = null;
	var viewer_last_fpath = null;
	var viewer_first_fpath = "/";


    var doc_panel_width = 0;
    function isTextFile(ext) {
    	// // EDIT_EXT
    	var js_ext_array = ["java","xml","txt","text","py","c","C","cpp","cc","h","php","js","json","sql","html","vhd","vhdl","properties","mak","hpp","htm","html","sh","pl","pm","ml","R","csv","s","asm","m","pml","config","css","rb"];
    	if (!ext) return false;
			if (js_ext_array.indexOf(ext.toLowerCase()) == -1) return false; 
			return true;
    }
    function isVidFile(ext) {
    	var js_ext_array = ["mp4"];
    	if (!ext) return false;
			if (js_ext_array.indexOf(ext.toLowerCase()) == -1) return false; 
			return true;
    }
    function isImgFile(ext) {
    	var js_ext_array = ["jpg","jpeg","bmp","gif","png"];
    	if (!ext) return false;
			if (js_ext_array.indexOf(ext.toLowerCase()) == -1) return false; 
			return true;
    }
    function isOtherFile(ext) {
    	var js_ext_array = ["pdf"];
    	if (!ext) return false;
			if (js_ext_array.indexOf(ext.toLowerCase()) == -1) return false; 
			return true;
    }  
    function isBrowserViewableFile(ext) {
    	var js_ext_array = ["html","htm","md","markdown","mdown"];
    	if (!ext) return false;
			if (js_ext_array.indexOf(ext.toLowerCase()) == -1) return false; 
			return true;
    }      

    function canOpenFile(filename) {
			var ext_index = filename.lastIndexOf('.');
			if (ext_index == -1) {
				ext = null;
			} else {
            	ext = filename.substring(ext_index + 1);
			}

			if ((ext == null) || isTextFile(ext)) {
				return true;
			} else {
				return false;
			}
    }  

	function findMode(filename) {
		ext = filename.split('.').pop().toLowerCase();
		switch (ext) {
			case "java": 
				mode = "text/x-java";
				break;
			case "xml": 
				mode = { name: "text/html", alignCDATA: true };
				break;
			case "py": 
				mode = "text/x-python";
				break;			
			case "php":
				mode = "application/x-httpd-php";
				break;
			case "c":
			case "h":
				mode = "text/x-csrc";
				break;
			case "hpp":
			case "cpp":
			case "c++":
				mode = "text/x-c++src";
				break;
			case "md":
				mode = "gfm";
				break;
			case "js":
				mode = { name: "text/javascript", globalVars: true };
				break;
			case "css":
				mode = "text/css";
				break;
			case "sql":
				mode = "text/x-sql";
				break;
			default: 
				mode = { name: "text/html", alignCDATA: true };
				break;
		}
		return mode;
	}
	function findReadOnlyDelimiter(filename) {
		var delim = filename.split('.').pop().toLowerCase();
		switch (ext) {
			case "java": 
				delim = "//";
				break;
			case "py": 
				delim = "#";
				break;			
			case "php":
			case "c":
			case "cpp":
			case "c++":
			default: 
				delim = "//";
				break;
		}
		return delim;
	}	
	var vocIndentSize = 4;
	
  function vocBetterTab(cm) {
    if (cm.somethingSelected()) {
      cm.indentSelection("add");
    } else {
      cm.replaceSelection(cm.getOption("indentWithTabs")? "\t":
        Array(cm.getOption("indentUnit") + 1).join(" "), "end", "+input");
    }
  }

  function vocDefaultTab(cm) {
    if (cm.somethingSelected()) {
      cm.indentSelection("add");
    } 
    else {
      cm.execCommand("insertTab");
    }
  }

  var editor = CodeMirror.fromTextArea(document.getElementById("codearea0"), {
        lineNumbers: true,
        styleActiveLine: true,
    matchBrackets: true,
    autoCloseBrackets: false,
        autoCloseTags: true,
        lineWrapping: true,
    indentUnit: vocIndentSize,
    smartIndent: true,
    mode: {name: "xml", alignCDATA: true},
	theme: "neat",
          extraKeys: { Tab: vocBetterTab },
      });

  cm_mode = findMode("");
  editor.setOption("mode", cm_mode);
  editor.setOption("readOnly", true);  

  editor.clearHistory();

  var map = {
    "Cmd-E": function(cm){
      console.log("Command E");
      var terminalFrame = document.getElementById('terminalIframe');
      if (document.getElementById('consolediv') && ($('#consolediv').height() != 0) && terminalFrame) {
          //terminalFrame.focus();
          terminalFrame.contentWindow.vocLaunchTerminalButton().focus();
      } else if (document.getElementById('navbar-logo')) {
          document.getElementById('navbar-logo').focus();
      } else {
          // set focus to any other element if navbar is not present
          document.getElementById('breadcrumb-type-link').focus();
      }
    }, 
    "Ctrl-Space": "autocomplete"
  }
  editor.addKeyMap(map);
     
  	var lastEditTime = 0;
	numEdits = 1;
	function handleEditorChange(doc, param) {
		lastEditTime = new Date().getTime();
		if (numEdits) {
                   if( save_in_progress ){
                     $('#editor-save-status-btn').hide();
                     $("#editor-save-status").show();
                     $("#editor-save-status").html("Saving...pending");
                   } else {
                     $('#editor-save-status-btn').show();
                     $('#editor-save-status-btn').html("Save pending");
                     $("#editor-save-status").hide();
                   }
		}
		numEdits++;
	}	 
 	 
 	 editor.on("change", handleEditorChange);	 
 	 function vocIsFileReadOnly(fpath) {
 	 	return false;
	  }

	
  $('.vocdivider').draggable({
    axis: 'x', 
    containment: 'parent',
    helper: 'clone', 
    drag: function (event, ui) {
        var width = ui.offset.left; 
        var width_of_right_panel = $("#idebox").width() - width;
        if (width_of_right_panel < 200) {
          return;
        }
        //if (width > 500) return; // at most
        if (left_panel_instructions) {
          if ($('#showdocviewicon').hasClass("icon-check-empty")) {
            $('#filelisting').width(width); 
          } else {
            $('#instructions').width(width); 
            doc_panel_width = width;
          }
        } else {
          $(this).prev().width(width); 
        }
                          $('#readMeIframe').css('pointer-events', 'none');
            },
    start: function() {
                    $('#readMeIframe').css('pointer-events', 'none');
          },
    stop: function() {
                    $('#readMeIframe').css('pointer-events', 'auto');
          }
  });

  $('.vocdivider_v2').draggable({
    axis: 'x', 
    containment: 'parent',
    helper: 'clone', 
    iframeFix: true,
    scroll: false,
    drag: function (event, ui) {
        var width = ui.offset.left; 

        // min/max of movement is controlled by the min/max where buildframe is defined
        // var width_of_right_panel = $("#buildframe").width();
        // if (width_of_right_panel < 50) {
        //   return;
        // }
        // if (width_of_right_panel > 400) {
        //   return;
        // }

        //mhui
        var idebox_width = $('#idebox').width();
        var element =  document.getElementById('gradeframe');
        if (typeof(element) != 'undefined' && element != null && element.style.display == 'block')
        {
            $('#buildframe').width(idebox_width - width - $('#gradeframe').width() - 10);
        }
        else
        {
            $(this).prev().width(idebox_width - width);
        }
    },
  });


 

// var for copypaste feature
var copyPasteClipboard = false;
function saveCBClipboard(path)
{
    $.ajax({
      url: "../util/vcput.php",
      type: "get",
      data: {
        a: "saveClipboard",
        userid:460852,
        asnid:121096,
        mode:'s',
        version:'0',
        path:path
      },
      success: function(data) {
        var ap = data.search(/voc::/);
        var bp = data.search(/::voc/);
        if(ap>=0 && bp>=0 && bp>ap){
          show_voc_gritter(false, data.substring(ap+5, bp-ap-5), false);
        } else {
          show_voc_gritter(false, "Copied", false);
          copyPasteClipboard = true;
        }
        return false;
      }
    });
}
var pasteprogress=0;
function pasteCB(type, path, source, msg, confirm) {
      /* default value to be used for confirm - better to do it this way
       * than doing it in the funtion signature otherwise some browser
       * versions e.g. IE, Edge has problem showing IDE page
       */
      if(confirm === undefined) {
        confirm = false;
      }
      if( pasteprogress>0 ){
        alert('Paste-workarea is in progress, please wait until the prior operation finishes.');
        return false;
      }
      pasteprogress++;
      var stepstr = "&stepid=121096";
      var url = "../util/vcsave.php?asnid=121095"+stepstr+"&mode=s&version=0&type="+type+(confirm? '&confirm=1' : '') + "&vm=34.209.4.84&labtype=0";
      $.ajax({
        type: 'POST',
        url: url,
        async: false,
        data: {filepath: "./"+path , sourcepath: "./"+source}
        })
          .done(function(ret_val) {
                  if(pasteprogress) --pasteprogress;
                  if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                      window.location.replace("https://labs.vocareum.com/main/logout.php");
                  }
                  if (ret_val.indexOf('<ERROR:') !== -1) { // error
                    show_voc_gritter(false, ret_val.substring(7), true);
                  } else {
                    show_voc_gritter(false, msg, false);
                    refreshFileTree(true, true);
                  }

          })
             .fail(function(ret_val) {
                  if(pasteprogress) --pasteprogress;
                  show_voc_gritter(false, "Paste-workarea failed. Please check your internet connection", true);
          });
          return true;
}

</script>


		<!-- ace scripts -->
		<!-- page specific plugin scripts -->
		<script src="./prova Html_files/fuelux.tree-sampledata.js.download"></script>
		<script src="./prova Html_files/fuelux.tree.js.download"></script>
		
		<script type="text/javascript">	

                			var tree_data; 
			console.log('latest: no'); 

 tree_data = { 
  'work' : {name:'work',  base:'1',  type:'folder', nc:'', unfold:'0', ed:'0', ec:'1', path:'./work',} , 
 } 


tree_data_files = ' ./work'

				var treeDataSource = new DataSourceTree({data: tree_data});

var codeCommentWidgets = [];
	function removeLineWidgets() {
                if (codeCommentWidgets.length) {
                    for (var i = 0; i < codeCommentWidgets.length; i++) {
                        codeCommentWidgets[i].clear();
                    }

                    codeCommentWidgets = [];
            	}
        }
function showCodeComment(ids) {
        var id, codeComment, node;

	removeLineWidgets();
        if (ids == '') {
            return;
        } 
        var ids = ids.split(',');

        

    for (var i = 0; i < ids.length; i++) {

        id = ids[i];

        codeComment = getCodeComment(id);
        
        if (codeComment.selectedPeer == 1) {
            commenterName = "Peer reviewer";
        } else {
                            commenterName = codeComment.name;
                    }

        node = $('\
            <div class="vocborder-1" style="position: relative; padding: 4px 30px 4px 6px; background: #f7f7f7; border-color: #ddd !important; border-left: none !important; margin: 4px 0 !important; z-index: 4;">\
                <strong style="color: #3b7fd4;">' + commenterName + ', ' + codeComment.time + ' ago</strong>\
                ' + (codeComment.selectedComment.length ? ('<pre style="padding-top: 4px;">' + codeComment.selectedComment + '</pre>') : '')  + '\
            </div>'
        )[0];

        codeCommentWidgets.push(editor.addLineWidget(codeComment.selectedLine, node, {above: false, coverGutter: false, noHScroll: true}));
    }
}


                var readonlyWidgets = [];
                
                function clearReadOnlyWidgets() {
                    if (readonlyWidgets.length) {
                        for (var i = 0; i < readonlyWidgets.length; i++) {
                            readonlyWidgets[i].clear();
                        }

                        readonlyWidgets = [];
                    }

                }	
                function addReadOnlyWidget(widget) {
                    readonlyWidgets.push(widget);
                }		
				
			function voc_process_readonly(cm, delim, begins, ends) {
			    var expectingBegin = true;
			    for (i=0; i< cm.doc.lineCount(); i++) {
			    
			    var test = delim+"READONLY_BEGIN";
			    
			        var val = cm.getLine(i);
			        val = val.replace(/ /g,'');
			        if (val == delim+"READONLY_BEGIN") {
			            if (!expectingBegin) return false; 
			            begins.push(i);
			            expectingBegin = false;
			        } else if (val == delim+"READONLY_END") {
			        	if (expectingBegin) return false;
			        	ends.push(i);
			        	expectingBegin = true;
			        } else {
			        }
			    }
			    if (begins.length && (begins.length == ends.length)) {
			        return true;
			    } else {
			        return false;
			    }
			}
			var largefileurl = null;

                        function voc_get_viewer_code(fpath, fname, lineNum, codeComments){		
                $("#editor_current_file").html('<i class="icon-spin icon-spinner"></i>Reading ... ' + fpath.substring(2));
	

        var stepstr = "&stepid=121096";        
        				
				var url = "../util/vcprojapi.php?t=filefetch&mode=s&getcode=1&data="+encodeURIComponent(fpath)+"&getlarge=0&asnid=121095&version=0"+stepstr + "&vm=34.209.4.84&labtype=0";
				var data = fpath; 

				$.post(url,{},function(ret_val)
				{
					if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
						window.location.replace("https://labs.vocareum.com/main/logout.php");
					}
					
				  if (ret_val.indexOf('VOCAREUM-ERROR') !== -1) { // due to Db traffic or something
                                      show_voc_gritter(false, "Error retrieving file, please try again", true);
                                      return;
                                  }
				  if (ret_val.indexOf('<ERROR:FILE_TOO_BIG>') !== -1) { // too large to show in editor
				      largefileurl = url + "&dl=1";
				      $('#largefile-download').attr('href',largefileurl);
				      $('#largefile-viewer-modal').modal('show');
				      return;
				  }	
				

					$('#codebtn').tab('show');

					numEdits = 0; // reset num of edits for this file

					cm_mode = findMode(fpath);
					editor.setOption("mode", cm_mode);
                                        $("#editor-save-status").show();
                                        $('#editor-save-status-btn').hide();
                                        if(ret_val.length>8388608/*8MB*/ || (fpath && fpath.search(/^\.\/(LIB|ASNLIB|resource\/lib|resource\/asnlib)\/publicdata\//)>=0) ){
                                          editor.setOption("readOnly", true);
                                          if(ret_val.length>8388608){
                                            $("#editor-save-status").html("Read only[<font color='red'>8MB+</font>]");
                                          } else {
                                            $("#editor-save-status").html("Read only");
                                          }
                                        } else {
                                          $("#editor-save-status").html("");
                                        }
					editor.setValue(ret_val);
					editor.clearHistory();

					editor_content_change = editor.doc.changeGeneration();
					
						        // check ext. check if copy of default
					var ro_begins = [];
					var ro_ends = [];
					var delim = findReadOnlyDelimiter(fpath);

                    var readonly_lines = voc_process_readonly(editor, delim, ro_begins, ro_ends);
                    
                    clearReadOnlyWidgets(); // clear last

                    if (readonly_lines && (ro_begins.length > 0)) {
                    
                        for (i = 0; i < ro_begins.length; i++) {
                              var msg1 = document.createElement("div");
                              // msg1.appendChild(document.createTextNode("Start readonly code"));
                              msg1.className = "voc-readonly-top";
                              
                              var label = document.createElement("span");
                              label.className = "label label-warning";
                              label.appendChild(document.createTextNode("READ ONLY"));
                              msg1.appendChild(label);
                              
                              var msg2 = document.createElement("div");
                              // msg2.appendChild(document.createTextNode("End of readonly code"));
                              msg2.className = "voc-readonly-bottom";                             
                              
                              ro_widget1 = editor.addLineWidget(ro_begins[i], msg1, {above:true, coverGutter: false, noHScroll: true});
                              ro_widget2 = editor.addLineWidget(ro_ends[i], msg2, {coverGutter: false, noHScroll: true});

                              addReadOnlyWidget(ro_widget1);
                              addReadOnlyWidget(ro_widget2);

                              editor.markText(
                                {line: ro_begins[i],ch:0}, {line: ro_ends[i] + 1, ch:0},        
                                    {
                                        readOnly:true, 
                                        atomic: true,
                                        className:"vocbghighlight",
                                        title:"READONLY"
                                    }
                              );
                                
                        }
                    }
            
					viewer_last_fname = fname;
					viewer_last_fpath = fpath;
					$("#editor_current_file").html(fpath.substring(2));
                                      					if (lineNum > 0) {
						if (lineNum > 0) lineNum = lineNum - 1;
						editor.setCursor(lineNum);
					}


          showCodeComment(codeComments);
				});
			  return false;
			}
			

            function subTreeInit() {
    			var s3_data;
    			$.ajax({
    		        url: "submissiontree.php",
    		        method: "GET",
    		        dataType: "JSON",
    		        async: false,
    		        data: {
    		            courseid: "11575",
    		            asnid: "121096",
    		            userid: "460852",
    			        published: "0",
        			    ide: 1
    		        },
    		        success: function(data) {
    		    		s3_data = data;
    		        }
    		    });
    			subDataSource = new DataSourceTree({data: s3_data});
    			
    			$('#trees3').ace_tree({
    				dataSource: subDataSource,
    				multiSelect: false,
    				loadingHTML:'<div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div>',
    				'open-icon' : 'icon-minus',
    				'close-icon' : 'icon-plus',
    				'selectable' : true,
    				'selected-icon' : 'icon-caret-right',
    				'unselected-icon' : 'icon-caret-right',
    				cacheItems: true
    			});
    		}

    		function refreshSubTree() {
    			$('#trees3').remove();
    			$("<div id='trees3' class='tree' style='background:white;'></div>").insertAfter('#tree1');
    			subTreeInit();
    		}
    		
            function voc_get_s3_code(fpath, fname, lineNum, codeComments) {		
                $("#editor_current_file").html('<i class="icon-spin icon-spinner"></i>Reading ... ' + fpath);

    	        var stepstr = "&stepid=121096";		
    			var url = "../util/vcprojapi.php?t=filefetch&mode=s&getcode=1&data="+encodeURIComponent(fpath)+"&getlarge=0&userid=460852&asnid=121095&version=0"+stepstr;
    			var data = fpath; 

    			$.post(url,{},function(ret_val) {
    				if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
    					window.location.replace("https://labs.vocareum.com/main/logout.php");
    				}
				if (ret_val.indexOf('VOCAREUM-ERROR') !== -1) { // due to Db traffic or something
                                    show_voc_gritter(false, "Error retrieving file, please try again", true);
                                    return;
                                }
    			  	if (ret_val.indexOf('<ERROR:FILE_TOO_BIG>') !== -1) { // too large to show in editor
    		    		largefileurl = url + "&dl=1";
    					$('#largefile-download').attr('href',largefileurl);
    					$('#largefile-viewer-modal').modal('show');
    					return;
    				}
    			
    				$('#codebtn').tab('show');

    				numEdits = 0; // reset num of edits for this file

    				cm_mode = findMode(fpath);
    				editor.setOption("mode", cm_mode);
                    $("#editor-save-status").show();
                    $('#editor-save-status-btn').hide();
                    editor.setOption("readOnly", true);
                    
                    if(ret_val.length>8388608/*8MB*/ || (fpath && fpath.search(/^\.\/(LIB|ASNLIB|resource\/lib|resource\/asnlib)\/publicdata\//)>=0) ){
                        if(ret_val.length>8388608) {
                            $("#editor-save-status").html("Read only[<font color='red'>8MB+</font>]");
                        } else {
                            $("#editor-save-status").html("Read only");
    					}
    				} else {
    					$("#editor-save-status").html("");
    				}
    				
    				editor.setValue(ret_val);
    				editor.clearHistory();
    				editor_content_change = editor.doc.changeGeneration();
    				$("#editor_current_file").html(fpath);
    				
    				if (lineNum > 0) {
    					if (lineNum > 0) lineNum = lineNum - 1;
    					editor.setCursor(lineNum);
    				}

    				showCodeComment(codeComments);
    			});
    		  return false;
    		}

            
	    var $foldersToUnfold = [];
	    

      var unfoldLoopCount = 0;
      function unfoldTree() {
                    
          if ($foldersToUnfold.length <= 0) return;
          if (unfoldLoopCount++ > 20) {
              $foldersToUnfold = [];
              return;
          }

          $('.tree-folder-header').each(function() {
              $val = $(this).data();
              // console.log("element is "+$val['path']);
              if ('path' in $val) {
                  $val['path'] = $val['path'].trim();
                  var tmpIndex = $foldersToUnfold.indexOf($val['path']);
                  if (tmpIndex != -1) {
                          $('#tree1').tree('selectFolder', $(this));
                          $foldersToUnfold.splice(tmpIndex, 1);
                  }
              }
          });      
          window.setTimeout('unfoldTree()', 100);                 
      
      }	    
	    var tree1_files = "";

        function refreshFileTree(workchanged, retainwork) {
                  
            $('.tree-folder-header').each(function() {
                    $val = $(this).data();
                    if (1 || ('base' in $val)) {
			                  if ($(this).children(".icon-minus").length) { 
			                      if (($val.path == "./work") && (!retainwork)) {
			                      } else {
                                $foldersToUnfold.push($val.path);
                            }
                        }
                    }
            });
            var stepstr = "&stepid=121096";

            $.ajax({
            url: "../util/vcprojapi.php?t=getFileTree&asnid=121095"+stepstr+"&mode=s&name=tree1&version=0" + "&labtype=0&vm=34.209.4.84",
            context: document.body
            }).done(function(ret_val) {

                  if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                      window.location.replace("https://labs.vocareum.com/main/logout.php");
                  }

                  var errPrefix = '<ERROR:';
                  if (ret_val.indexOf(errPrefix) !== -1) { // failure
                    errStr = ret_val.substring(errPrefix.length);
                    show_voc_gritter(false, "Error retrieving file tree: " + errStr, true);
                    $('.tree-folder-header').each(function() {
                      $val = $(this).data();
                      if ('base' in $val) {
                        $par = $(this).parent();
                        $par.detach();
                      } 
                    });
                    return;
                  }

                  eval(ret_val);
                  
                  if (tree_data_files === tree1_files) {
                       console.log("Same tree");
                       $foldersToUnfold = [];
                  } else {
                      console.log("Not same tree ");

                      var treeDataSource2 = new DataSourceTree({data: tree1});

                      $('.tree-folder-header').each(function() {
                        $val = $(this).data();
                        if ('base' in $val) {
                          $par = $(this).parent();
                          $par.detach();
                        } 
                      });

                      $('#tree1').setDataSource(treeDataSource2);
                      tree_data_files = tree1_files;
                      unfoldLoopCount = 0;
                      window.setTimeout('unfoldTree()', 100);
                   }             
 
                       

                   reportsToOpen = true; // if the refresh happens - click the reports again
            });
            
                    }
 
        function markUpdateChanged(path)
        {
          if( path.search(/^work/)<0 &&
              path.search(/^\.\/work/)<0 ) {
            $('#updatebtntext').html('Update*');
          }
        }
     
        $('#cmdprogressbtn').hide();
        var cmdprogress = 0;
        function voc_create_confirm(type, path, source, msg, qstr)
        {
          bootbox.dialog(qstr, [{
                                 "label" : "Yes",
                                 "class" : "btn vocbtn-ac vocbtn-action",
                                 "callback": function() {
                                      voc_create(type, path, source, msg, true);
                                    }
                                }, {
                                 "label" : "Cancel",
                                 "class" : "btn vocbtn-ac vocbtn-status"
                                }]
                        );
          return false;
        }
        function voc_create(type, path, source, msg, confirm) {
                /* default value to be used for confirm - better to do it this way 
                 * than doing it in the funtion signature otherwise some browser 
                 * versions e.g. IE, Edge has problem showing IDE page
                 */
                if(confirm === undefined) {
                  confirm = false;
                }
                cmdprogress++;
                var stepstr = "&stepid=121096";
                var url = "../util/vcsave.php?asnid=121095"+stepstr+"&mode=s&version=0&type="+type+(confirm? '&confirm=1' : '') + "&vm=34.209.4.84&labtype=0";
                markUpdateChanged(path);
                $('#cmdprogressbtn').show();
                $.ajax({
                  type: 'POST',
                  url: url,
                  async: false, 
                  data: {filepath: "./"+path , sourcepath: "./"+source}
                  })
                    .done(function(ret_val) {
                            if(cmdprogress) --cmdprogress;
                            if(cmdprogress<1) $('#cmdprogressbtn').hide();
                            if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                                window.location.replace("https://labs.vocareum.com/main/logout.php");
                            }
                            if (ret_val.indexOf('<ERROR:') !== -1) { // error
                              show_voc_gritter(false, ret_val.substring(7), true);
                              $("#filestatuslabel").html("<i class='icon-warning-sign' style='margin-right:3px'> </i><font color=red>error</font>");
                            } else if (ret_val.indexOf('<CONFIRM:') !== -1) {
                              voc_create_confirm(type, path, source, msg, ret_val.substring(9)); 
                            } else {
                              show_voc_gritter(false, msg, false);
                              refreshFileTree(true, true);
                            }

                    })
                       .fail(function(ret_val) {
                            if(cmdprogress) --cmdprogress;
                            if(cmdprogress<1) $('#cmdprogressbtn').hide();
                            var timenow = new Date().getTime();
                            if (timenow - last_conn_warning > 10*1000) { // 10 seconds
                              show_voc_gritter(false, "File/folder creation/rename failed. Please check your internet connection", true);
                              last_conn_warning = new Date().getTime();
                            }
                    });
 
                    return true;
          }
			
			
		var save_count = 0;	
		var last_conn_warning = new Date().getTime();
    function voc_save(showGritter, dspmsg) {
        var save_ok = true;
        save_count++;
    if (save_in_progress) {
      return false;
    }
    save_in_progress = true;

    $('#editor-save-status-btn').hide();
    $("#editor-save-status").show();
    $("#editor-save-status").html('<i class="icon-spin icon-spinner"></i> '+dspmsg);

    $("#save-icon").addClass('icon-spin');
    $("#save-icon").addClass('icon-spinner');
    $('#save-icon').removeClass('vochide');
    var viewerContents = editor.getValue();
    var whichfilepath = viewer_last_fpath;
    if (!whichfilepath) whichfilepath = viewer_first_fpath;
    var filepath = encodeURIComponent(whichfilepath);				

    var stepstr = "&stepid=121096";        
    var url = "../util/vcsave.php?type=Save&asnid=121095"+stepstr+"&mode=s&version=0&filepath="+filepath + "&vm=34.209.4.84&labtype=0";
     
    editor_content_change = editor.doc.changeGeneration();
    markUpdateChanged(whichfilepath);
    $.ajax({
      type: 'POST',
      url: url,
      async: true, 
      data: {code0: viewerContents}
      })
        .done(function(ret_val) {
                if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                    window.location.replace("https://labs.vocareum.com/main/logout.php");
                }
                $("#save-icon").removeClass('icon-spin');
                $("#save-icon").removeClass('icon-spinner');
                $("#save-icon").addClass('vochide'); 
                passed = ( ret_val.indexOf('SAVE SUCCESSFUL') !== -1 );
                $("#editor-save-status").show();
                $('#editor-save-status-btn').hide();
                if (passed) {
                    $("#editor-save-status").html('<i class="icon-ok"></i> Saved');
                                                                                    } else {
                    if (1 || showGritter) {
                        if (ret_val.indexOf('<ERROR:') !== -1) { 
                            errStr = ret_val.substring(7);
                        } else {
                            errStr = ret_val;
                        }
                        show_voc_gritter(false, "Save failed. " + errStr, true);
                                                                    }
                    $("#editor-save-status").html('<i class="icon-exclamation-sign"></i> Save failed');
                }
        
             //   editor_content_change = editor.doc.changeGeneration();
                save_in_progress = false;
                var moresave = save_count>1;
                save_count = 0;
                          if( moresave ){
               window.setTimeout(function(){ voc_save(showGritter, dspmsg); } , 100);
             }
        })
       .fail(function(ret_val) {
            $("#save-icon").removeClass('icon-spin');
            $("#save-icon").removeClass('icon-spinner');
            $("#save-icon").addClass('vochide'); 
    
            var timenow = new Date().getTime();
            if (timenow - last_conn_warning > 10*1000) { // 10 seconds
              show_voc_gritter(false, "File save failed. Please check your internet connection", true);
              last_conn_warning = new Date().getTime();
            }
            save_count = 0;
            save_in_progress = false;
            save_ok = false;
        });			

		    return save_ok;
		}
			
			function isSaveNeeded() {
					var codeFileChanged = true;
					if (editor && editor.doc.isClean(editor_content_change)) codeFileChanged = false;
					if (vocIsFileReadOnly(viewer_last_fpath)) codeFileChanged = false;
					return codeFileChanged;
			}

		 var isTermActive = true;	
     function periodic_save() {
            var saveNeeded = isSaveNeeded();
      timeNow = new Date().getTime();
      if (saveNeeded && (timeNow - lastEditTime > 5000)) {
        voc_save(false, "Saving");
      } 
      if ($('#terminalIframe').length > 0) {
          if (document.activeElement.name == "terminalIframe") {
              if (!isTermActive) {
                 isTermActive = true;
                 console.log("Terminal is now active");
                 // terminalIframe.document.head.innerHTML += '<style type="text/css">.terminal-cursor{background:#AAAAAA !important;}</style>';

                 var el = terminalIframe.document.getElementById('vocCursorStyle');
                 if (el) {
                     el.innerHTML = ".terminal-cursor{background:#AAAAAA !important;";
                 }

              }
          } else { // activeElement is not terminal
              if (isTermActive) {
                 isTermActive = false;
                 console.log("Terminal is NOT active");

                 // terminalIframe.document.head.innerHTML += '<style type="text/css">.terminal-cursor{background:#F3F3F3 !important;}</style>';
                 var el = terminalIframe.document.getElementById('vocCursorStyle');
                 if (el) {
                     el.innerHTML = ".terminal-cursor{background:#F3F3F3 !important;";
                 }
                 
                 refreshFileTree(false, true);
              }
          } 
      }   
        
      window.setTimeout('periodic_save()', 1000);
     }
			 


		</script>
 



		<script type="text/javascript">	

			var save_in_progress = false;
                        var fileUploadListener = null;
			var runlog_in_progress = false;
			var verify_in_progress = false;
			var log_interval = 1;	
			var current_mode = 1;
			var previous_mode = 1;

			var viewer = false;
			var currentEditFileIndex = 0;
			var edit_file = "";
			var edit_file_name = "";


var diffArea = null;


function initDiff() {
  value = editor.getValue();
  var target = document.getElementById("div-diff");
 
  target.innerHTML = "<h4>&nbsp;<i class=\"icon-spin icon-spinner\"></i> Loading diff. Please wait. </h4>";
  
	var filepath = viewer_last_fpath;				
	if (!viewer_last_fpath) filepath = viewer_first_fpath;

	// filepath = encodeURIComponent(filepath);
	cm_mode = findMode(filepath);
	
	
	var url = "../util/vcprojapi.php?t=projsource&orig=1&asnid=121095&wa_stepid=121096&id=4336039&data=filepath&version=0";

	$.post(url,{getcode:1,data:filepath},function(ret_val)
	{
		if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
			window.location.replace("https://labs.vocareum.com/main/logout.php");
		}		
		// conversion 
		$("#scratchpad").val(ret_val);
		orig_val = $("#scratchpad").val();
			
			
		if (ret_val == "") {
		  	target.innerHTML = "<h4>&nbsp; This file has no original version. </h4>";
			diffArea = null;						
			return;
		}	
		if (orig_val == value) {
		  	target.innerHTML = "<h4>&nbsp;<i class=\"icon-check\"></i> Current version is same as the original version. </h4>";

			// target.innerHTML = "<div style=\"padding: 10px\">Current Version is exactly same as the Original Version.</div>";	
			diffArea = null;						
			return;
		}
		
		target.innerHTML = "<span style=\"padding-left:10px\">Current Version</span><span class=\"pull-right\" style=\"padding-right:10px\">Original Version</span>";							
		  orig2 = orig_val;
		  // value_mod = value.replace(/\u003cscript/g, "\u003cscript type=text/javascript ");
		  value_mod = value;
		  diffArea = CodeMirror.MergeView(target, {
			value: value_mod,
			origLeft: null,
			orig: orig2,
			lineNumbers: true,
			mode: cm_mode,
			highlightDifferences: true
		  });

	});
}

        function setConsoleParams() 
        {
                                                          var build_ht = $("#idebox").height() - $("#codeframe").height() - $("#htmlframe").height() - $('#console_divider').height() - $('#html_divider').height() -8 - 10 - 30 - 4; //-ideBtnDiv
                  var console_ht = build_ht - 18; 
                                var html_ht = $('#htmlframe').height();
                                         
          
          $("#buildframe").height(build_ht); 
          $("#consolediv").height(console_ht);     
        }

        $( document ).ready(function() {
          setConsoleParams();
          window.setTimeout('periodic_save()', 5000);
          

          
			});
			
			function indicate_build_done() {
					$("#build-icon").removeClass('icon-spin');
					$("#build-icon").removeClass('icon-spinner');
					$('#build-icon').addClass('vochide');				

                    $('#buildbtn').tab('show');
					
			}

 

					
			jQuery(function($){

          $(function() {

          });

          

	function getFilePathStr(unencoded_filepath, encodeIt)
        {
          if (unencoded_filepath.length <= 1)
          {
            return ""; 
          } 
          // if starting with "./work", remove it
          // not sure what to do about asnlib, etc. right now
          fp = unencoded_filepath.replace(/^\.\/work\//, "");
          return "&selectedfile=" + ((encodeIt == true) ? encodeURIComponent(fp) : fp);
        }
          function hideCopyFileBtn() {
              $('#filecopybtn').hide();
          }
          function showCopyFileBtn() {
              $('#downloadbtn').show();
              $('#filecopybtn').show();
          }
          function hidePasteFileBtn() {
              $('#filepastebtn').hide();
          }
          function showPasteFileBtn() {
              if (copyPasteClipboard) {
                  $('#filepastebtn').show();
              }
          }

          function hideAllFileBtn() {
                              $('#fileuploadbtn').hide();
                              $('#filedelbtn').hide();
                              $('#filerenamebtn').hide();
                              $('#newbtn').hide();
                              $("#fileform" ).hide();
                              hideCopyFileBtn();
                              hidePasteFileBtn();
          }
          function showDelFileBtn() {
                              $('#filedelbtn').show();
                              $('#filerenamebtn').show();                              
          }
          function showCreateFileBtn() {
                              // $("#fileform" ).hide();
                              $('#fileuploadbtn').show();
                              $('#newbtn').show();
          }
          function showNewBtn() {
                              $('#newbtn').show();
          }


     			
				
$("#modal-table-diff").on('shown.bs.modal', 
    function (e) {
      initDiff();
    }
);
		
		// File operation handlers
    $('#filecopybtn').on('click', function() { 
        $("#filestatuslabel").html("");
        var cb = $('#input_filename').val(); 
        saveCBClipboard(cb);
    });
    $('#filepastebtn').on('click', function() {
        $("#filestatuslabel").html(""); 
        var tgt = $("#input_filename").val();
        voc_create("Paste", tgt, '', "Paste successful");
    });



    $('#filecreatebtn').on('click', function() {
        $("#filestatuslabel").html("");
        if (fileoptype=='file') {
            voc_create("File", $("#input_filename").val(), null, "File created");
        } else if (fileoptype=='folder') {
            voc_create("Folder", $("#input_filename").val(), null, "Folder created");
        } else if (fileoptype=='rename') {
            voc_create("Rename", $("#input_filename").val(), $("#span_selectedfile").text(), "Rename successful");
        }
    });

    $('#filedelbtn').on('click', function() {
	var $val = $("#input_filename").val();
	var $type = $("#input_filetype").val();
        $("#filestatuslabel").html("");
	if ($val != '') {
				bootbox.dialog("Are you sure you want to delete "+ $type + " \"" + $val + "\" ?", [{
					"label" : "Yes",
					"class" : "btn vocbtn-ac vocbtn-action",
					"callback": function() {
						voc_create("Delete", $("#input_filename").val(), null, "Deleted");
					}
					}, {
					"label" : "Cancel",
					"class" : "btn vocbtn-ac vocbtn-status"
					}]
				);
	}
    });
    
    
        

    function isReadmeVisible() {
      if (left_panel_instructions) {
        return $('#showdocviewicon').hasClass("icon-check");
      }
      return false;
    }

    function showHideDivBasedOnHeight(divId)
    {
      if ($(divId).length) {
        if ( ($(divId).height() == 0) || ($(divId).height() == '0%') ) {
          $(divId).hide();
        } else {
          $(divId).show();
        }
      }
    }

    function showHideFramesBasedOnHeight()
    {
      showHideDivBasedOnHeight('#htmlframe');
      showHideDivBasedOnHeight('#codeframe');
      showHideDivBasedOnHeight('#buildframe');
      showHideDivBasedOnHeight('#consolediv');
    }

    if (left_panel_instructions) {
      var lang_readmes = [];
      $('#localeLangReadmeSelect').on('change', function() {
        var readmelang = $(this).val();
        langReadmePath = lang_readmes[readmelang];
        iframeReadmeSrc ="../web/460852//" + langReadmePath;
        $("#readMeIframe").attr('src', iframeReadmeSrc);
        $.ajax({
                 type: "POST",
                 url: "../util/vcprojapi.php",
                 data: { t : 'changeReadmeLang',
                         stepid : "121096",
                         readmelang : readmelang }
        }) .done(function(ret_val) {
          //just return
        });
      });
    }


    if (left_panel_instructions)
    {
      $('#showdocs').on('click', function()
      {
        $('#instructions').toggle();
        if (! isDocVisible())
        {
          checkDocSelector();
          if ($('#showfiletreeicon').hasClass("icon-check"))
          {
            $('#showfiletree').click();
          }
          if (doc_panel_width == 0)
          {
            doc_panel_width = $('#instructions').width();
          } 
          else 
          {
            $('#instructions').width(doc_panel_width);
          }
          $('#instructionsdivider').show();

          // // The file list tree is being replaced by the readme
          // // if html is visible, make sure that the "reload" button is not pulled to the leftmost edge
          // if (isHtmlVisible() && $('#htmlreloadbtn').is(':visible'))
          // {
          //   $('#htmlreloadbtn').css('cssText', 'margin-left: ' + (doc_panel_width + $('#instructionsdivider').width() + 5) + 'px !important');
          // }
          // else 
          // {
          //   $('#htmlreloadbtn').css('cssText', 'margin-left: ' + (doc_panel_width + $('#instructionsdivider').width() + 5) + 'px !important; display:none;');
          // }
        } 
        else 
        {
          uncheckDocSelector();
          $('#instructionsdivider').hide();

          // if (isHtmlVisible() && $('#htmlreloadbtn').is(':visible'))
          // {
          //   $('#htmlreloadbtn').css('cssText', 'margin-left: ' + 5 + 'px !important');
          // }
          // else 
          // {
          //   $('#htmlreloadbtn').css('cssText', 'margin-left: ' + 5 + 'px !important; display: none;');
          // }

          /* the following condition will only be true in case of README 100% */
          if (!isSourceVisible() && !isConsoleVisible() && !isHtmlVisible())
          {
            $('#showfiletree').click();
          }

          /* the following condition will only be true in case of README 100% */
          if (!isSourceVisible() && !isConsoleVisible() && !isHtmlVisible())
          {
            $('#showfiletree').click();
          }
        }
      });
    }
                         
    $('#showfiletree').on('click', function() 
    {
      $('#filelisting').toggle(); // hide <=> show
      if (! isFileTreeVisible())
      {
        checkFileTreeSelector();
        if (left_panel_instructions) 
        {
          if (isDocVisible())
          {
            $('#instructions').width(doc_panel_width);
            $('#showdocs').click();
          }
        }
        $('#filelistdivider').show();
        $('#filelistbuttons').show();
        showFileTreeSource();
      } 
      else 
      {
        uncheckFileTreeSelector();
        $('#filelistdivider').hide();
        $('#filelistbuttons').hide();
      }
    });

    function showFileTreeSource() {
      /* the following condition will only be true in case of README 100% */
      if ( !isSourceVisible() && !isConsoleVisible() && !isHtmlVisible() )
      {
        viewPreExpandedReadmeFrame();
      }
    }

    function viewSaveData()
    {
      code_ht = $('#codeframe').height();   
      build_ht = $('#buildframe').height(); 
      console_ht = $('#consolediv').height();
      html_ht = $('#htmlframe').height();
      console_divider_ht = $('#console_divider').height();
      infobar_ht = 0;
      initial_frame_count = ((code_ht > 0) ? 1 : 0) + ((build_ht > 0) ? 1 : 0) + ((html_ht > 0) ? 1 : 0);
      intial_total_frame_ht = code_ht + build_ht + html_ht + console_divider_ht;
      frame_idebox_ht = $('#idebox').height();
      frame_idebox_ht = frame_idebox_ht - $('#ideButtonDiv').height();
    }
                          
    function viewIsSameAsInitial(hasSource, hasConsole, hasHtml)
    {
      return (   ((hasSource  && (code_ht  > 0)) || (!hasSource  && (code_ht  == 0)))
              && ((hasConsole && (build_ht > 0)) || (!hasConsole && (build_ht == 0)))
              && ((hasHtml    && (html_ht  > 0)) || (!hasHtml    && (html_ht  == 0)))  );
    }

    function hideSourceExtras()
    {
      if (! $('#editor_current_file').hasClass("hidden-1"))
      {
        $('#editor_current_file').addClass("hidden-1");
        $('#file_colon').addClass("hidden-1");
        $('#editor-save-status').addClass("hidden-1");
        $('#editor_current_ts').addClass("hidden-1");
      }
    }

    function showSourceExtras()
    {
      if ($('#editor_current_file').hasClass("hidden-1"))
      {
        $('#editor_current_file').removeClass("hidden-1");
        $('#file_colon').removeClass("hidden-1");
        $('#editor-save-status').removeClass("hidden-1");
        $('#editor_current_ts').removeClass("hidden-1");
      }
    }

    function showHtmlExtras()
    {
      $('#htmlreloadbtn').show();
      $('#showhtml').show();
    }

    function hideHtmlExtras()
    {
      $('#htmlreloadbtn').hide();
      // $('#showhtml').hide();
    }

    function showSourceConsoleExtras()
    {
      $('#console_divider').show();
    }
    
    function hideSourceConsoleExtras()
    {
      $('#console_divider').hide();
    }

    function uncheckConsoleSelector()
    {
      if ($('#showterminalicon').hasClass("icon-check"))
      {
        $('#showterminalicon').removeClass("icon-check");
        $('#showterminalicon').addClass("icon-check-empty");
      }
    }
      
    function checkConsoleSelector()
    {
      if ($('#showterminalicon').hasClass("icon-check-empty"))
      {
        $('#showterminalicon').removeClass("icon-check-empty");
        $('#showterminalicon').addClass("icon-check");
      }
    }

    function isConsoleVisible()
    {
      return ($('#showterminalicon').hasClass("icon-check")) ? true : false;
    }
      
    function uncheckSourceSelector()
    {
      if ($('#showcodeviewicon').hasClass("icon-check"))
      {
        $('#showcodeviewicon').removeClass("icon-check");
        $('#showcodeviewicon').addClass("icon-check-empty");
      }
    }

    function checkSourceSelector()
    {
      if ($('#showcodeviewicon').hasClass("icon-check-empty"))
      {
        $('#showcodeviewicon').removeClass("icon-check-empty");
        $('#showcodeviewicon').addClass("icon-check");
      }
    }

    function isSourceVisible()
    {
      return ($('#showcodeviewicon').hasClass("icon-check")) ? true : false;
    }

    function uncheckHtmlSelector()
    {
      if ($('#showhtmlicon').hasClass("icon-check"))
      {
        $('#showhtmlicon').removeClass("icon-check");
        $('#showhtmlicon').addClass("icon-check-empty");
      }
    }

    function checkHtmlSelector()
    {
      if ($('#showhtmlicon').hasClass("icon-check-empty"))
      {
        $('#showhtmlicon').removeClass("icon-check-empty");
        $('#showhtmlicon').addClass("icon-check");
      }
    }

    function isHtmlVisible()
    {
      return ($('#showhtmlicon').hasClass("icon-check")) ? true : false;
    }

    function uncheckDocSelector()
    {
      if ($('#showdocviewicon').hasClass("icon-check"))
      {
        $('#showdocviewicon').removeClass("icon-check");
        $('#showdocviewicon').addClass("icon-check-empty");
      }
    }

    function checkDocSelector()
    {
      if ($('#showdocviewicon').hasClass("icon-check-empty"))
      {
        $('#showdocviewicon').removeClass("icon-check-empty");
        $('#showdocviewicon').addClass("icon-check");
      }
    }

    function isDocVisible()
    {
      return ($('#showdocviewicon').hasClass("icon-check")) ? true : false;
    }

    function uncheckFileTreeSelector()
    {
      if ($('#showfiletreeicon').hasClass("icon-check"))
      {
        $('#showfiletreeicon').removeClass("icon-check");
        $('#showfiletreeicon').addClass("icon-check-empty");
      }
    }

    function checkFileTreeSelector()
    {
      if ($('#showfiletreeicon').hasClass("icon-check-empty"))
      {
        $('#showfiletreeicon').removeClass("icon-check-empty");
        $('#showfiletreeicon').addClass("icon-check");
      }
    }

    function isFileTreeVisible()
    {
      return ($('#showfiletreeicon').hasClass("icon-check")) ? true : false;
    }

    function viewOnlyConsole()
    {
      $('#codeframe').height(infobar_ht);
      $('#buildframe').height(build_ht + code_ht + html_ht - infobar_ht);
      $('#consolediv').height(console_ht + code_ht + html_ht - infobar_ht);
      $('#htmlframe').height(0);
      // if README is there, it must be full page - so shrink it
      if (isReadmeVisible())
      {
         $('#instructions').width(doc_panel_width);
         $('#instructionsdivider').show();
      }
      showHideFramesBasedOnHeight();
      hideSourceExtras();
      hideHtmlExtras();
    }

    function viewOnlySource()
    {
      $('#codeframe').height(build_ht + code_ht + html_ht);
      $('#consolediv').height(0);
      $('#buildframe').height(0);
      $('#htmlframe').height(0);
      $('#codeform0').height("100%");
      // if README is there, it must be full page - so shrink it
      if (isReadmeVisible())
      {
         $('#instructions').width(doc_panel_width);
         $('#instructionsdivider').show();
      }
      showHideFramesBasedOnHeight();
      showSourceExtras();
      hideHtmlExtras();
      editor.refresh();
    }

    function viewOnlyHtml()
    {
      $('#codeframe').height(infobar_ht);
      $('#consolediv').height(0);
      $('#buildframe').height(0);
      $('#htmlframe').height(build_ht + code_ht + html_ht - infobar_ht);
      // if README is there, it must be full page - so shrink it
      if (isReadmeVisible())
      {
         $('#instructions').width(doc_panel_width);
         $('#instructionsdivider').show();
      }
      showHideFramesBasedOnHeight();
      hideSourceExtras();
      showHtmlExtras();
    }

    function viewSourceConsole(param_code_ht, param_build_ht, param_console_ht)
    {
      $('#codeframe').height(param_code_ht);
      $('#buildframe').height(param_build_ht);
      $('#consolediv').height(param_console_ht);
      $('#codeform0').height("100%");
      $('#htmlframe').height(0);
      showHideFramesBasedOnHeight();
      showSourceExtras();
      hideHtmlExtras();
      showSourceConsoleExtras();
      editor.refresh();
    }

    function viewSourceHtml(param_code_ht, param_html_ht)
    {
      $('#codeframe').height(param_code_ht);
      $('#consolediv').height(0);
      $('#buildframe').height(0);
      $('#htmlframe').height(param_html_ht);
      $('#codeform0').height("100%");
      showHideFramesBasedOnHeight();
      showSourceExtras();
      showHtmlExtras();
      editor.refresh();
    }

    function viewConsoleHtml(param_build_ht, param_console_ht, param_html_ht)
    {
      $('#codeframe').height(0);
      $('#buildframe').height(param_build_ht);
      $('#consolediv').height(param_console_ht);
      $('#htmlframe').height(param_html_ht);
      showHideFramesBasedOnHeight();
      hideSourceExtras();
      showHtmlExtras();
    }

    function viewSourceConsoleHtml(param_code_ht, param_build_ht, param_console_ht, param_html_ht)
    {
      $('#codeframe').height(param_code_ht);
      $('#consolediv').height(param_console_ht);
      $('#buildframe').height(param_build_ht);
      $('#htmlframe').height(param_html_ht);
      $('#codeform0').height("100%");
      showHideFramesBasedOnHeight();
      showSourceExtras();
      showHtmlExtras();
      editor.refresh();
    }

    // 1 -> 2 / 3 -> 2
    // ----------------------
    // if new_cfg == init_cfg: 
    //     just use initial settings
    // if new_count == initial_count: 
    //     for the one frame that was in the init_cfg, use the same height
    //     for the other one, use the remainder
    // else:
    //     use 50/50 split
    
    // 2 -> 3
    // if new_cfg == init_cfg: 
    //     just use initial settings
    // else:
    //     33/33/33 split

    function drawOneFrameElement()
    {
      if (isSourceVisible()) 
      {
        viewOnlySource();
      } 
      else if (isHtmlVisible())
      {
        viewOnlyHtml();
      }
      else 
      {
        viewOnlyConsole();
      }
      hideSourceConsoleExtras();
    }

    function drawTwoFrameElements()
    {
      if (isSourceVisible())
      {
        param_code_ht = intial_total_frame_ht * 0.5;
      }
      if (isHtmlVisible())
      {
        param_html_ht = intial_total_frame_ht * 0.5;
      }
      if (isConsoleVisible())
      {
        param_build_ht = intial_total_frame_ht * 0.5;
        param_console_ht = param_build_ht - 20;
      }

      if (isSourceVisible() && isConsoleVisible())
      {
        viewSourceConsole(param_code_ht, param_build_ht, param_console_ht);
      }
      else if (isSourceVisible() && isHtmlVisible())
      {
        viewSourceHtml(param_code_ht, param_html_ht);
      }
      else
      {
        viewConsoleHtml(param_build_ht, param_console_ht, param_html_ht);
      }
    }

    function drawThreeFrameElements()
    {
      param_code_ht = intial_total_frame_ht * 0.333;
      param_html_ht = intial_total_frame_ht * 0.333;
      param_build_ht = intial_total_frame_ht * 0.333;
      param_console_ht = param_build_ht - 20;
      hideSourceConsoleExtras();
      viewSourceConsoleHtml(param_code_ht, param_build_ht, param_console_ht, param_html_ht);
    }

    function drawFrameElements()
    {
      count = (isSourceVisible() ? 1 : 0) + (isConsoleVisible() ? 1 : 0) + (isHtmlVisible() ? 1 : 0);
      switch (count)
      {
        case 1: drawOneFrameElement();    break;
        case 2: drawTwoFrameElements();   break;
        case 3: drawThreeFrameElements(); break;
      }
      viewSaveData();
    }

    function needOneSelectionMsg()
    {
      str = "At least one frame element must be selected";
      bootbox.dialog(str, 
           [{
             "label" : "Ok",
             "class" : "btn vocbtn-ac vocbtn-action"
           }]
      );
    }

    $('#showhtml').on('click', function()
    {
      if (isHtmlVisible())
      {
        count = (isSourceVisible() ? 1 : 0) + (isConsoleVisible() ? 1 : 0);
        if (count == 0) 
        {
          handleZeroFrameElements();
          return;
        }
        uncheckHtmlSelector();
        drawFrameElements();
      } 
      else
      {
        checkHtmlSelector();
        drawFrameElements();
      }
    });

    var preExpandedReadmeCfg = null;

    function viewPreExpandedReadmeFrame()
    {
      if (preExpandedReadmeCfg == "Console")
      {
        checkConsoleSelector();
      }
      else if (preExpandedReadmeCfg == "Html")
      {
        checkHtmlSelector();
      }
      else
      {
        checkSourceSelector(); 
      }
      drawFrameElements();
    }       

    function handleZeroFrameElements()
    {
      // if it's the README that wants to go full-size, let it
      // but save the current setting first
      if (isReadmeVisible())
      {
        if (isSourceVisible())
        {
          preExpandedReadmeCfg = "Source";
          uncheckSourceSelector();
        }
        else if (isHtmlVisible())
        {
          preExpandedReadmeCfg = "Html";
          uncheckHtmlSelector();
        }
        else 
        {
          preExpandedReadmeCfg = "Console"; 
          uncheckConsoleSelector();
        }
        viewOnlyREADME();
      }
      else
      {
        // don't allow zero
        needOneSelectionMsg();
      }
      return;
    }

    function viewOnlyREADME()
    {
      $('#codeframe').height(0);
      $('#buildframe').height(0);
      $('#consolediv').height(0);
      $('#htmlframe').height(0);
      hideSourceExtras();
      hideHtmlExtras();
      $('#instructions').width("100%");
      $('#instructionsdivider').hide();
    }


    $('#showterminal').on('click', function()
    {
      if (isConsoleVisible())
      {
        count = (isSourceVisible() ? 1 : 0) + (isHtmlVisible() ? 1 : 0);
        if (count == 0) 
        {
          handleZeroFrameElements();
          return;
        }
        uncheckConsoleSelector();
        drawFrameElements();
      } 
      else
      {
        checkConsoleSelector();
        drawFrameElements();
      }
    });

    $('#showcodeview').on('click', function()
    {
      if (isSourceVisible())
      {
        count = (isConsoleVisible() ? 1 : 0) + (isHtmlVisible() ? 1 : 0);
        if (count == 0) 
        {
          handleZeroFrameElements();
          return;
        }
        uncheckSourceSelector();
        drawFrameElements();
      } 
      else
      {
        checkSourceSelector();
        drawFrameElements();
      }
    });
    	    

    if (left_panel_instructions)
    {
      if (doc_panel_width == 0) {
        doc_panel_width = $('#instructions').width();
      }
            var input = document.getElementById("readmeframehide");
      if (input !== null) {
        $('#readmeframehide').on('click', function() {
          $('#showfiletree').click();
        });

        input.addEventListener("keyup", function(event) {
        if (event.keyCode === 13) {
         event.preventDefault();
         document.getElementById("readmeframehide").click();
        }
      });
    }
          }
    // save the initial sizes so easier to resize later on
    viewSaveData();


    var resizeEnd;
    // var resizeStart = false;

    // function resizeStartFunc()
    // {
    //   console.log("VOC: START resize");
    // }

    function resizeEndFunc() 
    {
      // console.log("VOC: END Resize");
      
      new_frame_idebox_ht = $('#idebox').height();
      new_frame_idebox_ht = new_frame_idebox_ht - $('#ideButtonDiv').height();

      idebox_multiplier = new_frame_idebox_ht / frame_idebox_ht;
      // console.log("VOC: mult: " + idebox_multiplier);
      
      if (code_ht) {
        $('#codeframe').height(code_ht * idebox_multiplier);
        // console.log("VOC: code: " + code_ht + " -> " + code_ht * idebox_multiplier);
      }
      if (html_ht) {
        $('#htmlframe').height(html_ht * idebox_multiplier);
        // console.log("VOC: html: " + html_ht + " -> " + html_ht * idebox_multiplier);
      }
      if (build_ht) {
        setConsoleParams();
        // console.log("VOC: build: " + build_ht + " -> " + build_ht * idebox_multiplier);
      }

      viewSaveData();
      // resizeStart = false;
    }

    window.addEventListener('resize', function(event) {
      // if (resizeStart == false) {
      //   resizeStart = true;
      //   resizeStartFunc();
      // }
      clearTimeout(resizeEnd);
      resizeEnd = setTimeout(resizeEndFunc, 100);
    });
           
    function resizeCodeFrame()
    {
      ht = frame_idebox_ht - $('#htmlframe').height() - $('#ideButtonDiv').height();
      $('#codeframe').height(ht);
    }

  $('.vocdivider_h1').draggable({
    axis: 'y', 
    containment: 'parent',
    helper: 'clone', 
    iframeFix: true,
    // refreshPositions: true,
    scroll: false,
    drag: function (event, ui) {
      var parent_height = $(this).parent().height(); 
      var prev_height = ui.position.top;
      $(this).prev().height(prev_height);
      // console.log("VOC: 1: Draggin'... " + ui.position.top);
      resizeCodeFrame();
    }
  });

  $('.vocdivider_h2').draggable({
    axis: 'y', 
    containment: 'parent',
    helper: 'clone', 
    iframeFix: true,
    // refreshPositions: true,
    scroll: false,
    drag: function (event, ui) {
      var prev_height = ui.position.top;
      if (prev_height < 50) {
        return;
      }
      var parent_height = $(this).parent().height(); 
      var height_of_console = parent_height - prev_height - $('#ideButtonDiv').height();
      if (height_of_console < 75) {
        return;
      }
      $(this).prev().height(prev_height);
      // console.log("VOC: 2: Draggin'... " + ui.position.top);
      setConsoleParams();
    }
  });


    // $(document).ready(function() {     
    $(window).load(function() {          
      // if student and ide == standard, see if we want to change the layout
            showHideFramesBasedOnHeight();
    });

    $('#fileuploadbtn').on('click', function() {
                  $("#filestatuslabel").html("");
                                    markUpdateChanged($("#input_filename").val());
                  $('#fileuploadfield').val("");
        var args = '&type=Upload&asnid=121095&stepid=121096&mode=s&version=0&vmd=100&filepath=./' + $("#input_filename").val();
        if(fileUploadListener) document.getElementById('fileuploadfield').removeEventListener('change', fileUploadListener, false);
        fileUploadListener = vcUploadFiles('modal-upload-wait', 'uploadWaitMsgBox', null,'fileuploadfield', 10, args, null);
	$("#fileuploadfield").click();
    });
    var wasDelOn = false;
    var fileoptype = '';
    $('#filecancelbtn').on('click', function() {
                        var sel_type = $('#input_filetype').val();
                        var seltxt = $("#span_selectedfile").text();
                        fileoptype = '';
			$("#fileform" ).hide();
                        if(copyPasteClipboard && sel_type=='folder'){
			  $('#newbtn').show();
			  $('#filepastebtn').show();
                        }
			$('#fileuploadbtn').show();
                        if(seltxt.search(/^(ASNLIB|LIB|resource\/lib|resource\/asnlib)\/publicdata\//)<0){
                          showCopyFileBtn();
                        }
			if (wasDelOn) {
			    $('#filedelbtn').show();
			    $('#filerenamebtn').show();
			}
			$("#filestatuslabel").html("");
			$('#well_selectedfile').show();
                        $("#input_filename").val(seltxt);
    });
    $('#filenewbtn').on('click', function() {
                        fileoptype = 'file';
                        $("#filestatuslabel").html("");
			if ($('#filedelbtn').is(":visible")) {
				wasDelOn = true;
			} else {
				wasDelOn = false;
			}
	                $('#filepastebtn').hide();	
			$('#fileuploadbtn').hide();
			hideCopyFileBtn();
			$('#filedelbtn').hide();
			$('#filerenamebtn').hide();
			$("#fileform" ).show();
			$('#well_selectedfile').hide();
			$('#input_filename').focus();
    });
    
    $('#foldernewbtn').on('click', function() {
                        fileoptype = 'folder';
                        $("#filestatuslabel").html("");
			if ($('#filedelbtn').is(":visible")) {
				wasDelOn = true;
			} else {
				wasDelOn = false;
			}
	                $('#filepastebtn').hide();	
			hideCopyFileBtn();
			$('#fileuploadbtn').hide();
			$('#filedelbtn').hide();
			$('#filerenamebtn').hide();			
			$("#fileform" ).show();
			$('#well_selectedfile').hide();
			$('#input_filename').focus();
    });

    function showCanvas()
    {
      
    }
    function showEditor()
    {
          }


    $('#filerenamebtn').on('click', function() {
                        fileoptype = 'rename';
                        $("#filestatuslabel").html("");
			if ($('#filedelbtn').is(":visible")) {
				wasDelOn = true;
			} else {
				wasDelOn = false;
			}
                        hideCopyFileBtn();
			$('#newbtn').hide();			
	                $('#filepastebtn').hide();	
			$('#fileuploadbtn').hide();
			$('#filedelbtn').hide();
			$("#fileform" ).show();
			$('#well_selectedfile').hide();
    });

    $('#canvasbtn').on('click', function() {
      // var url = "../web/460852/121096/" + "work/" + "voc_canvas.html";
      // $('#div_canvas').html("<iframe src=\""+ url +"\" width=\"100%\" height=\"100%\"></iframe>");
      showCanvas();
    });

    $('#fileviewbtn').on('click', function() {
        		if (isSaveNeeded()) {					
        				voc_save(true, "Saving");
        		} 
      var val = $('#editor_current_file').text();
                 var url = "../web/460852/121096.0/"+val;
            $('#browser-viewer-title').text(val);
      $('#browser-viewer-iframe').attr("src", url);      
      $('#browser-viewer-link').attr("href", url);      
      $('#browser-viewer-modal').modal('show');
    });

    var lastHtmlFileShown = null;
    function showHtmlFile(val) {
              var url = "../web/460852/121096.0/" + val;
           lastHtmlFileShown = val;
     // make sure that the html frame is there
     if (! isHtmlVisible())
     {
       checkHtmlSelector();
       drawFrameElements();
     }
     $('#div_html_frame_inner').html("<iframe src=\""+ url +"\" width=\"100%\" height=\"100%\" style=\"border:0px\" title=\"HTML\"></iframe>");
    }

    function showHtmlFileDelayed(val) {
      if (isSaveNeeded()) {					
        voc_save(true, "Saving");
      }
      if (save_in_progress) {
        setTimeout(showHtmlFileDelayed, 300, val);
      } else {
        showHtmlFile(val);
      }
    }                   
        
    $('#htmlreloadbtn').on('click', function() {
      if (lastHtmlFileShown == null) {
        return;
      }
      showHtmlFileDelayed(lastHtmlFileShown);
    });
	
		$('#tree1').ace_tree({
			dataSource: treeDataSource ,
			multiSelect:false,
			loadingHTML:'<div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div>',
			'open-icon' : 'icon-minus',
			'close-icon' : 'icon-plus',
			'selectable' : true,
			'selected-icon' : 'icon-caret-right',
			'unselected-icon' : 'icon-caret-right',
			cacheItems: true
		});
		
 		// one accesibilty handler per panel
		$('#filelisting').off('keydown');
        $('#filelisting').attach_accesible_handler();
        $('#idenav').off('keydown');
        $('#idenav').attach_accesible_handler();
        $('#breadcrumb').off('keydown');
        $('#breadcrumb').attach_accesible_handler();


		$('#tree1').on('loaded', function (evt, data) {
	//		var classList = $('.tree-btn');
	//		$.each(classList, function(index, item) {
	//    		$(item).make_accesible();
	//    	});
		});


		$('#tree1').on('opened', function (evt, data) {
		});

		$('#tree1').on('closed', function (evt, data) {
		});

		$('#tree1').on('selectedfolder', function (evt, data) {
			var relpath = data.info[0].path.substring(2);
			$('#input_filename').val(relpath + "/");
			$('#span_selectedfile').html(relpath + "/");
			$('#well_selectedfile').show();

			$('#input_filetype').val("folder");

			hideAllFileBtn();
                        if( relpath == 'resource' ){
                          $('#downloadbtn').hide();
                          return false;
                        }

                        
                      			if (data.info[0].ec==1 || relpath.search(/^LatestSubmission/)<0){
                                                       if( relpath.search(/^resource/)<0 ){
			      showCreateFileBtn();
		  	      showPasteFileBtn();
                            } else {
                              showCopyFileBtn(); 
                            }
                                                  } 
                                              if(relpath.search(/^(ASNLIB|LIB|resource\/lib|resource\/asnlib)\/publicdata($|\/)/)<0){
			  showCopyFileBtn();
                        }
			if (data.info[0].ed == 1) {
                                  if( relpath.search(/^(ASNLIB|LIB)\/publicdata$/)<0 &&
                                      relpath.search(/^resource\/(lib|asnlib)\/publicdata$/)<0 &&
                                      relpath.search(/^resource\/(lib|asnlib|scripts|startercode)$/)<0 ){
			  	    showDelFileBtn();
                                  }
                        }
		});

		function filetreeFileSelect(rec) {		
			var relpath = rec.path.substring(2);
			showEditor();
			$('#input_filename').val(relpath);
			$('#span_selectedfile').html(relpath);
			$('#well_selectedfile').show();
			$('#input_filetype').val("file");


      
      if (rec.ee == 1) {
          editor.setOption("readOnly", false);
			} else {
          editor.setOption("readOnly", true);
			}

						
			var ext_index = rec.name.lastIndexOf('.');
			if (ext_index == -1) {
				ext = null;
			} else {
            	ext = rec.name.substring(ext_index + 1);
            }
			if (isVidFile(ext)) {
                 
                    var url = "https://labs.vocareum.com/web/460852/121096/" + relpath;
                    var str = '<video width="600px" controls> ' +
                              '<source id="video-viewer-modal-video" src="' + url + '" type="video/mp4">' +
                              'Your browser does not support HTML5 video. </video>';
                    $('#video-viewer-modal-div').html(str);                
                    $('#video-viewer-modal').modal('show');
                    return;
			} else if (isImgFile(ext)) {
                       							
                $.get('../util/vcprojapi.php', {t: 'filefetch', mode:'s', asnid: 121095,  stepid:121096, data: rec.path,version:0, vm:'34.209.4.84', labtype:0}, function(data) {

                    $('#image-viewer-modal-image').prop('src', data);
                    $('#image-viewer-modal').modal('show');
				});
                return;
			} else if (isOtherFile(ext)) {

                  							
          $.get('../util/vcprojapi.php', {t: 'filefetch', mode:'s', asnid: 121095,  stepid:121096, data: rec.path,version:0, vm:'34.209.4.84', labtype:0}, function(data) {
					$('#other-viewer-modal-area').prop('data', data);
					// set application type here
					$('#other-viewer-modal').modal('show');
				});
                return;
			} else {
					// all other
			}
			
                    if (isBrowserViewableFile(ext) && true) {
                      $('#htmlreloadbtn').show();
                      showHtmlFile(relpath);
                    }
                    else {
			if (isBrowserViewableFile(ext)) {
			    $('#fileviewbtn').show();
			} else {
			    $('#fileviewbtn').hide();
			}
                    }
			
			var codeFileChanged = true;			
			
			if (editor.doc.isClean(editor_content_change)) codeFileChanged = false;
			if (vocIsFileReadOnly(viewer_last_fpath)) codeFileChanged = false;

			if (codeFileChanged) {
					voc_save(true, "Saving, please wait");
			} 
      var codeComments = ( (typeof (rec.comments) !== 'undefined') ? rec.comments : '' );
			voc_get_viewer_code(rec.path, rec.name, 0, codeComments);


					
		
		}

		function S3FileSelect(rec) {
			var fpath = rec.fpath;
			var fname = rec.name;
			showEditor();
			editor.setOption("readOnly", true);
			$('#input_filename').val(fpath);
			$('#span_selectedfile').html(fpath);
			$('#well_selectedfile').show();
			$('#input_filetype').val("file");
			
			
			var ext_index = fname.lastIndexOf('.');
			if (ext_index == -1) {
				ext = null;
			} else {
            	ext = fname.substring(ext_index + 1);
            }
			if (isVidFile(ext)) {
                 
                var url = "https://labs.vocareum.com/web/460852/121096/" + fpath;
                var str = '<video width="600px" controls> ' +
                          '<source id="video-viewer-modal-video" src="' + url + '" type="video/mp4">' +
                          'Your browser does not support HTML5 video. </video>';
                $('#video-viewer-modal-div').html(str);                
                $('#video-viewer-modal').modal('show');
                return;
			} else if (isImgFile(ext)) {
                       							
                $.get('../util/vcprojapi.php', {t: 'filefetch', mode:'s', userid: 460852, asnid: 121095,  stepid:121096, data: fpath,version:0, vm:'34.209.4.84', labtype:0}, function(data) {
                    $('#image-viewer-modal-image').prop('src', data);
                    $('#image-viewer-modal').modal('show');
				});
                return;
			} else if (isOtherFile(ext)) {
    			    			$.get('../util/vcprojapi.php', {t: 'filefetch', mode:'s', userid: 460852, asnid: 121095,  stepid:121096, data: fpath,version:0, vm:'34.209.4.84', labtype:0}, function(data) {
                    $('#other-viewer-modal-area').prop('data', data);
                    // set application type here
                    $('#other-viewer-modal').modal('show');
                });
                return;
			} else {
				// all other
			}
			
            if (isBrowserViewableFile(ext) && true) {
                $('#htmlreloadbtn').show();
                showHtmlFile(fpath);
            } else {
    			if (isBrowserViewableFile(ext)) {
    			    $('#fileviewbtn').show();
    			} else {
    			    $('#fileviewbtn').hide();
    			}
            }
			
			var codeFileChanged = true;			
			
			if (editor.doc.isClean(editor_content_change)) codeFileChanged = false;
			if (vocIsFileReadOnly(viewer_last_fpath)) codeFileChanged = false;

			if (codeFileChanged) {
				voc_save(true, "Saving, please wait");
			}
			var codeComments = ( (typeof (rec.comments) !== 'undefined') ? rec.comments : '' );
			voc_get_s3_code(fpath, fname, 0, codeComments);
		}
		
		$('#tree1').on('selected', function (evt, data) {
		  filetreeFileSelect(data.info[0]);
		});

		$('.tree-folder-header').each(function(i, obj) {
					$val = $(this).data();
					if ($val['unfold'] == 1) {
						$(this).trigger('click');
					}
		});

		
		// modes
		$( "#codebtn" ).click(function() {
  		});
 		$( "#actionsdropdown" ).click(function() {
  		}); 		
  		
  				

		// MODE 1: E and C     E8 C4  XP
		// MODE 2: F and E	   F4 E12 
		// MODE 3: E		   E12    XP
		
		// B1: M1 > M3
		// B2: M3 > M1
		
		// G1: M1 > M2
		//	   M3 > M2
		// G2: BACK TO M1 OR M3		
		function changeEditorMode(modeFrom, modeTo) {
			switch (modeFrom) {
				case 1:
				break;
				case 2:
				break;
				case 3:
				break;
				default:
				break;
			}
			switch (modeTo) {
				case 1:
					$("#filelisting").removeClass('hide');
					$("#icon-folder").removeClass('icon-chevron-down');		
					$("#icon-folder").addClass('icon-remove');			
				
				break;
				case 2:
					$("#filelisting").addClass('hide');
					$("#icon-folder").removeClass('icon-remove');			
					$("#icon-folder").addClass('icon-chevron-down');		
				break;
				default:
				break;
			}		
			current_mode = modeTo;
		}	
		
        $( "#savebutton").click(function() {
				voc_save(true, "Saving");
        });


        function showDefaultEditorFile() {
            var default_file_rec = {
                    name: "",
                    path: "./work/" + "",
                    ee: 1
            }
            filetreeFileSelect(default_file_rec);              
        }

       
	
		$('body').on('click', '.bldFileOpen', function() {
			
			var $this = $(this);
			var filepath = $this.data('filedir')+"/"+$this.data('filename');

            		filepath = "./work/" + filepath; // builds can happen on work

			var line_num = 0;
			if ($this.data('line') > 0) {
				line_num = $this.data('line');
			}
			voc_get_viewer_code(filepath, $this.data('filename'), line_num, '');
			return false;
		})
		
            
  $('#input_filename').keydown(function(e) {
      if(e.keyCode == 13) {
          $('#filecreatebtn').trigger("click");
      }
  });
  

  
 

$('#video-viewer-modal').on('hidden.bs.modal', function (e) {
    $('#video-viewer-modal-div').html("");  
})

			$( document ).ready(function() {

		$.extend($.gritter.options, {
			position: 'top-left'
		});
	                   
                    			
			});
	
			
  
  
  
  
                     
                          //
                          // If we have an embedded terminal, we want to execute the BUILD and RUN
                          // commands om the terminal (not batch) - among other things, it allows
                          // the run to be interactive
                          // Of course, BUILD does not need to be handled this way, but it's better
                          // to be consistent
                          //
                          function vcGetCmdStr(data)
                          {
                            var st = data.search(/@vocbegin@/);
                            var ed = data.search(/@vocend@/);
                            if(st>=0 && ed>=0 ) return data.substring(st+10, ed);
                            else                return '';
                          }
                          function doTerminalBuildRun($type)
                          {
                                                        return false;
                          }


    $('#shellinput').keyup(function(e) {
        if(e.keyCode == 13) {
            $('#shellbutton').trigger("click");
        }
    });


    $(".editbutton").click(function() {
      editVers();
    });
    $(".viewbutton").click(function() {
      var type = $(this).data("command");
      setView(type);
    });
    $(".togglebutton").click(function() {
      var type = $(this).data("command");
      setView(type);
    });
    $(".appbutton").click(function() {
      var type = $(this).data("command");
      launchApp(type);
    });
    $(".appstopbutton").click(function() {
      stopApp();
    });
    $(".newtabviewbutton").click(function() {
      var type = $(this).data("command");
      setNewTabView(type);
    });
 
    $(".jupyterbutton").click(function() {
      var type = $(this).data("command");
      if (type == "launch")
      {
        setView(2);
      }
      else if (type == "release")
      {
        processNotebooks(type);
      }
      else if (type == "clear_output")
      {
        processNotebooks(type);
      }
    });

    $( ".commandbutton" ).click(function() {		
	var $type = $(this).data("command");	
        processThisCommand($type);
    });
    function processThisCommand($type){
	var filepath = viewer_last_fpath;				
	if (!viewer_last_fpath) filepath = viewer_first_fpath;
						    
				

        if (doTerminalBuildRun($type))
        {
                return;
        }
        
	if (isSaveNeeded()) {					
		voc_save(true, "Saving");
	}
	executeThisCommand($type, filepath, true);
    }
    function executeThisCommand($type, filepath, isfirst)
    {
        if ( ($type=='RUN' || $type=='BUILD') && isfirst) { // activity icon only for RUN as of now
        	updateRunIcon($type, true);
        }

        if( save_in_progress ) {
          // delay execution
          window.setTimeout(function(){ executeThisCommand($type, filepath, false); } , 300);
          return;
        }
	var asyncCommand = false;
	var asyncPollUrl = null;
        var scheduleMode = false;
	if ($type=="Submission" || $type=="Grading" || $type=="RUN" || $type=='BUILD') {
		asyncCommand = true;
	}
        if ($type == "Grading") {
          scheduleMode = true;
        }
				
        var unencoded_filepath = filepath;
	filepath = encodeURIComponent(filepath);
				
        if (!asyncCommand) {
		$('#buildtextarea').html("<i class=\"icon-spin icon-spinner\"></i>&nbsp; Waiting for output ..");
	}
        // if the Asn Grading Rule is MAX, then we need to make sure we pass the correct rule (ontime/late) here
        // otherwise setting-grades-via-submission will not work
        
        var stepstr = "&stepid=121096" + "&auto_calc_grading=1";

        var filepathstr = "";
        if (($type == 'BUILD') || ($type == 'RUN')) {
          filepathstr = getFilePathStr(unencoded_filepath, true);
        }

        
        if ($type == 'SHELL') {
            var input = encodeURIComponent($('#shellinput').val());
            var url =  "../domains/common_submit.php?loc=3&id=121095&version=0&type="+$type+stepstr+"&input="+input+"&dryrun=1&useworkarea=1"+filepathstr;
        } else {
                
                              var url = "../domains/common_submit.php?loc=5&id=4336039&version=0"+stepstr+"&type="+$type+filepathstr;
              	
			
	      if (asyncCommand) {
	        asyncPollUrl = url + "&getstatus=1";
        	url = url + "&async=1";
              }
	      if (scheduleMode) {
        	url = url + "&scheduleMode=1";
              }
        } // else SHELL
                var msg = "Executing '" + $type + "' script...";
                if (!asyncCommand) { 
                                    var htmlMsg = "<pre>" + msg + "</pre>";
                    $('#buildtextarea').html(htmlMsg);
                                }
                $.post(url,{code0: ""},function(ret_val)
                {
                  if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                    window.location.replace("https://labs.vocareum.com/main/logout.php");
                  }

                                      if ($type == 'Grading') {
                                            return;
                    }
                                    // show_voc_gritter(false, $type+" done", false);

                  data = ret_val;
                  if (!asyncCommand) {
                    if ($type=='RUN' || $type=='BUILD' ) { // activity icon only for RUN as of now
                      updateRunIcon($type, false);
                    }
                                      consolePrint(htmlMsg + "\n" + data);
                                    }

                  indicate_build_done();
                  build_in_progress = false;
                  
                  
                                        wasUnsubmitted = false;
                      if ($('#workunsubmitted').is(":visible")) {
                          wasUnsubmitted = true;
                      } 
                                                          refreshFileTree(false, ($type != "Submission"));
                                             	  refreshSubTree();
                  	                        if (false && wasUnsubmitted) {
                          window.setTimeout(function(){ $('#workunsubmitted').show(); } , 500);
                      }
                                    
                  if (asyncCommand) {
                       
                      
                                                                                          consolePrint('Waiting for '+$type+' report');
                                                    
                                                  
                                            reportsToOpen = true;
                      var token = false;
                      var chksubmit = false;
                      var chkgrade = false;
                                                 if($type=='RUN' || $type=='BUILD' ){
                             try {
                               data = jQuery.parseJSON(ret_val);
                               if( data.hasOwnProperty('runcmd') && data.runcmd==1 ){
                                 token = data.token;
                                 if(data.url.indexOf('?')>=0) 
                                   asyncPollUrl = data.url + '&getstatus=1&token=' + token;
                                 else
                                   asyncPollUrl = data.url + '?getstatus=1&token=' + token;
                                                                } else if ( data.hasOwnProperty('result') && data.result=='fail' ){
                                 var mymsg = $type + ' failed:' + data.messages;
                                 show_voc_gritter(false, mymsg, false);
                                 consolePrint(mymsg);
                                 if($type=='RUN' || $type=='BUILD'){
                                   updateRunIcon($type, false);
                                 }
                                 return false;
                               }
                             } catch (e) {
                               // ignore it.
                             }
                           }
                                            asyncCheckReportPeriodic($type, asyncPollUrl, chksubmit, chkgrade, maxPollTv, Math.floor(Date.now() / 1000));
                  }                 
                  
                });
						
		}

        var $gradesModal = $('#grades-modal'),
            $gradesIframe = $gradesModal.find('iframe'),
            $gradesSpinner = $gradesModal.find('#spinner');
				
        $gradesModal
            .on('show', function() {
                $gradesSpinner.removeClass('hidden-1');
                var url = 'main.php?m=grades_review&modalMode=1&asnId=121095&stepid=121096&userid=460852';
                                $gradesIframe.prop('src', url);
            });

        $gradesIframe.on('load', function() {
            $gradesSpinner.addClass('hidden-1');
        });

        function autoPeerReviewStart() {
          var data = "";
	  var urlval = '../util/vcprojapi.php?t=auto_peer_review_end_exam&type=peer_review&asnid=' + 121095 + '&userid=' + 460852;
          $.ajax({
                 type: "POST",
                 url: urlval,
                 data: data
          })
          .done(function(ret_val) {
                if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                  console.log(ret_val + " Invalid session ");
                  // window.location.replace("https://labs.vocareum.com/main/logout.php");					
                }
                resp = jQuery.parseJSON(ret_val);
                if (resp.status !== 'success') {
                  show_voc_gritter(true, 'Peer review participation failed. <br>' + resp.message, true);
                } else {
                  $("#lisubmit").addClass('hidden');
                  show_peer_review_confirm_dialog = false;
                  $gradesModal.modal('show');
                }
            });
        }

        $('#gradesIdeBtn')
            .on('click', function() {
          var qstr = "Please make sure that you have submitted your work. You will not be allowed to make any more submissions once you start your participation in the peer review process. Are you sure you want to continue?";
          if (auto_peer_review_mode && show_peer_review_confirm_dialog)
          {
           bootbox.dialog(qstr,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                              autoPeerReviewStart();
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
                   );
          } 
          else
          {
            show_grades(advance_features, 0);
          }
        });

        function endExam() {
          var data = "";
	  var urlval = '../util/vcprojapi.php?t=auto_peer_review_end_exam&type=end_exam&asnid=' + 121095 + '&userid=' + 460852;
          $.ajax({
                 type: "POST",
                 url: urlval,
                 data: data
          })
          .done(function(ret_val) {
                if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                  console.log(ret_val + " Invalid session ");
                  // window.location.replace("https://labs.vocareum.com/main/logout.php");					
                }
                resp = jQuery.parseJSON(ret_val);
                if (resp.status !== 'success') {
                  show_voc_gritter(true, 'End exam failed. <br>' + resp.message, true);
                } else {
                  $("#lisubmit").addClass('hidden');
                  $("#end-exam-group").addClass('hidden');
                  $("#examTimer").addClass('hidden');
                  show_voc_gritter(true, resp.message, true);
                }
            });
        }

        $('#endExamIdeBtn')
            .on('click', function() {
          var qstr = "Please make sure that you have submitted your work. You will not be allowed to make any more submissions once you end the exam. Are you sure you want to continue?";
          bootbox.dialog(qstr,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                              endExam();
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
          );
        });
       var lastUpdateTime = 'Monday Oct 14 2019 19:23:04 GMT-0700 (PDT)';
       function syncAsnNow(tonew)
       {
           var d = new Date();
           lastUpdateTime = d.toString();
           $('#updatebtntext').html('<i class="icon-spin icon-spinner"></i>Update');
           var jqxhr = $.ajax('../util/vcput.php?a=syncAsn&stepid=121096'+(tonew? '&isnew=1' : ''))
                 .done(function(data, textStatus, jqXHR) {
                   var ap = data.indexOf('VOCERR::');
                   var bp = data.indexOf('::VOCERR');
                   if(ap>=0 && bp>=0 && bp>ap ){
                     show_voc_gritter(true, 'Update failed:' + data.substring(ap+8, bp), true);
                     $('#updatebtntext').html('Update*');
                   } else {
                     $('#updatebtntext').html('Update');
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   $('#updatebtntext').html('Update');
                 });
       }
       $('#awsbtn').click(function(){
         launchAws(-1);
       });
       $('#c9btn').click(function(){
         launchC9();
       });
       $('#appsbtn').click(function(){
    	   launchAppStream();
         });
       function launchStudentView()
       {
    	   var newide = false;
    	   var appside = false;
    	   var awside = false;
    	   var stulabs = false;
    	   var appsallowed = false;
    	   
         $.ajax({
           url: '../util/vcput.php?a=resetStudentView&stepid=121096&version=0',
           type: 'get',
           success: function(data) {
               if (appside || awside) {
            	   window.open( "main.php?m=vlabide&mode=s&asnid=121095&stepid=121096&ownerid=460852&permit=7&tide=1&version=0");
               }
               else if (stulabs || appsallowed) {
            	   window.open( "main.php?m=vlabide&mode=s&asnid=121095&stepid=121096&ownerid=460852&permit=7&tide=1&version=0");
               }
               else if (newide) {
            	   window.open( "main.php?m=vlabide&mode=s&asnid=121095&stepid=121096&ownerid=460852&permit=7&tide=1&version=0");
               }
               else {
                 window.location = "main.php?m=editor&mode=s&asnid=121095&stepid=121096&ownerid=460852&permit=7&tide=1&version=0";
               }
             //window.location = "main.php?m=editor&mode=s&asnid=121095&stepid=121096&ownerid=460852&permit=7&tide=1&version=0";
           }
         });
       }
       function launchClabide()
       {
         $.ajax({
           url: '../util/vcput.php?a=resetStudentView&stepid=121096&version=0',
           type: 'get',
           success: function(data) {
        	   window.open( "main.php?m=clabide&mode=s&asnid=121095&stepid=121096&ownerid=460852&permit=7&tide=1&version=0");
             //window.location = "main.php?m=clabide&mode=s&asnid=121095&stepid=121096&ownerid=460852&permit=7&tide=1&version=0";
           }
         });
       }
       var vcPartUpdated = 0;
       $('#studentviewbtn').click(function(){
         if (isSaveNeeded()) { voc_save(true, "Saving");}
           if (vcPartUpdated != 0) {
             launchStudentViewUpdateWarning();
             return;
           }
           // maybe some other action udated it - like publich in a different window
           var jqxhr = $.ajax({
             type: "POST",
             url: '../util/vcput.php?a=checkForAsnUpdate',
             data: { partid: 121096 }
           })
           .done(function(data, textStatus, jqXHR) {
             try {
               var result = JSON.parse(data);
               if (result['status'] == 'Error') {
                 console.log("Error getting update check results: " + result['message']);
                 launchStudentViewUpdateWarning();
               }
               else {
                 if (result['updated'] == 0) {
                   bootbox.dialog('You must click the “Update” button at least once for the Student View to be available<br><br>',
                                  [{
                                    "label" : "Ok",
                                    "class" : "btn vocbtn-ac vocbtn-action"
                                  }]
                   );
                 }
                 else {
                   vcPartUpdated = 1;
                   launchStudentViewUpdateWarning();
                 }
               }
             }
             catch(err) {
               console.log("Exception getting update check results: " + err);
               launchStudentViewUpdateWarning();
             }
           })
           .fail(function(data, textStatus, jqXHR) {
             console.log("Failed getting update check results: " + err);
             launchStudentViewUpdateWarning();
           });
       });
            
       function launchStudentViewUpdateWarning() {
                  bootbox.dialog('If you made any changes in the Teacher View, they need to be committed with the “Update” button before they can be available to the Student View<br><br>',
                 [{
                   "label" : "Continue",
                   "class" : "btn vocbtn-ac vocbtn-action",
                   "callback": function() {
                      launchStudentView();
                   }
                 },
                 {
                   "label" : "Cancel",
                   "class" : "btn vocbtn-ac vocbtn-status"
                 }]
           );
                }

       $('#clabidebtn').click(function(){
           if (isSaveNeeded()) { voc_save(true, "Saving");}
                      bootbox.dialog('If you made any changes in the Teacher View, they need to be committed with the “Update” button before they can be available to the Student View<br><br>',
                   [{
                     "label" : "Continue",
                     "class" : "btn vocbtn-ac vocbtn-action",
                     "callback": function() {
                    	 launchClabide();
                     }
                   },
                   {
                     "label" : "Cancel",
                     "class" : "btn vocbtn-ac vocbtn-status"
                   }]
             );
                  });
       $('#teammemberbtn').click(function(){
         if (isSaveNeeded()) { voc_save(true, "Saving");}
         window.location = "main.php?m=editor&nav=1&asnid=121095&stepid=121096";
       });
       $('#teacherviewbtn').click(function(){
         if (isSaveNeeded()) { voc_save(true, "Saving");}
         window.location = "main.php?m=editor&mode=t&asnid=121095&stepid=121096";
       });

       $('#merge_asn_btn').click(function() {
         var type = "merge";
         $('#' + type + '-output').hide();
         $('#' + type + '-ok').hide();
         $('#' + type + '-cancel').show();
         $('#' + type + '-action').show();
         $('#' + type + '-sel-course').trigger('change');
         $('#' + type + 'Assignment').css('height', 'auto');
         $('#' + type + 'Assignment').modal();
       });
       $("#merge-sel-course").change(function() {
         var type = "merge";
         $.post("../util/import_assignment.php",{courseid: $(this).val(), tgtbasnid: 121095, type: type, functionName: 'get_assignment_table'}, function(output) {
           output = JSON.parse(output);
           $('#' + type + '-table').html(output.tbldata);
         })
       });

       $('#merge-table').on('click', '.merge-modal-td-checkbox-all', function() {
         if (this.checked) {
           // check all checkboxes
           $(".merge-modal-td-checkbox-one").prop("checked", true);
           // $('#merge-table .merge-modal-td-checkbox-one').prop("checked", true);
         } else {
           // uncheck all
           $(".merge-modal-td-checkbox-one").prop("checked", false);
           // $('#merge-table .merge-modal-td-checkbox-one').prop("checked", false);
         }
       });

       var mergeAsnTimer;
       function showMergeAnsDots()
       {
         text = $('#merge-output').text();
         $('#merge-output').text(text + '.');
         mergeAsnTimer = setTimeout(showMergeAnsDots, 1000);
       }

       $('#merge-action').click(function() {
         // get the id's of all the selected assignments
         var basnids = [];
         $(".merge-modal-td-checkbox-one").each(function() {
           if (this.checked) {
             basnids.push(this.dataset.asnid);
           }
         });
         console.log(basnids);

         // if nothing selected, give an error and stay open
         if (basnids.length == 0) {
           bootbox.dialog("<br>No assignment selected. Please select at least one assignment to merge.",
                          [{
                            "label" : "Ok",
                            "class" : "btn vocbtn-ac vocbtn-action"
                          }]
           );
         } else {
           $('#merge-ok').show();
           $('#merge-cancel').hide();
           $('#merge-action').hide();
           $('#merge-output').show();
           $('#merge-output').text("Merging assignment(s)...");
           mergeAsnTimer = setTimeout(showMergeAnsDots, 1000);

           var src_course = $("#merge-sel-course").val();
           // do the actual merge
           var jqxhr = $.ajax({
             type: "POST",
             url: '../util/vcput.php?a=mergeAssignments',
             data: { tgt_part: 121096, tgt_base: 121095, tgt_version: 0, src_course: src_course, asnuserid: 460852, workarea: "/home/nowhere",basnids: basnids }
           })
           .done(function(data, textStatus, jqXHR) {
             console.log(data);
             clearTimeout(mergeAsnTimer);
             try {
               var result = JSON.parse(data);
               if (result['status'] == 'Error') {
                 $('#merge-output').text("Error merging assignments: " + result['output']);
               }
               else {
                    $('#merge-output').text(result['output']);
                    $('#merge-output').animate({
                      scrollTop:$('#merge-output')[0].scrollHeight - $("#merge-output").height()
                    }, 1000);
               }
             }
             catch (err) {
               $('#merge-output').text("Exception merging assignments: " + err);
             }
           })
           .fail(function(data, textStatus, jqXHR) {
             clearTimeout(mergeAsnTimer);
             $('#merge-output').text("Error merging assignments");
           });
                      
           //$('#mergeAssignment').modal("hide");
         } 
       });
                          
       $('#mergeAssignment').on('shown.bs.modal', function() {
         $('#merge-sel-course').chosen();
         $("#merge-sel-course").change();
       });

       function confirmCseVersion(started,verstr)
       {
         var actstr = '';
         var utime = lastUpdateTime;
         var qstr = 'Are you sure you want to update?<br>' + (utime==''? '' : 'Last updated: ' + utime + '<br>') + verstr;
         if(started){
           qstr += '<br><strong>NOTE:</strong> Some students have started the assignment. <br>';
         }
         bootbox.dialog(qstr,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                              syncAsnNow(false);
                           }
                         },
                         {
                           "label" : "Cancel",
                           "class" : "btn vocbtn-ac vocbtn-status"
                         }]
                   );
       }
       function cseVersDesc(ver)
       {
          //'{.vocconfig' + ver.versiondata.vocconfig +
          //', lib' + ver.versiondata.lib +
          //', asnlib' + ver.versiondata.asnlib +
          //', scripts' + ver.versiondata.scripts +
          //', startercode' + ver.versiondata.startercode + '}';
         if(ver.versiondata.asnlib.length==0) return ' initial';
         else                                 return ver.versiondata.asnlib.replace('.', ' ');
       }
       function updateCseVersion(data, v)
       {
         var ver = false;
         var verstr = '';
         if( v ){
           try {
             ver = JSON.parse(v);
             if( !ver ||  !ver.hasOwnProperty('versiondata') ){
               ver = false;
             }
           } catch(e){
             ver = false;
             alert('error:' + v);
           }
         }
         if( ver ){ // there is a prior version
           verstr = '';//'Current version:' + cseVersDesc(ver) + '<br>';
         }
         //check if there is student who started the assignment
                var apos = data.search('started::');
         var bpos = data.search('::started');
         if(apos>=0 && bpos>=0 && bpos>apos && data.substring(apos+9, bpos)=='yes'){
           confirmCseVersion(true,verstr);
         } else 
                {
           confirmCseVersion(false,verstr);
         }
         return false;
       }
       
       
       var jupyterOnDemandClearOutputStr = "\
           <h3>Jupyter</h3>\
           <h6>\
             This will clear out all the output arrays in the selected notebook(s) and save the modified notebook(s) under new name(s); the original(s) will not be modified.\
           </h6>\
           <h6>\
             This is useful when notebook sizes get very large due to debug print statements and they take a long time to load.\
           </h6>\
       ";
       var jupyterAutoClearOutputStr = "\
           <h3>Jupyter</h3>\
           <h6>\
             At least one of your notebooks is very large; perhaps due to debug print statements in the outputs. If you are experiencing long load times, you can use choose to clear the output arrays from you notebooks(s).\
           </h6>\
           <h6>\
             The modified notebook(s) will be saved with new name(s); the original notebook(s) will not be modified.\
           </h6>\
       ";                         

       function showJupyterClearOutputModal(nbsWsz, type)
       {
         if (nbsWsz.length == 0)
         {
           alert("Jupyter: No notebooks found in the workarea");
           return;
         }

         var max_size_in_kb = 10 * 1000;
         var data = ''
                  + '<table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">'
         ;
         for (var i = 0; i < nbsWsz.length; i++)
         {
           nba = nbsWsz[i];
           data += '<tr id="jupyter_file_' + i + '">';

           sz = nba[1];
           if (sz > 1000)
           {
             sz = Math.round(sz / 1000);
             sz = sz + ' MB';
           }
           else
           {
             sz = sz + ' KB';
           }

           data += '<td class="jupyter-modal-td-file"><input id="jupyter_co_file_cb_' + i + '" class="span1 jupyter-modal-td-checkbox" type="checkbox" ';
           if (nba[1] >= max_size_in_kb)
           {
             data += 'checked>';
           }
           else
           {
             data += '>';
           }
           data += nba[0] + ' [' + sz + ']';
           data += '</td></tr>';
         }

         var str = "";
         if (type == 'auto')
         {
           str = jupyterAutoClearOutputStr;
         }
         else if (type == 'on_demand')
         {
           str = jupyterOnDemandClearOutputStr;
         }
         $('#jupyterClearOutputModal_header').html(str);
         $('#jupyterClearOutputModal_files').html(data);
         $('#jupyterClearOutputModal_ta').hide();
         $('#jupyterClearOutputModal_cancel').show();
         $('#jupyterClearOutputModal_co').show();
         $('#jupyterClearOutputModal_ok').hide();
         $("#jupyterClearOutputModal").css('height', 'auto');
         $('#jupyterClearOutputModal').modal();
       }

       function showJupyterReleaseModal(nbs, opts)
       {
         if (nbs.length == 0)
         {
           alert("Jupyter: No notebooks found in the workarea");
           return;
         }

         var data = ''
                  + 'Notebook(s) to be released:'
                  + '<table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">'
         ;
         for (var i = 0; i < nbs.length; i++)
         {
           data += '<tr id="jupyter_file_' + i + '">';
           data += '<td class="jupyter-modal-td-file"><input id="jupyter_file_cb_' + i + '" class="span1 jupyter-modal-td-checkbox" type="checkbox" checked>';
           data += nbs[i];
           data += '</td></tr>';
         }
         data += '</table>';
         data += '<br>';
         data += 'Options:';
         data += '<table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">';
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_extract_rubric" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"'; // + 'checked>';
         if (!opts || (typeof opts['extractrubric'] === undefined) || (opts['extractrubric'] == "1")) {
           data += ' checked ';
         }
         data += '>';
         data += 'Extract rubric items from notebook(s)';
         data += '</td></tr>';

         
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_script_resource_link" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"'; // + 'checked>';
         if (!opts || (typeof opts['createresourceLink'] === undefined) || (opts['createresourceLink'] == "1")) {
           data += ' checked ';
         }
         data += '>';
         data += 'Create resource link in Starter Code';
         data += '</td></tr>';
         data += '</table>';

         // Script Options:
         data += '</table>';
         data += '<br>';
         data += 'Script Options:';
         data += '<table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">';

         // Overwrite grading script
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_script_ow" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"'; // + 'checked>';
         if (!opts || (typeof opts['owgrdscript'] === undefined) || (opts['owgrdscript'] == "1")) {
           data += ' checked ';
         }
         data += '>';
         data += 'Overwrite existing grading script';
         data += '</td></tr>';

         // Show traceback
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_script_traceback" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"';
         if (!opts || (typeof opts['tbgrdscript'] === undefined) || (opts['tbgrdscript'] == "1")) {
           data += ' checked ';
         }
         data += '>';
         data += 'Show traceback for errors';
         data += '</td></tr>';

         // Show feedback (via html report)
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_script_feedback" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"';
         // default is unchecked
         if (opts && (typeof opts['fbgrdscript'] !== undefined) && (opts['fbgrdscript'] == "1")) {
           data += ' checked ';
         }
         data += '>';
         data += 'Show html feedback report';
         data += '</td></tr>';

         data += '</table>';


         $('#jupyterModal_files').html(data);

         $('#jupyterModal_ta').hide();
         $('#jupyterModal_ok').hide();
         $('#jupyterModal_cancel').show();
         $('#jupyterModal_release').show();

         $("#jupyterModal").css('height', 'auto');
         $('#jupyterModal').modal();
       }

       var releaseNotebooks = [];
       var notebooksWithSizes = [];
       function processNotebooks(type)
       {
         // get a list of notebooks
         releaseNotebooks = [];
         var jqxhr = $.ajax('../util/vcput.php?a=getNotebooksViaWebServer'
                          + '&courseid='  + 11575                          + '&basnid='    + 121095                      
                          + '&stepid='    + 121096                          + '&asnuserid=' + 460852                          + '&workarea='  + "/home/nowhere")
                      .done(function(data, textStatus, jqXHR) {
                        // console.log(data);
                        try {
             	          var result = JSON.parse(data);
                          if (result['status'] == 'Error') {
                            alert("Error retrieving notebook list: " + result['msg'])
                          }
                          else {
                            var prev_options = null;
                            if (typeof result['options'] === 'undefined') {
                              console.log("Options not found");
                            } else {
                              console.log("Options: ");
                              console.log(result['options']);
                              prev_options = result['options'];
                            }
                            notebooksWithSizes = result['notebooks'];
                            for (i = 0; i < notebooksWithSizes.length; i++) {
                              nba = notebooksWithSizes[i];
                              releaseNotebooks.push(nba[0]);
                            } 
                            if (type == "release")
                            {
                              showJupyterReleaseModal(releaseNotebooks, prev_options);
                            }
                            else if (type == "clear_output")
                            {
                              showJupyterClearOutputModal(notebooksWithSizes, 'on_demand');
                            }
                            else if (type == "notebook_size_check")
                            {
                              checkNotebookSize(notebooksWithSizes);
                            }
                          }
                        }
                        catch(err) {
                          alert("Exception retrieving notebook list: " + err)
                        }
                      })
                      .fail(function(data, textStatus, jqXHR) {
                        alert("Error retrieving notebook list");
                      });
       }

       var jupyterModalDotTimer;

       function showJupyterModalDots()
       {
         text = $('#jupyterModal_ta').text();
         $('#jupyterModal_ta').text(text + '.');
         jupyterModalDotTimer = setTimeout(showJupyterModalDots, 1000);
       }

       function jupyterReleaseNotebooks()
       {
         if (releaseNotebooks.length == 0)
         {
           alert("No notebooks found");
           return;
         }
         nbsToRelease = [];
         for (var i = 0; i < releaseNotebooks.length; i++)
         {
           if ($('#jupyter_file_cb_' + i).prop('checked'))
           {
             nbsToRelease.push(releaseNotebooks[i]);
           }
         }
         if (nbsToRelease.length == 0)
         {
           alert("No notebook(s) selected for release");
           return;
         }

         var overwriteGradingScript = 0;
         if ($('#jupyter_script_ow').prop('checked'))
         {
           overwriteGradingScript = 1;
         }
         var extractRubric = 0;
         if ($('#jupyter_extract_rubric').prop('checked'))
         {
           extractRubric = 1;
         }
         var deleteRubric = 0;
         if ($('#jupyter_delete_rubric').prop('checked'))
         {
           deleteRubric = 1;
         }
         var createResourceLink = 0;
         if ($('#jupyter_script_resource_link').prop('checked'))
         {
           createResourceLink = 1;
         }
         var tracebackGradingScript = 0;
         if ($('#jupyter_script_traceback').prop('checked'))
         {
           tracebackGradingScript = 1;
         }
         var feedbackGradingScript = 0;
         if ($('#jupyter_script_feedback').prop('checked'))
         {
           feedbackGradingScript = 1;
         }

         ht = $('#jupyterModal').height();
         $('#jupyterModal_ok').show();
         $('#jupyterModal_cancel').hide();
         $('#jupyterModal_release').hide();
         $('#jupyterModal_ta').text("Releasing notebook(s).");
         $('#jupyterModal_ta').show();
         $("#jupyterModal").animate({ scrollTop: $('#jupyterModal').prop("scrollHeight")}, 1000);
         jupyterModalDotTimer = setTimeout(showJupyterModalDots, 500);

         var jqxhr = $.ajax('../util/vcput.php?a=releaseNotebooks'
                          + '&courseid='  + 11575                          + '&basnid='    + 121095                      
                          + '&stepid='    + 121096                          + '&asnuserid=' + 460852                          + '&workarea='  + "/home/nowhere"
                          + '&notebooks='  + nbsToRelease.join('_____')
                          + '&owgrdscript=' + overwriteGradingScript
                          + '&extractrubric=' + extractRubric
                          + '&createresourceLink=' + createResourceLink
                          + '&deleterubric=' + deleteRubric
                          + '&tbgrdscript=' + tracebackGradingScript
                          + '&fbgrdscript=' + feedbackGradingScript)
                      .done(function(data, textStatus, jqXHR) {
                        clearTimeout(jupyterModalDotTimer);
                        console.log(data);
                        try {
                          var result = JSON.parse(data);
                          if (result['status'] == 'Error') {
                            alert("Error releasing notebook(s): " + result['msg'])
                          }
                          else {
                            $('#jupyterModal_ta').text(result['stdout']);
                            $("#jupyterModal_ta").animate({
                              scrollTop:$("#jupyterModal_ta")[0].scrollHeight - $("#jupyterModal_ta").height()
                            },1000);
                            $('#updatebtntext').html('Update*');
                          }
                        }
                        catch(err) {
                          alert("Exception releasing notebook(s): " + err)
                        }
                      })
                      .fail(function(data, textStatus, jqXHR) {
                        clearTimeout(jupyterModalDotTimer);
                        alert("Error releasing notebook(s)");
                      });
       }

       $('#jupyterModal_release').click(function() {
         //$('#jupyterModal').modal('hide');
         setTimeout(jupyterReleaseNotebooks, 500);
       });

       var jupyterClearOutputModalDotTimer;

       function showJupyterClearOutputModalDots()
       {
         text = $('#jupyterClearOutputModal_ta').text();
         $('#jupyterClearOutputModal_ta').text(text + '.');
         jupyterClearOutputModalDotTimer = setTimeout(showJupyterClearOutputModalDots, 1000);
       }


       function jupyterNotebookClearOutput()
       {
         if (releaseNotebooks.length == 0)
         {
           alert("No notebooks found");
           return;
         }
         nbsToClear = [];
         for (var i = 0; i < releaseNotebooks.length; i++)
         {
           if ($('#jupyter_co_file_cb_' + i).prop('checked'))
           {
             nbsToClear.push(releaseNotebooks[i]);
           }
         }
         if (nbsToClear.length == 0)
         {
           alert("No notebook(s) selected for clearing output");
           return;
         }

         $('#jupyterClearOutputModal_ta').text("Clearing output for notebook(s).");
         $('#jupyterClearOutputModal_ta').show();
         $('#jupyterClearOutputModal_ok').show();
         $('#jupyterClearOutputModal_co').hide();
         $('#jupyterClearOutputModal_cancel').hide();
         $("#jupyterClearOutputModal").animate({ scrollTop: $('#jupyterClearOutputModal').prop("scrollHeight")}, 1000);
         jupyterClearOutputModalDotTimer = setTimeout(showJupyterClearOutputModalDots, 500);

         var jqxhr = $.ajax('../util/vcput.php?a=notebookClearOutput'
                          + '&courseid='  + 11575                          + '&basnid='    + 121095                      
                          + '&stepid='    + 121096                          + '&asnuserid=' + 460852                          + '&workarea='  + "/home/nowhere"
                          + '&notebooks='  + nbsToClear.join('_____'))
                      .done(function(data, textStatus, jqXHR) {
                        clearTimeout(jupyterClearOutputModalDotTimer);
                        console.log(data);
                        try {
                          var result = JSON.parse(data);
                          if (result['status'] == 'Error') {
                            alert("Error clearing output: " + result['msg'])
                          }
                          else {
                            $('#jupyterClearOutputModal_ta').text(result['stdout']);
                            $("#jupyterClearOutputModal_ta").animate({
                              scrollTop:$("#jupyterClearOutputModal_ta")[0].scrollHeight - $("#jupyterClearOutputModal_ta").height()
                            },1000);
                          }
                        }
                        catch(err) {
                          alert("Exception clearing output: " + err)
                        }
                      })
                      .fail(function(data, textStatus, jqXHR) {
                        clearTimeout(jupyterClearOutputModalDotTimer);
                        alert("Error clearing output");
                      });

       }

       $('#jupyterClearOutputModal_co').click(function() {
         //$('#jupyterModal').modal('hide');
         setTimeout(jupyterNotebookClearOutput, 500);
       });

       $('#clear_notebook_output').click(function() {
         //$('#jupyterModal').modal('hide');
         setTimeout(processNotebooks, 500, 'clear_output');
       });

                          function checkNotebookSize(nbsWsz)
                          {
                            var max_size_in_kb = 10 * 1000;
                            for (i = 0; i < nbsWsz.length; i++) {
                              nba = nbsWsz[i];
                              if (nba[1] >= max_size_in_kb)
                              {
                                showJupyterClearOutputModal(nbsWsz, 'auto');
                                return;
                              }
                            }
                          }
                          
	          $(document).ready(function() {   
                                      });

       $('#updatebtn').click(function(){
         $.ajax({
           url: '../util/vcput.php?a=courseversion&stepid=121096',
           type: 'get',
           success: function(data) {
              var apos = data.search('voc::');
              var bpos = data.search('::voc');
              if(apos>=0 && bpos>=0 && bpos>apos){
                updateCseVersion(data, data.substring(apos+5, bpos));
              } else {
                updateCseVersion(data, data.substring(apos+5, bpos));
              }
            }
         });
       });
       $('#help-window' ).click(function(){
            if (!$('#jspanelWindow').length) {
		$.jsPanel({
			id: "jspanelWindow",
    			theme:    "light",
    			title:    "",
			addClass: {
				header: "voc-jpanel-header",
				content: "voc-jpanel-content",
			},
			position: { top: 130, right: "auto" },
			size: { width: 400, height: 500 },
			resizable: "disabled",
			content:  "<iframe src='' width='100%' height='100%' style='' title='Help'></iframe>",
 			controls: { buttons: 'closeonly', iconfont: 'font-awesome' },
		});
	    }
        });
				
		});

/* turtle start */
/* turtle end */		

function unescapeHtml(safe) {
    return safe.replace(/&amp;/g, '&')
        .replace(/&lt;/g, '<')
        .replace(/&gt;/g, '>')
        .replace(/&quot;/g, '"')
        .replace(/&#039;/g, "'")
        .replace(/<br>/g, "");
}


/* we always get the str as htmlspecialchars from php - now print depends whether on terminal or console 
 * to unescape html */
function consolePrint(str) {
    if ((typeof(str) === 'undefined') || (str == null)) {
      return;
    }
            str = str.replace(/VOC_NL/gm, "");
        str = str.replace(/(?:\r\n|\r|\n)/g, '<br />');
                
        str = '<pre>' + str + '</pre>';
                    $('#buildtextarea').html(str);
                

    }		

function widgetModalOutput(str) {
    $('#div-widgetoutput').html("<i class=\"icon-spin icon-spinner\"></i>&nbsp; Waiting for output ..");        
    $('#modal-table-widgetoutput').modal('show');
    $('#div-widgetoutput').html(str);
}

var reportsToOpen = true;
function updateReportStatus(type, str) {
    var statusElem = '#'+type+'ReportStatus';
    $(statusElem).html(str);
    $(statusElem).show();

    if (!($('#reports').hasClass('open')) && reportsToOpen) {
        $('#reportsdropdown').trigger('click');
        reportsToOpen = false;
    } 
}
function updateReportProgress(type, str) {
    var statusElem = '#'+type+'ReportProgress';
    if( str!='' ){
      $(statusElem).html(str);
      $(statusElem).show();
    } else {
      $(statusElem).hide();
    }
}
function updateReportReady(type, show) {
    var statusElem = '#'+type+'reportbutton';
    if( show ) $(statusElem).show();
    else       $(statusElem).hide();
}

function stopCheckReportTimeout(type) {
  if ($("body").data("timeout"+type) != null) {
    clearTimeout($("body").data("timeout"+type));
  }
}

function startCheckReportTimeout(type, url, chksubmit, chkgrade, tv, st) {
  stopCheckReportTimeout(type);
  timeoutVar = setTimeout(function() {
                 asyncCheckReportPeriodic(type, url, chksubmit, chkgrade, tv, st);
               }, 2000);
  $("body").data("timeout"+type, timeoutVar);
}

var waitingForReport = false;
var maxPollTv = 120; //3m
function asyncCheckReportPeriodic(type, url, chksubmit, chkgrade, tv, st) {  
    var statusElem = '#'+type+'ReportStatus';
            if( tv>0 ){
          var elapsed = (Math.floor(Date.now() / 1000) - st);
                    if( true || type!='Submission' || chksubmit===0 ){
            updateReportStatus(type, '<i class="icon-spin icon-spinner"></i>waiting for report ' + elapsed + 's');
          }
        } else {
          waitingForReport = true;
          $("body").data("timeout"+type, null);
          updateReportStatus(type, 'Please come back and click here for the report ...');
          if (type=='RUN' || type=='BUILD') { // activity icon only for RUN as of now
            updateRunIcon(type, false);
          }
          return false;
        }
        if( tv <= (maxPollTv-10) ) { // after 10s
          if( tv>(maxPollTv-60) )  { // before 1m
            if( (tv % 10) != 0 ){
              startCheckReportTimeout(type, url, chksubmit, chkgrade, tv-2, st);
              return false;
            }
          } else if (tv>0){
            if( (tv % 30) != 0 ){
              startCheckReportTimeout(type, url, chksubmit, chkgrade, tv-2, st);
              return false;
            }
          }
        }
        tv -= 2;
        $.ajax({
            url: url,
            data: {},
            success: function(ret_val) {  

                if (ret_val.indexOf('ERROR:INVALID_SESSION>') == 1) { // invalid session
                  window.location.replace("https://labs.vocareum.com/main/logout.php");
                }

                try {
                  resp = jQuery.parseJSON(ret_val);
                } catch(err) {
                    show_voc_gritter(false, "Internal error: invalid json", true);
                    consolePrint('Internal error: invalid json');
                    if (type=='RUN' || type=='BUILD') { // activity icon only for RUN as of now
                      updateRunIcon(type, false);
                    }
                    return;
                }     
                                if (resp.state != 2) {
                    startCheckReportTimeout(type, url, chksubmit, chkgrade, tv, st);
                } else {  // done
                    $("body").data("timeout"+type, null);
                    if ( (resp.status == 1) ||
                                (resp.status == 2) ) {
                        
                        if (type=='RUN' || type=='BUILD') { // activity icon only for RUN as of now
                                                    if(resp.status == 1){
                            show_voc_gritter(false, type + ' completed successfully', false);
                          } else {
                            show_voc_gritter(false, type + ' completed with errors', true);
                          }
                          updateRunIcon(type, false);
                                                  }
                                                                                                           reportsToOpen = true;
                               if( true ) {
                                 updateReportStatus(type, '<i class="icon-ok"></i>New report ready');
                               }
                               consolePrint(type + " Report:");
                               consolePrint(resp.output);
                                                        refreshFileTree(false, true);                                                
                                                
                                                       reportsToOpen = true;
                               if( true ) {
                                 updateReportStatus(type, '<i class="icon-ok"></i>New report ready');
                                 //mhui
                                 var element =  document.getElementById('gradeframe');
                                 if (typeof(element) != 'undefined' && element != null && advance_features == 1)
                                 {
                                 	 $('#gradesIdeBtn').click();
                                 }
                               }
                                                
                        
                    } else {
                        str = "Unexpected failure. Please contact support";
                                                    reportsToOpen = true;
                            updateReportStatus(type, '<i class="icon-info"></i>Unexpected error');
                                                        
                            
                                                
                    }
                    
                }          
            }
    });  
    
}		
		
		
var submit_maxcount = -1;
var submit_count = 0;		
var submit_in_progress = false;
var submission_open = 0;
var show_peer_review_confirm_dialog = 0;
var auto_peer_review_mode = 0;


function showSolutionAlert() {
          bootbox.dialog("You can now download the solution from the Actions drop-down menu",
                         [{
                           "label" : "Ok",
                            "class" : "btn vocbtn-ac vocbtn-action"
                          }]
          );
}

function updateSubmitDetails(resp) {
    if( (typeof resp.data !== "undefined") && resp.data ) {
        var subData = resp.data;
        var str = "";
         
        str += '';
        str += '';
        str += '';
        str += '<tr><td>AWS:</td><td> <div  class="btn vocbtn2 vocbtn-status" data-toggle="tab" href="#" tabindex="0" role="button" style="border:0px; line-height:17px !important"  onclick="showawsact(0);" id="showawsbtn">Show</div></td></tr>';
        str += '<tr><td>Labs:</td><td> <div  class="btn vocbtn2 vocbtn-status" data-toggle="tab" href="#" tabindex="0" role="button" style="border:0px; line-height:17px !important"  onclick="showclabs(false);" id="showclabsbtn">Show</div></td><tr>';
        if (str != '') {
            $('#subdetails').html(str);
        }
    }
}

  // if ($canSubmit)

function updateSubmitIcon(inprogress) {
    submit_in_progress = inprogress;
    if (inprogress) {
        $('#btn-submitasn').html('<i class="icon-spin icon-spinner"></i>Submitting</button>');
    } else {
        if ((submit_maxcount < 0) || (submit_count <= submit_maxcount) || (submission_open != 0)) {
            $('#btn-submitasn').html('Submit');  
        } else {
            $('#btn-submitasn').hide();
        }      
    }
}

function updateRunIcon(type, inprogress) {
    var btn = '#' + type + '-btn';
    var name = type=='RUN'? 'Run' : 'Build';
    if (inprogress) {
        $(btn).html('<i class="icon-spin icon-spinner"></i>' + name);
    } else {
        $(btn).html(name);
    }
}

		
		
	            
        function verifyResubmit(url, resubmit)
        {
          var str = "Are you sure you want to submit?";
          if(resubmit){
            str += '<br>Your earlier submission is still being processed. If you submit again, the previous submission may be terminated.';
          }
                      bootbox.dialog(str,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                             handleSubmitUpdate(url);
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
          );
          return false;
        }      

                  function checkAndVerifyResubmit(url) {
                                                            $.ajax({
                      url: "../util/vcput.php?a=chkResubmit&tv="+Date.now()+"&stepid=121096&version=0",
                    })
                     .done(function(ret_val) {
                       return verifyResubmit(url, ret_val.indexOf('status::progress')>=0);
                     })
                     .fail(function(ret_val) {
                       // procees to submit anyway
                       return verifyResubmit(url, false);
                     });
                                      }
                  
                    
        function confirmSubmitAsnBtn(url) {

                  

 				if (isSaveNeeded()) {					
					voc_save(true, "Saving");
				}       
                  checkAndVerifyResubmit(url);
        };
        function gotoTeam(pid, name)
        {
          bootbox.dialog('Are you sure you want to switch to the workarea owned by [' + name + ']?', 
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                             window.location = "main.php?m=editor&nav=1&asnid=121095&stepid=121096&ownerid="+pid+"&permit=7";
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
          );
        }
        function copyworkarea()
        {
          saveCBClipboard('work\/');
          return false;
        }
        function pasteworkarea()
        {   
          pasteCB("Paste", 'work\/', '', "Paste successful", true);
          return false;
        }
        function confirmResetAsnBtn(url) {
          var str = 'Reset will delete all your content in the work area  and replace it with the starter code.<br><br>' +
                    '' +
                    'Are you sure you want to reset your work-area?';
                                    bootbox.dialog(str, 
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                                                            show_voc_gritter(true, ' Resetting work-area ...', true);
                                                          window.location = url;
                           }
                         }, 
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
              );
                              };
      

			if ($.cookie('buildtextareaData')) {
				$.removeCookie('buildtextareaData');
			}
			
      $(window).bind('beforeunload', function() {
          if (isSaveNeeded()) {
              voc_save(true, "Saving before you quit page, please wait");
              return 'Please wait till we save your unsaved changes';
          }
      });
      
      var vocClipboard = '';
      $(window).bind({
                copy : function(e){
                        var str = window.getSelection().toString();
                        if ((str == "") && e.target && e.target.value) {
                            console.log(e.target.value);
                            str = e.target.value;
                        }
                        vocClipboard = str.trim();
                        console.log('copied: ' + vocClipboard);
                }
      });      

  // if we wanted to use the terminal but could not, print an error msg
  
  var vcChkSubmitFP = false;
  
  $( "#downloadbtn" ).click(function() {
	if ($('#input_filename').val().startsWith("Submissions/")) {
		var url = "../main/submissionurl.php?asnid=121096&mode=s&version=0&courseid=11575&userid=460852&data=" + $('#input_filename').val();
	} else {
    	var filepath = "./" + $('#input_filename').val();
    	var url = "../domains/ide_src_zip.php?stepid=121096&mode=s&version=0&filepath=" + filepath;
	}
    $('#div-output-download_from_ide').html("<iframe src=\""+url+"\" width=\"100%\" height=\"100%\" title=\"Download\"></iframe>");
  });

  function getStudentReport(target, targetDiv, type, num) {
    var jqxhr = $.ajax('../util/vcput.php?a=getStudentReport'
                     + '&stepid='+ 121096                     + '&userid='+ 460852                     + '&type=' + type 
                     + '&version=0'
                     + '&num=' + num)
                 .done(function(data, textStatus, jqXHR) {
                   // alert(data);
                   target.innerHTML = data;
                   targetDiv.scrollTop = targetDiv.scrollHeight;
                               if( waitingForReport && data.search(/Executed/)>=0 ){
                     waitingForReport = false;
                     if( true ) {
                       updateReportStatus(type, '<i class="icon-ok"></i>New report ready');
                     }
                     consolePrint(data);
                   }
                             })
                 .fail(function(data, textStatus, jqXHR) {
                   target.innerHTML = "<p>No " + type + " Report has been generated<p>";
                   targetDiv.scrollTop = targetDiv.scrollHeight;
                 });
  }
                  
  function showStudentReportHtml(modalHtml, iframeHtml, iframeTitle, type, fileName)
  {
     var url = "../web/460852/121096/work/" + fileName;
     iframeTitle.html(type + " Report");
     iframeHtml.attr("src", url);
     modalHtml.modal('show');
  }             
                  
  function showStudentReportText(modalDiv, target, targetDiv, text)
  {
     modalDiv.modal('show');
     str = text.replace(/(?:\r\n|\r|\n)/g, '<br />');
     target.innerHTML = str;
     targetDiv.scrollTop = targetDiv.scrollHeight;
  }             
                  
  function showStudentReport(modalDiv, target, targetDiv, modalHtml, iframeHtml, iframeTitle, type, num) {
    var jqxhr = $.ajax('../util/vcput.php?a=showStudentReport'
                     + '&stepid='+ 121096                     + '&userid='+ 460852                     + '&type=' + type
                     + '&work=' + "/home/nowhere"
                     + '&version=0'
                     + '&num=' + num)
                 .done(function(data, textStatus, jqXHR) {
                   try {
                     var result = JSON.parse(data);
                     if (result['status'] == 'Error') {
                       showStudentReportText(modalDiv, target, targetDiv, result['msg']);
                     } else {
                       if (result['msg']) {
                         showStudentReportText(modalDiv, target, targetDiv, result['msg']);
                       } else if (result['fileType'] == "text") {
                         showStudentReportText(modalDiv, target, targetDiv, result['reportFile']);
                       } else {
                         showStudentReportHtml(modalHtml, iframeHtml, iframeTitle, type, result['reportFileName']);
                       }
                     }
                   }
                   catch (e) {
                     showStudentReportText(modalDiv, target, targetDiv, 'Parse error getting student report: ' + e);
                   }
                               if (waitingForReport) {
                     waitingForReport = false;
                     if( true ) {
                       updateReportStatus(type, '<i class="icon-ok"></i>New report ready');
                     }
                     consolePrint(data);
                   }
                             })
                  .fail(function(data, textStatus, jqXHR) {
                    showStudentReportText(modalDiv, target, targetDiv, "<p>No " + type + " Report has been generated<p>");
                 });
  }

  function showrep(grading)
  {
    var name, type;
    if(grading) {
      name = 'grading';
      type = 'Grading';
    } else {
      name = 'submission';
      type = 'Submission';
    }
    var target = document.getElementById("report_" + name + "_msg_box");
    var targetDiv = document.getElementById("report_" + name + "_div");

    // if course has new flag set
          $('#modal-table-report-all-html-iframe').attr("src", "");
      showStudentReport($('#modal-table-report-' + name), target, targetDiv,
                        $('#modal-table-report-all-html'), $('#modal-table-report-all-html-iframe'),
                        $('#modal-table-report-all-html-title'), type, 0);
      }
  $('#gradingreportbutton').click(function(e) {
    showrep(1);
    e.preventDefault();// prevent the default anchor functionality
  });
  
  $('#submissionreportbutton').click(function(e) {
    showrep(0);
    e.preventDefault();// prevent the default anchor functionality
  });

  $('#runreportbutton').click(function(e) {
    var target = document.getElementById("report_run_msg_box");
    var targetDiv = document.getElementById("report_run_div");

    $('#modal-table-report-run').modal('show');
    getStudentReport(target, targetDiv, 'RUN', 0);

    e.preventDefault();// prevent the default anchor functionality
  });
  $('#buildreportbutton').click(function(e) {
    var target = document.getElementById("report_build_msg_box");
    var targetDiv = document.getElementById("report_build_div");

    $('#modal-table-report-build').modal('show');
    getStudentReport(target, targetDiv, 'BUILD', 0);

    e.preventDefault();// prevent the default anchor functionality
  });

  var dottyTimeout;
  var jupyterHtmlStyle = 'style="text-align:left; margin-left: 10px; padding-top:10px"';

  function vcLogJupyterError(jid, msg, ip, url)
  {
    var jqxhr = $.ajax({
      type: 'POST',
      url: '../util/vcput.php',
      data: { a: 'logJupyterError', msg: msg, jid: jid, ip: ip, url: url }
    })
    .done(function(data, textStatus, jqXHR) {
       // all done
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      // if the error logging itself failed, don't know what else to do...
    });
  }
                  
  function editVers()
  {
    $('#modal-edit-vers').modal('show');
  }
  function setView(type) {
        name = "vocview_460852_121096";
    str = name + "=" + type + "; path=/";
    // if this cookie is already set with the same value as "type", nothing to do
    var re = new RegExp(name + '=(\\w*)');
    allcookies = document.cookie;
    var matches = allcookies.match(re);
    if (matches && (matches.length > 1) && (matches[1] == type))
    {
      return;
    }
    document.cookie = str;
    location.reload();
  }

  function setNewTabView(type) 
  {
    var loc = "main.php?m=editor&nav=1&asnid=121095&stepid=121096" + '&force_idetype=' + type + '&force_noreadme=1';
    window.open(loc);
  }

  function openAppWindow(loc)
  {
    window.open(loc);
  }

  function getXstartupFileName(type)
  {
    switch (type) {
              case 0: return "xstartup.test";
              case 1: return "xstartup.eclipse";
              case 2: return "xstartup.mysqlwb";
              case 5: return "xstartup.pgadmin";
              case 3: return "xstartup.spyder3";
              case 4: return "xstartup.desktop";
              case 6: return "xstartup.android-studio";
              default: return "xstartup.desktop";
    }
  }

  var vocLaunchingApp = false;
  function vocLaunchTimer()
  {
    vocLaunchingApp = false;
  }
                  
  function launchApp(type)
  {
    $('#app_spinbox_' + type).show();

    if (vocLaunchingApp == true) {
      return;
    }
    vocLaunchingApp = true;
    setTimeout(vocLaunchTimer, 5000);

    xstartup_file = '/home/lib/ubuntu1604/vdi/xstartup_files/' + getXstartupFileName(type);
    data = { 'action': 'Launch', 'token': '', 'proxy_path': 'proxy.vocareum.com/hostip/172.31.19.103:5000/vocproxy/1838581686460852460852121096015ea014c1c024c8.14590148', 'proxy_scheme': 'https', 'xstartup_file': xstartup_file };

    var jqxhr = $.ajax({
      type: 'POST',
      url: "https://proxy.vocareum.com/hostip//",
      data: JSON.stringify(data)
    })
    .done(function(data, textStatus, jqXHR) {
       $('#app_spinbox_' + type).hide();
       console.log(data);
       if (data['status'] == 'Error') {
         alert("VDI: Error: " + data['msg'])
       }
       else {
         // alert("location = " + data['location']);
         window.setTimeout(function() { openAppWindow(data['location']); } , 1000);
       }
       $('#actionsdropdown_liactions2').parent().removeClass('open');
       clearTimeout(vocLaunchTimer);
       vocLaunchingApp = false;
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      $('#app_spinbox_' + type).hide();
      alert("VDI: Launch Failed");
      $('#actionsdropdown_liactions2').parent().removeClass('open');
      clearTimeout(vocLaunchTimer);
      vocLaunchingApp = false;
    });
  }

  function stopApp()
  {
    $('#app_spinbox_stop').show();

    data = { 'action': 'Stop', 'token': '' }

    var jqxhr = $.ajax({
      type: 'POST',
      url: "https://proxy.vocareum.com/hostip//",
      data: JSON.stringify(data)
    })
    .done(function(data, textStatus, jqXHR) {
       $('#app_spinbox_stop').hide();
       console.log(data);
       if (data['status'] == 'Error') {
         alert("VDI: Error: " + data['msg'])
       }
       $('#actionsdropdown_liactions2').parent().removeClass('open');
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      $('#app_spinbox_stop').hide();
      $('#actionsdropdown_liactions2').parent().removeClass('open');
    });                  
  }

  $("#tableaubtn").click(function() {
    var loc = "http://ec2-35-162-97-247.us-west-2.compute.amazonaws.com";
    window.open(loc);
  });

  function dotty()
  {
    val = $('#jupyterIframeParent').text();
    $('#jupyterIframeParent').html('<p ' + jupyterHtmlStyle + ' >' + val + '. </p>');
    dottyTimeout = setTimeout(dotty, 1000);
  }
  function startDotty(type)
  {
    $('#jupyterIframeParent').html('<p ' + jupyterHtmlStyle + ' >Loading ' + type +' server' + ' </p>');
    dottyTimeout = setTimeout(dotty, 1000);
  }
  function stopDotty()
  {
    clearTimeout(dottyTimeout);
  }
  function launchRStudio()
  {
     return false;
  }
  function launchAws(v)
  {
     if( v===0 ){
       bootbox.dialog("<br>Your lab has not started yet. Please click StartLab in order to access AWS console",
                       [{
                         "label" : "Ok",
                         "class" : "btn vocbtn-ac vocbtn-action"
                       }]
                  );
       return;
     }
     var tv = v<0? '' : ('&tv=' + v);
     $.ajax({
              url: "../util/vcput.php?vockey=50dd6b2cfa76d91e27285f09c273e25e&a=getawsurl"+tv+"&asnid=121096&userid=460852&mode=s&version=0",
              data: {},
              success: function(data) {
                 var apos = data.search('voc::');
                 var bpos = data.search('::voc');
                 if(apos>=0 && bpos>=0 && bpos>apos){
                   if( data.search('voc::Error:')>=0 ){
                     consolePrint(data.substring(apos+5,bpos) + ' -- failed to launch AWS Console');
                   } else {
                     window.open(data.substring(apos+5,bpos), "rik.eudizi@gmail.com");
                   }
                 } else {
                   consolePrint('Failed to launch AWS Console');
                 }
              }
           });

  }
  function launchC9()
  {
     $.ajax({
        url: "../util/vcput.php?vockey=50dd6b2cfa76d91e27285f09c273e25e&a=getawsc9&asnid=121096&userid=460852&mode=s&version=0",
        data: {},
        success: function(data) {
           var apos = data.search('voc::');
           var bpos = data.search('::voc');
           if(apos>=0 && bpos>=0 && bpos>apos){
             if( data.search('voc::Error:')>=0 ){
               consolePrint(data.substring(apos+5,bpos) + ' -- failed to launch Cloud9 Console');
             } else {
               window.open(data.substring(apos+5,bpos), "rik.eudizi@gmail.com");
             }
           } else {
             consolePrint('Failed to launch Cloud9 Console');
           }
        }
     });
  }
  
  function launchAppStream()
  {
    return false;
  }
  
  function vocSetRunServerFromJupyter(uniqname)
  {
    var jqxhr = $.ajax({
      url: "../util/vcput.php",
      data: {a: "setRunServerFromJupyter", stepid: "121096", courseid: "11575", userid: "460852", uniqname: uniqname}
    })
    .done(function(data, textStatus, jqXHR) {
      // errors have already been logged
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      // errors have already been logged
    });                  
  }
                  
  function launchJupyter()
  {
    
    return false;
  }

  function vocCheckJupyterConsistency(username)
  {
    jif = document.getElementById('jupyterIframe');
    if (jif)
    {
      cw = jif.contentWindow;
      if (cw)
      {
        if (typeof(cw.vocExtGetUniqUserName) === typeof(Function))
        {
          name = cw.vocExtGetUniqUserName();
          if ((name != 'unset') && (name != username))
          {
            console.log("VOC name check: " + name + " :: " + username);
            window.location.replace($('#breadcrumb').find('a').attr("href") + "&w=Jupyter+session+closed");
          }
        }
      }
    }
    setTimeout(vocCheckJupyterConsistency, 1000, username);
  }


                  

  var vocPanelTerminalTryMax = 20; // 10s

  function vocTerminalTabTimeout(el, vm, counter)
  {
    if (el.contentWindow.tabReadyForCmd(vm['name']))
    {
      el.contentWindow.executeCommandOnTab(vm['name'], 'exec ' + vm['ssh_cmd']);
      return;
    }
    counter += 1;
    if (counter <= vocPanelTerminalTryMax)
    {
      setTimeout(vocTerminalTabTimeout, 500, el, vm, counter);
    }
    else
    {
      alert("Could not open new tab in terminal");
    }
  }

  function vocTerminalTimeoutInternal(el, vm, isNewWin)
  {
    if (isNewWin)
    {
      el.contentWindow.setTabTitle(0, vm['name']);
      el.contentWindow.executeCommand('exec ' + vm['ssh_cmd']);
    }
    else
    {
      if (el.contentWindow.createTabIfNoneExists(vm['name']) == true)
      {
        // so a new tab is being created - we need to wait for it
        // no need for else clause - coz the above call will focus on the correct tab
        setTimeout(vocTerminalTabTimeout, 500, el, vm, 0);
      }
    }
  }

  function vocTerminalTimeout(el, vm, isNewWin, counter)
  { 
     try 
     {
       if (el.contentWindow.vocTerminalIsAvailable())
       {
         setTimeout(vocTerminalTimeoutInternal, 500, el, vm, isNewWin);
         return;
       }
     }
     catch(err)
     {
       // nothing to do - we'll just try again
     }

     counter += 1;
     if (counter <= vocPanelTerminalTryMax)
     {
       setTimeout(vocTerminalTimeout, 500, el, vm, isNewWin, counter);
     }
     else
     {
       alert("Could not start terminal");
     }
  }
                  
  $('.vmtoolbarbtn').click(function(e) 
  {
    var vm_indx = e.target.dataset.indx;
    var jqxhr = $.ajax("../util/vcput.php?a=vcGetLabInfo&stepid=121096&version=0" + '&novnc=1' + '&vm_indx=' + vm_indx)
      .done(function(data, textStatus, jqXHR)
      {
        try 
        {
          var result = JSON.parse(data);
          if (result['status'] == 'Error')
          {
             show_voc_gritter(false, "Could not get lab information: " + result['msg'], true);
          }
          else
          {
            state = result['lab_state'];

            // get the appropriate container/vm
            vm = result['vms'][vm_indx];
            state = vm['state'];
                    
            if (state != "Ready")
            {
              bootbox.dialog("This machine is not in Ready state; please launch it before attempting to access it.", 
                             [{
                               "label" : "Ok",
                               "class" : "btn vocbtn-ac vocbtn-action",
                             }]
              );
            }
            else
            {
              if ((typeof vm['novnc_proxy'] !== "undefined") && vm['novnc_proxy']) 
              {
                $('#panel2Iframe').attr("src", vm['novnc_proxy']);
              }
              else if ((typeof vm['ssh_cmd'] !== "undefined") && vm['ssh_cmd']) 
              {
                console.log(vm);
                console.log(result);

                // Three cases:
                // 
                // 1. no terminal has ever been launched
                //    - start terminal
                //    - ssh cntnr
                // 2. terminal disappeared
                //    - "press" the launch button
                //    - ssh cntnr
                // 3. terminal is present
                //    - check if tab for this vm is already there
                //      - if so, select it
                //      - if not, open a new tab and ssh cntnr

                var isNewWin = true;
                const termExp = /\/terminal\//;
                var telement = document.getElementById('panel2Iframe');
                if ($('#panel2Iframe').attr("src") == "")
                {
                  $('#panel2Iframe').attr("src", "/terminal/?uid=460852&token=");
                }
                else if (termExp.test($('#panel2Iframe').attr("src")) === false)
                {
                  $('#panel2Iframe').attr("src", "/terminal/?uid=460852&token=");
                }
                else if (! telement.contentWindow.vocTerminalIsAvailable())
                {
                  console.log("voc-start-term");
                  telement.contentWindow.vocStartTerminal();
                }
                else
                {
                  isNewWin = false;
                }
                setTimeout(vocTerminalTimeout, 500, telement, vm, isNewWin, 0);
              }
              else if ((typeof vm['err'] !== "undefined") && vm['err'])
              {
                bootbox.dialog("Unable to access:  " + vm['err'], 
                               [{
                                 "label" : "Ok",
                                 "class" : "btn vocbtn-ac vocbtn-action",
                               }]
                );                      
              }
            }
          }
        }
        catch(err)
        {
          console.log("Exception: " + err);
          show_voc_gritter(false, "Could not get lab1 information", true);
        }
      })
      .fail(function(data, textStatus, jqXHR)
      {
        show_voc_gritter(false, "Could not get lab2 information", true);
      });
  });

                  function reallyResetClab()
                  {
                    show_voc_gritter_duration(true, "Resetting lab...", true, 15);
                    $.ajax({
                      url: "../util/vcput.php?a=resetclabsblocking&stepid=121096&version=0",
                    })
                     .done(function(ret_val) {
                       $.gritter.removeAll();
                       // wait for "None" state - when we have the new container-server flow (and don't use blocking above)
                       // setTimeout(waitForNoneState, 5000, "endResetClab");
                       setTimeout(show_voc_gritter, 1000, false, "Lab Reset Done", false);
                     })
                     .fail(function(ret_val) {
                       $.gritter.removeAll();
                       setTimeout(show_voc_gritter, 1000, false, "Reset failed", true);
                     });
                  }

                  function resetclabs()
                  {
                    $.ajax({
                      url: "../util/vcput.php?a=vcGetLabInfo&stepid=121096&version=0",
                    })
                     .done(function(data) {
                       try {
                         var result = JSON.parse(data);
                         if (result['status'] == 'Error') {
                           show_voc_gritter(false, "Could not get lab information: " + result['msg'], true);
                         }
                         else {
                           state = result['lab_state'];
                           if (state == "Ready") {
                             bootbox.dialog("The lab cannot be reset while it is running; please end the lab before proceeding.", 
                                            [{
                                              "label" : "Ok",
                                              "class" : "btn vocbtn-ac vocbtn-action",
                                            }]
                             );
                           }
                           else {
                             reallyResetClab();
                           }
                         }
                       } catch(err) {
                         show_voc_gritter(false, "Could not get lab1 information", true);
                       }
                     })
                     .fail(function(data, textStatus, jqXHR) {
                       show_voc_gritter(false, "Could not get lab2 information", true);
                     });
                    
                    return;
                  }

                  function confirmLabReset()
                  {
                    bootbox.dialog("The operation will remove all host-mounted writeable data stores (such as databases).<br><br>Press Ok to continue or Cancel to abort.", 
                               [
                                 {
                                   "label" : "Ok",
                                   "class" : "btn vocbtn-ac vocbtn-action",
                                   "callback": function() {
                                     resetclabs();
                                   }
                                 },
                                 {
                                   "label" : "Cancel",
                                   "class" : "btn vocbtn-ac vocbtn-status"
                                 }                                   
                               ]
                    );
                  }

        function useSlipDays() {
          var data = "";
          var urlval = "../util/vcput.php?m=editor&vocajax=1&stepid=" + 121096 + "&a=useMySlipDays&caller=ide&ajaxData=1&q1=asnid=" + 121095;
          $.ajax({
           type: "POST",
           url: urlval,
           data: data
          })
          .done(function(ret_val) {
                if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                  window.location.replace("https://labs.vocareum.com/main/logout.php");                                    
                }
                resp = jQuery.parseJSON(ret_val);
                if (resp.success !== 'true') {
                    show_voc_gritter(true, 'Failed: ' + resp.msg, true);
                } else {
                // success
                    if( (typeof resp.msg !== "undefined") && resp.msg ) {
                      show_voc_gritter(true, 'Failed: ' + resp.msg, true);
                    } else {
                      show_voc_gritter(false, resp.ret_arg1 + ' slip day(s) used', false);
                    }
                }       
                return false;   
            })
            .fail(function(ret_val) {
                    show_voc_gritter(false, ' Operation failed. Please try again', true);
                    return false;
            });
        }

        $('#useSlipDays').click(function() {
          var str = "Are you sure you want to use slip days for your submission?";
          bootbox.dialog(str, 
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                               useSlipDays();
                           }
                         }, 
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
          );
        });

        var wcClusterSshCmd = "";

        function showclusteract(display)
        {
                  var jqxhr = $.ajax('../util/vcput.php?a=clusterInfo'
                                   + '&courseid='+ 11575                                   + '&asnid='+ 121095                      
                                   + '&stepid='+ 121096                                   + '&userid='+ 460852                                   + '&asnuserid='+ 0)
                                   .done(function(data, textStatus, jqXHR)
                                     {
                                       try {
					 var result = JSON.parse(data);
                                         if (result['status'] == 'Error')
                                         {
                                           show_voc_gritter(false, "Could not get cluster information: " + result['msg'], true);
                                         }
                                         else
                                         {
                                           var state_status = result['cluster_state'];
                                           if ((result['cluster_status'] !== undefined) && (result['cluster_status'] != 'Ok'))
                                           {
                                             state_status = state_status + ' (' + result['cluster_status'] + ')';
                                           }
                                           if ((result['cluster_ssh_cmd'] !== undefined) && (result['cluster_ssh_cmd'] != ''))
                                           {
                                             wcClusterSshCmd = result['cluster_ssh_cmd'];
                                           }
                                           if (display == true)
                                           {
                                             var target = document.getElementById("report_cluster_msg_box");
                                             target.innerHTML = "<strong>Status: </strong>" + state_status + "<br>"
                                                              + "<strong>Cluster IP: </strong>" + result['cluster_ip'] + "<br>"
                                                              + "<strong>SSH Cmd: </strong>" + wcClusterSshCmd;
                                             $('#modal-table-report-cluster').modal('show');
                                           }
				         }
                                       }
                                       catch(err)
                                       {
                                         show_voc_gritter(false, "Could not get cluster1 information", true);
                                       }
                                     })
                                   .fail(function(data, textStatus, jqXHR)
                                     {
                                       show_voc_gritter(false, "Could not get cluster2 information", true);
                                     });
                      
        }
                  
        $('#clusterStartOld').click(function()
        {
                    var jqxhr = $.ajax('../util/vcput.php?a=clusterStartOld'
                                       + '&courseid='+ 11575                                       + '&asnid='+ 121095                      
                                       + '&stepid='+ 121096                                       + '&userid='+ 460852                                       + '&asnuserid='+ 460852)
                                   .done(function(data, textStatus, jqXHR)
                                     {
                                       try {
					 var result = JSON.parse(data);
                                         if (result['status'] == 'Error')
                                         {
                                           show_voc_gritter(false, "Could not start cluster: " + result['msg'], true);
                                         }
                                         else
                                         {
                                           // ok - got some information back...
                                           msg = "Unknown";
                                           switch (result['state'])
                                           {
                                             case null:
                                             case "Unknown":
                                               msg = "Launching a new cluster; this operation will take a few minutes.";
                                               break;
                                             case "Launching":
                                               msg = "A new cluster is currently being launched.";
                                               break;
                                             case "Starting":
                                               msg = "A new cluster is currently being started.";
                                               break;
                                             case "Stopped":
                                             case "Stopping":
                                               msg = "The cluster is being restarted.";
                                               break;
                                             case "Running":
                                               msg = "The cluster is already running.";
                                               break;
                                             case "Failed":
                                               msg = "The cluster is in failed state; please contact Vocareum Technical Support to resolve this.";
                                               break;
                                           }
                                           bootbox.dialog(msg, 
                                                          [{
                                                            "label" : "Ok",
                                                            "class" : "btn vocbtn-ac vocbtn-action",
                                                          }]);
                                         }
				       }
                                       catch(err)
                                       {
                                         show_voc_gritter(false, "Starting of cluster1 failed", true);
                                       }
                                     })
                                   .fail(function(data, textStatus, jqXHR)
                                     {
                                       show_voc_gritter(false, "Starting of cluster2 failed", true);
                                     });
                      
                  }
                  );

                  var clusterState = "Unknown";
                  var clusterStatus = "Unknown";
                  var clusterExtIp = "Unknown";
                  var clusterLaunchTimeAvg = 0;
                  var clusterRestartTimeAvg = 0;
                  var clusterActionTimeElapsed = 0;

                  $('#clusterdropdown').on('click', function (event) {
                    $('#clusterState').html("<i class='icon-info-sign' style='margin-right:5px'></i>" + "State: Retrieving...");
                    getClusterState();
                  });
                  function getClusterState()
                  {
                    var jqxhr = $.ajax('../util/vcput.php?a=getClusterState'
                                       + '&courseid='+ 11575                                       + '&stepid='+ 121096                                       + '&userid='+ 460852)
                                 .done(function(data, textStatus, jqXHR)
                                   {
                                     try 
                                     {
				       var result = JSON.parse(data);
                                       if (result['status'] == 'Error') 
                                       {
                                         show_voc_gritter(false, "Could not get cluster state: " + result['msg'], true);
                                       }
                                       else 
                                       {
                                         clusterState = result['cluster_state'];
                                         clusterStatus = result['cluster_status'];
                                         clusterExtIp = result['cluster_ext_ip'];

                                         clusterLaunchTimeAvg = result['cluster_launch_avg'];
                                         clusterRestartTimeAvg = result['cluster_restart_avg'];
                                         clusterActionTimeElapsed = result['cluster_action_time_elapsed'];

                                         showClusterState = clusterState;
                                         if (result['cluster_status'] == "Error") {
                                           showClusterState += " (Error)";
                                         }
                                         if (clusterState == "None") {
                                           showClusterState = 'Not launched';
                                         }
                                         else if (clusterState == "Ready") {
                                           wcClusterSshCmd = '';
                                           showclusteract(false);
                                         }
                                         $('#clusterState').html("<i class='icon-info-sign' style='margin-right:5px'></i>" + "State: " + showClusterState);
				       }
                                     }
                                     catch(err) 
                                     {
                                       show_voc_gritter(false, "Could not get cluster state1", true);
                                     }
                                   })
                                 .fail(function(data, textStatus, jqXHR)
                                   {
                                     show_voc_gritter(false, "Could not get cluster state2", true);
                                   });
  		  }	
                  
                  function changeClusterState(ctrlState)
                  {
                    var jqxhr = $.ajax('../util/vcput.php?a=changeClusterState'
                                     + '&courseid='+ 11575                                     + '&stepid='+ 121096                                     + '&userid='+ 460852                                     + '&ctrlstate=' + ctrlState)
                                 .done(function(data, textStatus, jqXHR)
                                   {
                                     try 
                                     {
				       var result = JSON.parse(data);
                                       if (result['status'] == 'Error') 
                                       {
                                         show_voc_gritter(false, "Could not change cluster state: " + result['msg'], true);
                                       }
                                     }
                                     catch(err) 
                                     {
                                       show_voc_gritter(false, "Could not change cluster state1", true);
                                     }
                                   })
                                 .fail(function(data, textStatus, jqXHR)
                                   {
                                     show_voc_gritter(false, "Could not change cluster state2", true);
                                   });
                  }

                  $('#clusterStart').on('click', function (e) {
                    var str = "";
                    if (clusterState == "Ready") {
                      str = "The cluster is already in the Ready state; resetting the Idle timer...";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                           changeClusterState(4);
                                         }
                                       }
                                     ]);
                    } else {
                      str = "Are you sure you want to start the cluster?<br><br>Click Yes to continue or No to cancel.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Yes",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                                                                        changeClusterState(4);
                                                                                    }
                                       },
                                      {
                                        "label" : "No",
                                        "class" : "btn vocbtn-ac vocbtn-status"
                                      }
                                     ]);
                    }
                  });
                  $('#clusterStop').on('click', function (e) {
                    var str = "";

                    if (    (clusterState == "Ready")
                         || ((clusterState == "Starting" || clusterState == "Initializing") && (clusterStatus == "Error"))) {
                      str = "Are you sure you want to stop the cluster?<br><br>Click Yes to continue or No to cancel.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Yes",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                           changeClusterState(5);
                                         }
                                       },
                                      {
                                        "label" : "No",
                                        "class" : "btn vocbtn-ac vocbtn-status"
                                      }
                                     ]);
                    }
                    else {
                      str = "The cluster is neither running nor in an Error state.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    }
                  });

                  $('#clusterReInit').on('click', function (e) {
                    var str = "";
                    if ((clusterState != "Ready") && (clusterState != "Initializing")) {
                      str = "The cluster is not running.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    } else {
                      str = "The instructor's init script will be run on the cluster.<br><br><strong>Warning:</strong> This operation will <strong>re-format</strong> the namenode.<br><br>Click Ok to start the operation or Cancel to quit.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                           changeClusterState(2);
                                         }
                                       },
                                      {
                                        "label" : "Cancel",
                                        "class" : "btn vocbtn-ac vocbtn-status"
                                      }
                                     ]);
                    }
                  });
                  $('#clusterTerminate').on('click', function (e) {
                    var str = "";
                    if (clusterState == "None") {
                      str = "The cluster is not running.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    } else {
                      str = "Are you sure you want to terminate the cluster?<br><br><strong>Warning:</strong> This operation <strong>cannot</strong> be undone.<br><br>Click Yes to continue or No to cancel.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Yes",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                           changeClusterState(6);
                                         }
                                       },
                                       {
                                         "label" : "No",
                                         "class" : "btn vocbtn-ac vocbtn-status"
                                       }
                                     ]);
                    }
                  });
                    
                  function showClouderaUI(type)
                  {
                    var str = "";
                    if (clusterState != 'Ready') {
                      str = "The cluster is not running at this time.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    } else {
                      if (clusterExtIp == "Unknown") {
                        str = "Could not determine cluster ip address";
                        bootbox.dialog(str,
                                       [
                                         {
                                           "label" : "Ok",
                                           "class" : "btn vocbtn-ac vocbtn-action",
                                         }
                                       ]);
                      } else {
                        if (type == "ssh") {
                          wcSendSshCmd();
                        }
                        else if (type == "manager") {
                          window.open("http://" + clusterExtIp + ":7180");
                        }
                        else {
                          window.open("http://" + clusterExtIp + ":8889");
                        }
                      }
                    }
                    $('#actionsdropdown_liactions2').parent().removeClass('open');
                  }

                  $(".clouderaButton").click(function() {
                    var $type = $(this).data("command");
                    showClouderaUI($type);
                  });


                  var last_saved_ide_indent = 4;
                  var last_saved_ide_t2s = "1";
                  
                  function saveIdeOptions()
                  {
                                        return;
                                        var ind = $("#ide_indent_size").find("option:selected").text();
                    var t2s = 0;
                    if ($('#ide_tab_to_spaces').is(':checked')) {
                      t2s = 1;
                    }
                    if ((ind != last_saved_ide_indent) || (t2s != last_saved_ide_t2s))
                    {
                      if (ind != last_saved_ide_indent)
                      {
                        last_saved_ide_indent = ind;
                        editor.setOption("indentUnit", last_saved_ide_indent);
                      }
                      if (t2s != last_saved_ide_t2s)
                      {
                        last_saved_ide_t2s = t2s;
                        if (t2s == 0)
                        {
                          editor.setOption("extraKeys", { Tab: vocDefaultTab });
                        }
                        else
                        {
                          editor.setOption("extraKeys", { Tab: vocBetterTab });
                        }
                      }
                      
                      var jqxhr = $.ajax('../util/vcput.php?a=saveIdeOptions'
                                       + '&stepid='+ 121096                                       + '&userid='+ 460852                                       + '&indent_size=' + ind
                                       + '&tab_to_spaces=' + t2s)
                                   .done(function(data, textStatus, jqXHR)
                                     {
                                       try {
					 var result = JSON.parse(data);
                                         if (result['status'] == 'Error')
                                         {
                                           show_voc_gritter(false, "Saving of IDE data failed: " + result['msg'], true);
                                         }
				       } catch(err) {
                                         show_voc_gritter(false, "Saving of IDE data 1 failed", true);
                                       }
                                     })
                                   .fail(function(data, textStatus, jqXHR) {
                                     show_voc_gritter(false, "Saving of IDE data 2 failed", true);
                                   });
                      
                    }
                  }
                  
                  $('#actionsdropdown_liactions2').on('click', function (event) {
                    if ($('#actionsdropdown_liactions2').parent().hasClass('open'))
                    {
                      saveIdeOptions();
                    }
                    $(this).parent().toggleClass('open');
                  });

                  $('body').on('click', function (e) {
                    if (  !$('#liactions2').is(e.target)
                        && ($('#liactions2').has(e.target).length === 0)
                        && ($('.open').has(e.target).length === 0))
                    {
                      if ($('#actionsdropdown_liactions2').parent().hasClass('open'))
                      {
                        $('#actionsdropdown_liactions2').parent().removeClass('open');
                        saveIdeOptions();
                      }
                    }
                  });

                  $( document ).ready(function() {
                                      });

                  function wcSetupTerminal()
                  {
                    // send the ssh cmd
                    // first check of terminal is still open
                    //     if yes - send cmd
                    //     if not - start it
                    var telement = document.getElementById('terminalIframe');
                    if (! telement.contentWindow.vocTerminalIsAvailable())
                    {
                      telement.contentWindow.vocStartTerminal();
                    }
                    else
                    {
                      telement.contentWindow.executeCommand(wcClusterSshCmd);
                    }
                  }

                  var wcShowClusterState = 'Unknown';
                  var wcClusterWaitAvgTime = 0;
                  var wcClusterTimeElapsed = 0;
                  var wcClusterShowProgressTimeout;

                  function wcPeriodicCheckClusterState()
                  {
                    getClusterState();
                    // has the state changed? the above function is non-blocking so we'll see it next time around
                    if (wcShowClusterState != showClusterState)
                    {
                      wcShowClusterState = showClusterState;
                      $('#waitCluster_header').text("Cluster: " + wcShowClusterState);
                      // state changed
                      // if Ready state, great
                      // otherwise it's Error state - what to do?? Show msg and "Ok" button
                      if (clusterStatus == 'Error')
                      {
                        $('#waitClusterMsg').text("There was an error starting your cluster; please terminate it and try again.");
                        $('#waitClusterButton').prop('disabled', false);
                      }
                      else
                      {
                        switch (clusterState)
                        {
                          case "Ready":
                            clearTimeout(wcClusterShowProgressTimeout);
                            wcSetProgressBar(100);
                            $('#waitClusterMsg').text("Your cluster is now ready for use.");
                            $('#waitClusterButton').prop('disabled', false);
                            wcSetupTerminal();
                            break;

                          case "Starting":
                          case "Initializing":
                          case "Launching":
                            setTimeout(wcPeriodicCheckClusterState, 3000);
                            break;

                          default:
                            $('#waitClusterMsg').text("The cluster is in an unexpected state; please terminate it and try again.");
                            clearTimeout(wcClusterShowProgressTimeout);
                            $('#waitClusterButton').prop('disabled', false);
                            break;
                        }
                      }
                    }
                    else
                    {
                      setTimeout(wcPeriodicCheckClusterState, 3000);
                    }
                  }

                  function wcSetProgressBar(val)
                  {
                    $progressBar = $('#waitClusterProgress');
                    $progressBar
                      .attr('data-percent', val + '%')
                      .find('.bar')
                      .css({
                        width: val + '%'
                      });
                  }

                  function wcPeriodicShowProgress()
                  {
                    wcClusterTimeElapsed += 0.5;
                    wcClusterWaitProgress = Math.floor(100 * wcClusterTimeElapsed / wcClusterWaitAvgTime);
                    if (wcClusterWaitProgress >= 100) { wcClusterWaitProgress = 99; } // 100 will be set when the state changes
                    wcSetProgressBar(wcClusterWaitProgress);
                    wcClusterShowProgressTimeout = setTimeout(wcPeriodicShowProgress, 500);
                  }
                  
                  function wcShowModal(clusterState)
                  {
                    // should we show the progress bar or the spinner?
                    wcClusterWaitAvgTime = 0;
                    switch (clusterState)
                    {
                      case "Terminated":
                      case "Launching":
                      case "None":
                        wcClusterWaitAvgTime = clusterLaunchTimeAvg;
                        break;

                      case "Stopped":
                      case "Starting":
                        wcClusterWaitAvgTime = clusterRestartTimeAvg;
                        break;
                    }
                    if (wcClusterWaitAvgTime > 0)
                    {
                      if (  (clusterState == "Launching")
                         || (clusterState == "Starting") )
                      {
                        if ((clusterActionTimeElapsed > 0) && (clusterActionTimeElapsed < wcClusterWaitAvgTime))
                        {
                          wcClusterTimeElapsed = clusterActionTimeElapsed;
                        }
                        else
                        {
                          wcClusterTimeElapsed = 0;
                        }
                      }
                      $('#waitClusterProgress').show();
                      $('#waitClusterSpinner').hide();
                      wcClusterShowProgressTimeout = setTimeout(wcPeriodicShowProgress, 500);
                    }
                    else
                    {
                      $('#waitClusterSpinner').show();
                      $('#waitClusterProgress').hide();
                    }

                    $('#waitCluster').modal();
                    // start the monitoring process
                    setTimeout(wcPeriodicCheckClusterState, 2000);
                  }
                  
                  function wcCheckForClusterState()
                  {
                    if (clusterState == "Unknown")
                    {
                      setTimeout(wcCheckForClusterState, 500);
                      return;
                    }
                    wcShowClusterState = showClusterState;
                    $('#waitCluster_header').text("Cluster: " + wcShowClusterState);

                    // If the state is Stopped/Terminated/Launching/Starting/Initializing, bring up modal
                    // If state is Stopped/Terminate, start cluster
                    switch (clusterState)
                    {
                      case "Stopped":
                      case "Terminated":
                      case "None":
                        changeClusterState(4);
                        if (clusterState == "Stopped")
                        {
                          stateStr = "Starting";
                        }
                        else
                        {
                          stateStr = "Launching";
                        }
                        $('#waitCluster_header').text("Cluster: " + stateStr);
                        wcShowModal(clusterState);
                        break;
                      case "Starting":
                      // case "Initializing":
                      case "Launching":
                        wcShowModal(clusterState);
                        break;
                    }
                  }

                  var wcSshWait = 0;
                  var wcClusterSshCmdWaitMax = 6;

                  function wcWaitForSshCmd()
                  {
                    while ((wcClusterSshCmd == '') && (wcSshWait < wcClusterSshCmdWaitMax))
                    {
                      wcSshWait += 1;
                      setTimeout(wcWaitForSshCmd, 500);
                    }
                    if (wcClusterSshCmd == '')
                    {
                      str = "Unable to determine cluster ssh cmd; please try again in a few seconds.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    }
                  }

                  function wcSendSshCmd()
                  {
                    if (wcClusterSshCmd != '')
                    {
                      document.getElementById('terminalIframe').contentWindow.executeCommand(wcClusterSshCmd);
                    }
                    else
                    {
                      wcSshWait = 0;
                      showclusteract(false);
                      setTimeout(wcWaitForSshCmd, 500);
                    }
                  }

                  function wcTestLater()
                  {
                    clearTimeout(wcClusterShowProgressTimeout);
                    wcSetProgressBar(100);
                    wcSendSshCmd();
                    $('#waitClusterMsg').text("Your cluster is now ready for use.");
                    $('#waitClusterButton').prop('disabled', false);
                  }
                  function wcTestSetupProgress()
                  {
                    // setup the variables and show the progress bar
                    wcClusterTimeElapsed = 0;
                    wcClusterWaitAvgTime = 8;
                    $('#waitClusterProgress').show();
                    wcClusterShowProgressTimeout = setTimeout(wcPeriodicShowProgress, 500);
                  }
                  function wcTest()
                  {
                    if (1)
                    {
                      $('#waitClusterSpinner').hide();
                      wcTestSetupProgress();
                    }
                    else
                    {
                      $('#waitClusterSpinner').show();
                      $('#waitClusterProgress').hide();
                    }
                    $('#waitCluster').modal();
                    setTimeout(wcTestLater, 20000);
                  }

                  function wcStartCluster()
                  {
                    // wcTest();
                    getClusterState();
                    setTimeout(wcCheckForClusterState, 500);                    
                  }

                  function wcAutoStartCluster()
                  {
                    // need to reset the modal elements first
                    $('#waitCluster_header').text("Cluster");
                    $('#waitClusterMsg').text("Your cluster is being started. This operation may take a few minutes.");
                    $('#waitClusterButton').prop('disabled', true);
                    wcClusterTimeElapsed = 0;
                    wcSetProgressBar(0);
                    setTimeout(wcStartCluster, 1000);
                  }

	          $(document).ready(function() {   
                                        
                  });
	</script>
	

	
<!-- PAGE CONTENT ENDS HERE -->
					</div><!--/row-->
				</div><!--/#page-content-->
		</div><!-- #main-content -->
	</div><!--/.fluid-container#main-container-->

<div id="push"></div>

	

		<!--[if lte IE 8]>
		  <script src="../shared/ace/assets/js/excanvas.min.js"></script>
		<![endif]-->		
		
		
		


		
		
		<script src="./prova Html_files/ace-elements.js.download"></script>
       <!-- <script src="../shared/ace/assets/js/jquery.autosize-min.js"></script> -->
       <script src="./prova Html_files/jquery.colorbox-min.js.download"></script>
		
		<!-- functions start : remove unused ones -->

  <script type="text/javascript"> <!-- PCHECK -->


      function voc_set_tabindex() {
          console.log("voc_set_tabindex");
          $(".vocelem").each(function (i) { $(this).attr('tabindex', i + 1); console.log($(this)); });
      }

		$('#navbar-inner-div').off('keydown');
        $('#navbar-inner-div').attach_accesible_handler();

			$(function() {
			
					
			
				$('textarea[class*=autosize]').autosize({append: "\n"});
			
				$('#accordion2').on('hide', function (e) {
					$(e.target).prev().children(0).addClass('collapsed');
				})
				$('#accordion2').on('hidden', function (e) {
					$(e.target).prev().children(0).addClass('collapsed');
				})
				$('#accordion2').on('show', function (e) {
					$(e.target).prev().children(0).removeClass('collapsed');
				})
				$('#accordion2').on('shown', function (e) {
					$(e.target).prev().children(0).removeClass('collapsed');
				})

				$('#accordion-style').on('click', function(ev){
					var target = $('input', ev.target);
					var which = parseInt(target.val());
					if(which == 2) $('#accordion').addClass('accordion-style2');
					 else $('#accordion').removeClass('accordion-style2');
				});			
			
				var oldie = /msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase());
				$('.easy-pie-chart.percentage').each(function(){
					$(this).easyPieChart({
						barColor: $(this).data('color'),
						trackColor: '#EEEEEE',
						scaleColor: false,
						lineCap: 'butt',
						lineWidth: 8,
						animate: oldie ? false : 1000,
						size:75
					}).css('color', $(this).data('color'));
				});
			
				$('[data-rel=tooltip]').tooltip();
				$('[data-rel=popover]').popover({html:true});
			
			
				$('#gritter-regular').on(ace.click_event, function(){
					$.gritter.add({
						title: 'This is a regular notice!',
						text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" class="blue">magnis dis parturient</a> montes, nascetur ridiculus mus.',
						image: $assets+'/avatars/avatar1.png',
						sticky: false,
						time: '',
						class_name: (!$('#gritter-light').get(0).checked ? 'gritter-light' : '')
					});
			
					return false;
				});
			
				$('#gritter-sticky').on(ace.click_event, function(){
					var unique_id = $.gritter.add({
						title: 'This is a sticky notice!',
						text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" class="red">magnis dis parturient</a> montes, nascetur ridiculus mus.',
						image: $assets+'/avatars/avatar.png',
						sticky: true,
						time: '',
						class_name: 'gritter-info' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
					});
			
					return false;
				});
			
			
				$('#gritter-without-image').on(ace.click_event, function(){
					$.gritter.add({
						// (string | mandatory) the heading of the notification
						title: 'This is a notice without an image!',
						// (string | mandatory) the text inside the notification
						text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" class="orange">magnis dis parturient</a> montes, nascetur ridiculus mus.',
						class_name: 'gritter-success' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
					});
			
					return false;
				});
			
			
				$('#gritter-max3').on(ace.click_event, function(){
					$.gritter.add({
						title: 'This is a notice with a max of 3 on screen at one time!',
						text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" class="green">magnis dis parturient</a> montes, nascetur ridiculus mus.',
						image: $assets+'/avatars/avatar3.png',
						sticky: false,
						before_open: function(){
							if($('.gritter-item-wrapper').length >= 3)
							{
								return false;
							}
						},
						class_name: 'gritter-warning' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
					});
			
					return false;
				});
			
			
				$('#gritter-center').on(ace.click_event, function(){
					$.gritter.add({
						title: 'This is a centered notification',
						text: 'Just add a "gritter-center" class_name to your $.gritter.add or globally to $.gritter.options.class_name',
						class_name: 'gritter-info gritter-center' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
					});
			
					return false;
				});
				
				$('#gritter-error').on(ace.click_event, function(){
					$.gritter.add({
						title: 'This is a warning notification',
						text: 'Just add a "gritter-light" class_name to your $.gritter.add or globally to $.gritter.options.class_name',
						class_name: 'gritter-error' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
					});
			
					return false;
				});
					
			
				$("#gritter-remove").on(ace.click_event, function(){
					$.gritter.removeAll();
					return false;
				});
					
			
				///////
			
			
				$("#bootbox-regular").on(ace.click_event, function() {
					bootbox.prompt("What is your name?", function(result) {
						if (result === null) {
							//Example.show("Prompt dismissed");
						} else {
							//Example.show("Hi <b>"+result+"</b>");
						}
					});
				});
					
				$("#bootbox-confirm").on(ace.click_event, function() {
					bootbox.confirm("Are you sure?", function(result) {
						if(result) {
							bootbox.alert("You are sure!");
						}
					});
				});
					
				$("#bootbox-options").on(ace.click_event, function() {
					bootbox.dialog("I am a custom dialog with smaller buttons", [{
						"label" : "Success!",
						"class" : "btn-small btn-success",
						"callback": function() {
							//Example.show("great success");
						}
						}, {
						"label" : "Danger!",
						"class" : "btn-small btn-danger",
						"callback": function() {
							//Example.show("uh oh, look out!");
						}
						}, {
						"label" : "Click ME!",
						"class" : "btn-small btn-primary",
						"callback": function() {
							//Example.show("Primary button");
						}
						}, {
						"label" : "Just a button...",
						"class" : "btn-small"
						}]
					);
				});
			
			
			
				$('#spinner-opts small').css({display:'inline-block', width:'60px'})
			
				var slide_styles = ['', 'green','red','purple','orange', 'dark'];
				var ii = 0;
				$("#spinner-opts input[type=text]").each(function() {
					var $this = $(this);
					$this.hide().after('<span />');
					$this.next().addClass('ui-slider-small').
					addClass("inline ui-slider-"+slide_styles[ii++ % slide_styles.length]).
					css({'width':'125px'}).slider({
						value:parseInt($this.val()),
						range: "min",
						animate:true,
						min: parseInt($this.data('min')),
						max: parseInt($this.data('max')),
						step: parseFloat($this.data('step')),
						slide: function( event, ui ) {
							$this.attr('value', ui.value);
							spinner_update();
						}
					});
				});
			
			
			
			
			
				$.fn.spin = function(opts) {
					this.each(function() {
					  var $this = $(this),
						  data = $this.data();
			
					  if (data.spinner) {
						data.spinner.stop();
						delete data.spinner;
					  }
					  if (opts !== false) {
						data.spinner = new Spinner($.extend({color: $this.css('color')}, opts)).spin(this);
					  }
					});
					return this;
				};
			
				function spinner_update() {
					var opts = {};
					$('#spinner-opts input[type=text]').each(function() {
						opts[this.name] = parseFloat(this.value);
					});
					$('#spinner-preview').spin(opts);
				}
			
			
			
				$('#id-pills-stacked').removeAttr('checked').on('click', function(){
					$('.nav-pills').toggleClass('nav-stacked');
				});
			
			
			});
		</script>
		<!-- functions end -->
		

<!-- it might be used by both TA and grader so putting it under main.php -->
<script>
    function hideNamesOnDashboard() {
        $('.studentNameDashboard').addClass('hidden-1');
        $('.anonymousInfoDashboard').removeClass('hidden-1');
    }
    function showNamesOnDashboard() {
        $('.studentNameDashboard').removeClass('hidden-1');
        $('.anonymousInfoDashboard').addClass('hidden-1');
    }
    $('#showHideStudentNameDashboard').on('click', function() {
        if($(this).text() == 'Hide Names') {
            hideNamesOnDashboard();
            $(this).html('Show Names');
            hideNamesDashboard = 1;
        } else {
            showNamesOnDashboard();
            $(this).html('Hide Names');
            hideNamesDashboard = 0;
        }
    });
</script>

	

<div id="cboxOverlay" style="display: none;"></div><div id="colorbox" class="" role="dialog" tabindex="-1" style="display: none;"><div id="cboxWrapper"><div><div id="cboxTopLeft" style="float: left;"></div><div id="cboxTopCenter" style="float: left;"></div><div id="cboxTopRight" style="float: left;"></div></div><div style="clear: left;"><div id="cboxMiddleLeft" style="float: left;"></div><div id="cboxContent" style="float: left;"><div id="cboxTitle" style="float: left;"></div><div id="cboxCurrent" style="float: left;"></div><button type="button" id="cboxPrevious"></button><button type="button" id="cboxNext"></button><button id="cboxSlideshow"></button><div id="cboxLoadingOverlay" style="float: left;"></div><div id="cboxLoadingGraphic" style="float: left;"></div></div><div id="cboxMiddleRight" style="float: left;"></div></div><div style="clear: left;"><div id="cboxBottomLeft" style="float: left;"></div><div id="cboxBottomCenter" style="float: left;"></div><div id="cboxBottomRight" style="float: left;"></div></div></div><div style="position: absolute; width: 9999px; visibility: hidden; display: none;"></div></div><textarea tabindex="-1" style="position: absolute; top: -999px; left: 0px; right: auto; bottom: auto; border: 0px; box-sizing: content-box; overflow-wrap: break-word; overflow: hidden; transition: none 0s ease 0s; height: 0px !important; min-height: 0px !important;"></textarea></body></html>